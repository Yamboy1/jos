<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>FindReplaceBeanModelCode.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="105dda8fe0e272541da9dac0b47d660e" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="image/wikiHome.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="UsersWebHome.html">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="MainWebHome.html">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="InfoWebHome.html">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="DevZoneWebHome.html">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="SupportWebHome.html">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<! page="">FindReplaceBeanModelCode</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="ImportedWebHome.html">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=105dda8fe0e272541da9dac0b47d660e" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<! page=""><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <! page="">info</a> on or <a href="WebHome.html">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<! page="">login</a> or <! page="">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="Glossary.html">topics</a>, <! page="">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="NewArticles2a.html">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<EM>Please do not edit here</EM>
</P><P>
Submit your comment to jos-apps mailinglist, or the <a href="FindReplaceBeanModelCodeComments.html">FindReplaceBeanModelCodeComments</a>
<HR>
<PRE>
package jos.find;
/** FindReplaceBean
 * This is the 'underlying architecture' or 'workhorse'.
 * Please refer to JOS Collaborative Effort for more info.
 * 
 * Author:	Stefan Borg
 * Started Date:	6 Nov 1997
 * Edited Date:	9 Nov 1997
 * Revise:	0.11
 */

import java.beans.*;
import java.io.*;

public class FindReplaceBean extends Beans implements Serializable {

/** Instance variables.
 */
	private boolean debug = false;
	private Reader reader = null;
	private char[] searchBuffer = null;
	private long offset = 0;
	private boolean ignoreCase = false;
	private boolean wholeWords = false;

/** Internal variables.
 */
	private char[] buffer = null;
	private int searchLength = 0;
	private int bufferOffset = 0;

/** Enables/disables system console messages for debuggin purposes.
 */
	public void setDebug(boolean debug) { this.debug = debug; }
	public boolean getDebug() {	return debug;	}

/** Set/gets source text for searching through.
*/

	public void setReader(Reader reader) { this.reader = reader; }
	public Reader getReader() {	return reader;	}

/** Set/gets search text for searching for.
 */
	public void setSearchText(String searchText) { 
		searchBuffer = searchText.toCharArray();
		searchLength = searchBuffer.length;
	}
	public String getSearchText() {	return new String(searchBuffer);	}

/** Set/gets option for ignoring case.
 */
	public void setIgnoreCase(boolean ignoreCase) { this.ignoreCase = ignoreCase; }
	public boolean getIgnoreCase() {	return ignoreCase;	}

/** Set/gets option for whole words only.
 */
	public void setWholeWords(boolean wholeWords) { this.wholeWords = wholeWords; }
	public boolean getWholeWords() {	return wholeWords;	}

/** Set/gets offset value to begin searching from. Later to become a protected method.
 */
	public void setOffset(long offset) { this.offset = offset; }
	public long getOffset() {	return offset;	}

/** Returns index value of found text. Maybe later to become a protected method.
 * Queries:
 * 	should reading depend on Reader.ready()??
 */
	public long getIndex() throws InvalidSourceException {

// Checks all inputs are available
		check();

		long index = -1;
		Reader tempReader = reader;
		buffer = new char[searchLength];
		long currentIndex = offset;
		bufferOffset = 0;

	out:
		try {

// Skips offset value
			tempReader.skip(currentIndex);

			do {

// Reads stream into buffer
				if (tempReader.read(buffer, bufferOffset, 
						(searchLength - bufferOffset)) == -1)
					break out;

				currentIndex += searchLength - bufferOffset;

				if (debug)
					System.err.println("buffer:" + buffer + " @ " + (currentIndex - searchLength));

// Until buffer matches search text
			} while (!compareBuffer());

			index = currentIndex - searchLength;
		} catch (IOException io) {
			io.getLocalizedMessage();
			io.printStackTrace();
		}

		if (debug)
			System.err.println("getIndex = " + index);

		return index;
	}

/** Returns true if arrays are equal.
 */
	private boolean compareBuffer() {
		boolean result = true;

		try {
			for (int i = 0; i &lt; searchLength; i++) {
				char bufferChar = buffer[i];
				char searchChar = searchBuffer[i];

				if (ignoreCase) {
					bufferChar = Character.toLowerCase(bufferChar);
					searchChar = Character.toLowerCase(searchChar);
				}

				if (bufferChar != searchChar)
					result = false;
			}
		} catch(NullPointerException npe) {
			result = false;
		}

// if unequal, check that start of search text is not in the buffer
		if (!result) {
			bufferOffset = checkBuffer();
		}

		return result;
	}

/** Returns index of first character equal to first
 * character of search text. Returns -1 if none found.
 */
	private int checkBuffer() {
		for (int i = 1; i &lt; searchLength; i++) {
			if (buffer[i] == searchBuffer[0]) {

				if (debug)
					System.err.println("found @:"+i);

				return shiftBuffer(i);
			}
		}
		return 0;
	}

/** Shifts array into new position. Returns last index.
 */
	private int shiftBuffer(int first) {
		char[] tmpBuffer = buffer;
		int i = 0;
		for (; i &lt; (searchLength - first); i++) {
			buffer[i] = tmpBuffer[first + i];
		}

		if (debug)
			System.err.println("shifted:"+buffer);

		return i;
	}

/** Returns true if Reader stream and search text are valid.
 */
	private void check() throws InvalidSourceException {
		if (reader == null) {
			throw new InvalidSourceException();
		}
	}

/** InvalidSourceException class.
 */
	class InvalidSourceException extends Exception {
		InvalidSourceException() {
			super("Reader source does not exist.");
		}
	};

/** For testing.
 */
	public static void main(String args[]) {
		FindReplaceBean frb = new FindReplaceBean();
		try {
			frb.setDebug(true);
			frb.setReader(new FileReader("META-INF/MANIFEST.MF"));
			frb.setSearchText("bean");
			frb.setOffset(31);
			frb.setIgnoreCase(true);

			System.out.println(frb.getIndex());
		} catch (Exception e) {
			e.getLocalizedMessage();
			e.printStackTrace();
		}
	}
}
</PRE>
-- <a href="StefanBorg.html">StefanBorg</a><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<! page="">login</a> or <! page="">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

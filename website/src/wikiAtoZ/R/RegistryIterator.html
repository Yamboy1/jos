<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>RegistryIterator.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="0d14b3b537c8f46fe59ca198734cc9d0" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//RegistryIterator?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">RegistryIterator</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/RegistryIterator?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">info</a> on or <a href="/edit/Imported/RegistryIterator?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FRegistryIterator&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FRegistryIterator&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE=-1><a href="/view.php?topic=RegistryPages&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">RegistryPages</a><wikitopic RegistryPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (7 July 1999).</EM>
<H4>Introduction</H4>
<P>While the <CODE>registry.Registry</CODE> interface is a low-level interface to a registry, we can turn our attention to higher level constructs. There is another architecture possible when building a generic registry <nolink>API: registry entries and registry service.</P>
<H4>getXXX() and setXXX()</H4>
<P>With the higher-level registry iterator, programmers can have what they always wanted: no getXXX() and setXXX() methods. <a href="/view.php?topic=DigiGod&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">DigiGod</a><wikitopic DigiGod /wikitopic> and others programmers have constantly reminded me that they don't like the primative getXXX() and setXXX() methods.</P>
<P>On the other hand, I can get what I want. I want a generic (reusable) set of conversion methods to convert from any data type to the data type I want--without writing the same conversion code into every program I write.</P>
<P>I often reflect on the way the <CODE>java.sql.ResultSet</CODE> contains a lot of redundancy, for much of the same reasons as the <CODE>registry.Registry</CODE>. What can we do about it?</P>
<H4>Introducing a registry "iterator"</H4>
<P>A top-level registry contains all of the registry data. Such a top-level registry is based upon the <CODE>registry.Registry</CODE> interface. The registry interface doesn't support the idea of a "current" location or "current" node. This is left to a higher level construct.</P>
<P>An iterator maintains the information required for a "current" location within a top-level registry. Much of the functionality of the <CODE>registry.Registry</CODE> could be transferred to the registry iterator.</P>
<H4>Introducing a registry "entry"</H4>
<P>In order for the registry iterator to work to my satisfaction, it must keep track of the "current" registry node, but not the current registry entry. With an iterator you would be able to "go to" a registry node (a <CODE>registry.Registry</CODE>) but not to an item in a registry unless it were a <CODE>registry.Registry</CODE>.</P>
<P>A registry entry could combine the type and value:
<PRE>
public class RegistryEntry {
  public RegistryEntry( Object v ) {
	 type = computeType( v );
	 value = v;
  }
  public RegistryEntry( String t, Object v ) {
	 type = t;
	 value = v;
  }
  public String getType() {
	 return type;
  }
  public Object getValue() {
	 return value;
  }
  private String type;
  private Object value;
}
</PRE>
<P>With a registry entry object, the registry iterator would look something like this:
<PRE>
public interface RegistryIterator {
  public void goto( String path );
  public void gotoParent(); // up();
  public RegistryEntry getEntry( String key );
  public void setEntry( String key, Object v );
  public void setEntry( String key, RegistryEntry v );
  public String[] getKeys();
  public String[] getChildKeys();
  public String[] getEntryKeys();
}
</PRE>
<H4>Introducing a registry "service"</H4>
<P>A registry "service" provides the registry iterators for top-level registries. The registry service might be a special registry iterator, too. The root registry service for <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">JOS</a> <wikitopic JOS /wikitopic>might be able to "go to" any top-level registry, anywhere.</P>
<P>The registry service hides more of the details of the registry factory and registry controllers.</P>
<P>In the same way the <CODE>java.net.URL</CODE> class hides the details of its factory. The <CODE>java.net.URL</CODE> is the only class a program needs to know about.</P>
<P>It would be great if a registry service could be constructed in the same way as <CODE>java.net.URL</CODE>--except the registry factory should be (must be) open-ended. It should not assume that implementations are in packages with special names.</P>
<PRE>
public class RegistryService 
	 implements RegistryIterator {
  public static RegistryIterator getRootRegistry() {
	 return new RootRegistryService();
  }
  public static RegistryIterator getSystemRegistry() {
	 return new RegistryService( SYSTEM_REGISTRY );
  }
  public static RegistryIterator getNetworkRegistry() {
	 return new RegistryService( NETWORK_REGISTRY );
  }
}
</PRE>
<P>A basic registry iterator isn't that difficult to create. It should be part of the registry <nolink>API, too.
<PRE>
public class BasicRegistryIterator {
  public BasicRegistryIterator( String url ) {
	 path = "";
	 Registry ptop = 
		  RegistryFactory.getFactory().getRegistry( url );
	 pcurr = ptop;
  }
  public void goto( String v ) {
	 path = v;
	 resolveCurrent();
  }
  public void gotoParent() {
	 int pos = path.lastIndexOf( "/" );
	 if ( pos &lt; 0 ) {
		return;
	 }
	 path = path.substring( 0, pos );
	 resolveCurrent();
  }
  public RegistryEntry getEntry( String key ) {
	 return new RegistryEntry( pcurr.getObject( key ) );
  }
  public void setEntry( String key, Object o ) {
	 pcurr.setObject( key, o );
  }
  public String[] getKeys() {
	 return pcurr.getKeys();
  }
  public String[] getChildKeys() {
	 // *A! returns keys for type=registry
  }
  public String[] getEntryKeys() {
	 // *A! returns keys for type!=registry
  }
  protected void resolveCurrent() {
	 String p = path;
	 pcurr = ptop;
	 for (;;) {
		int pos = p.indexOf( "/" );
		if( pos &lt; 0 ) {
		  pcurr = ptop.getRegistry( p );
		}
		pcurr = ptop.getRegistry( p.substring( 0, pos ) );
		p = p.substring( pos + 1 );
	 }
  }
  private String path;
  private Registry ptop;
  private Registry pcurr;
}
</PRE>
<H4>Method</H4>
<P>By building the registry <nolink>API from the bottom up, the low-level registry interface can be used in current programs. As we gain experience from the way a registry is actually used in other programs, we can add new high-level interfaces and classes to the registry <nolink>API.</P>
<H4>Cursor</H4>
<P>A registry iterator is similar to the "current" position in a random access file (or other I/O stream). The operations on the random access file are relative to its "current" position. As bytes are written, the current position changes.</P>
<P>A cursor for a full blown top-level registry would enable a program to "navigate" its way through a hiearchy of any registry to the data that a program seeks. The cursor maintains the "current" position. All of its operations are relative to its "current" position.</P>
<P>Such a navigator should enable a program to traverse the entire registry, reading each registry entry, visiting each registry node.</P>
<P>The registry iterator stands apart from a registry. The iterator uses the standard <CODE>registry.Registry</CODE> interface for all its operations. In this way, a single implementation of registry interator will serve all kinds of registries.</P>
<H4>About conversion</H4>
<P>It seems that there must be a conversion layer possible between the <CODE>registry.Registry</CODE> and <CODE>registry.RegistryIterator</CODE>. If there is a generic conversion layer, it doesn't matter so much what kind of object is stored in a registry.</P>
<H4>About persistence</H4>
<P>If a generic registry is always used, a registry iterator could provide persistence for any registry. The <CODE>RegistryIterator.setEntry(..)</CODE> method should use the <CODE>Registry.saveAs()</CODE> method:
<PRE>
	 ptop.saveAs( original_registry_url );
</PRE>
<P>Or, the registry iterator could write a registry to an output stream without the help of saveAs().</P>
<H4>Example</H4>
<P>Here is an example of using a registry iterator to store an object graph inside a registry. The city of Marietta, Georgia (USA) is the county seat of Cobb county.</P>
<UL>
<LI>USA (country)
<UL>
<LI>Georgia (state)
<UL>
<LI>Cobb (county)
<UL>
<LI>Marietta (city)
</UL>
</UL>
</UL>
</UL>
<P>There is only one registry-related variable (r) in this example, compared to five registry-related variables in <a href="/view.php?topic=RegistryIO&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">RegistryIO</a><wikitopic RegistryIO /wikitopic>.</P>
<PRE>
  public void example() {
	 String url = "x-registry:new:";
	 RegistryIterator r = RegistryIterator( url );
	 r.setObject( "USA", new BasicRegistry() );
	 r.goto( "USA" );
	 r.setObject( "Georgia", new BasicRegistry() );
	 r.goto( "Georgia" );
	 r.setObject( "Cobb", new BasicRegistry() );
	 r.goto( "Cobb" );
	 r.setObject( "Marietta", new BasicRegistry() );
	 r.goto( "Marietta" );
	 r.setObject( "example", new Integer( 1000 ) );
  }
</PRE>
<P>Notice that <CODE>RegistryIterator.goto(..)</CODE> goes to a registry relative to the "current" registry. When a system-wide registry is distributed, this approach is more immediate, although less efficient. Of course, this is only one of hundreds of different ways to do this.</P>
<P>Looking back at this example, it might be better if a new registry node were created like this:
<PRE>
  public void in_theory() {
	 String url = "x-registry:new:";
	 RegistryIterator r = new RegistryIterator( url );
	 r.newRegistry( "USA" );
  }
</PRE><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FRegistryIterator&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FRegistryIterator&PHPSESSID=0d14b3b537c8f46fe59ca198734cc9d0">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

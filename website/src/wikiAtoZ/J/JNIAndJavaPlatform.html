<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>JNIAndJavaPlatform.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="9d44b2036e800afa3ae779bf3816dede" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//JNIAndJavaPlatform?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">JNIAndJavaPlatform</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=9d44b2036e800afa3ae779bf3816dede" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=9d44b2036e800afa3ae779bf3816dede"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/JNIAndJavaPlatform?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">info</a> on or <a href="/edit/Imported/JNIAndJavaPlatform?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FJNIAndJavaPlatform&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FJNIAndJavaPlatform&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=9d44b2036e800afa3ae779bf3816dede">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=PlatformAPIPages&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">PlatformAPIPages</a><wikitopic PlatformAPIPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (4 April 2000).</EM></P>
<H4>Introduction</H4>
<P>I wrote this article to illustrate a point. You can run more than one virtual machine in a native process. I would like to run this experiment in the confort of my own laboratory. I wish I had the talent to create a multiple threaded C program; but, I don't.</P>
<H4>Plan</H4>
<P>Install two (or more) virtual machines on a desktop operating system, like Linux or Windows. Both virtual machines must support the <a href="/view.php?topic=JavaNativeInterface&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">JavaNativeInterface</a><wikitopic JavaNativeInterface /wikitopic> Invocation API.</P>
<BLOCKQUOTE><EM>It is important for each virtual machine to have a unique module name.</EM></BLOCKQUOTE>
<P>Virtual machines from two different vendors are different virtual machines. <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">JDK</a> <wikitopic JDK /wikitopic>1.1 and <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">JDK</a> <wikitopic JDK /wikitopic>1.2 are two different virtual machines.</P>
<H4>Sample program</H4>
<P>Write a C/C++ program that loads two virtual machines in a single process. This program ends when both virtual machines have ended.</P>
<PRE>
  int main( int argc, char *argv[] ) {
	 createAppOne();
	 createAppTwo();
	 waitForAppOne();
	 waitForAppTwo();
  }
  void createVMOne() {
	 char *libname = "/jdk1.1.6/bin/libjavai.so";
	 char *command = "java -jar app1.jar";
	 createVMThread( libname, command );
  }
  void createVMTwo() {
	 char *libname = "/jdk1.2.2/bin/libjvm.so";
	 char *commandTwo = "java -jar app2.jar";
	 createVMThread( libname, command );
  }
</PRE>
<H4>About <nolink>JOS</H4>
<P>There is very little a classic virtual machine needs to do before it invokes the first line of a Java application. The classic design assumes a pre-existing user process. The classic design builds on a foreign operating system. A foreign operating system always provides a user process.</P>
<P>A virtual machine on a Java-based operating system must behave differently. The <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">JOS</a> <wikitopic JOS /wikitopic>design must not assume a pre-existing user process. The <nolink>JOS design does not build on a foreign operating system. A virtual machine usually provides its own user process.</P>
<P>A user process is not the only thing that does not exist yet. Device drivers do not exist yet. The network protocol stack doesn't eixst yet. The file subsystem doesn't exist yet.</P>
<P>Let's take a look at decaf. When decaf is invoked, the command line is one of the last things it should process. Before a command line is processed, decaf should invoke a system process. In turn, a system process must invoke start-up script. The start-up script should create one user process after another, with the system process as its parent.</P>
<UL>
<LI><P>device</P>
<P>A start-up script should invoke a user process for each device driver.</P>
<LI><P>daemon</P>
<P>A start-up script should invoke a user process for each daemon process. Both the system daemons and user daemons run as a user process.</P>
</UL>
<H4>Start-up script</H4>
<P>The start-up script is a list of URIs. Each <a href="/view.php?topic=URI&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">URI</a> <wikitopic URI /wikitopic>is invoked, one <a href="/view.php?topic=URI&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">URI</a> <wikitopic URI /wikitopic>at a time. The start-up script stops on the first non-zero result code. (If a <a href="/view.php?topic=URI&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">URI</a> <wikitopic URI /wikitopic>starts with "run:thread:" or "run:process:", the script does not wait for the <a href="/view.php?topic=URI&web=Imported&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">URI</a> <wikitopic URI /wikitopic>to run to completion.)</P>
<PRE>
// start-up script 1.0
run:program:jeps.InstallJEPS
run:thread:demo.SplashScreenProgram
run:program:bcni.InstallDeviceRegistry
run:program:smartapi.InstallSmartAPISupport
run:program:objectregistry.InstallObjectRegistry
run:thread:device.VGADriver
run:thread:device.Keyboard
run:thread:device.Mouse
run:program:device.InstallDevices
run:process:program:net.InstallNetworkRegistry
run:program:filesystem4.InstallFileSystem
run:program:bytecode.InstallCache?link=http://www.jos.org
run:process:program:telnetd.TelnetDaemon
run:process:program:ftpd.FtpDaemon
run:process:program:httpd.HttpDaemon
run:process:program:tftpd.TftpDaemon?debug=true
</PRE>
<H4>Command line</H4>
<P>decaf processes the custom command line after the system process is up and running. That way, the user process invoked by the command line can use devices, network and file subsystem.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FJNIAndJavaPlatform&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FJNIAndJavaPlatform&PHPSESSID=9d44b2036e800afa3ae779bf3816dede">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

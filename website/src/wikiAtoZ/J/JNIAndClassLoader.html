<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>JNIAndClassLoader.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="f0d9e6ca176cdbedbf6cb989a028aee5" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//JNIAndClassLoader?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JNIAndClassLoader</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/JNIAndClassLoader?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">info</a> on or <a href="/edit/Imported/JNIAndClassLoader?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FJNIAndClassLoader&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FJNIAndClassLoader&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE=-1><a href="/view.php?topic=ArchitectureGroup&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">ArchitectureGroup</a><wikitopic ArchitectureGroup /wikitopic>; <a href="/view.php?topic=JavaNativeInterface&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JavaNativeInterface</a><wikitopic JavaNativeInterface /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (26 August 1999).</EM>
<H4>Introduction</H4>
<P>From Sun's specification, there are problems with <CODE>java.lang.ClassLoader</CODE>. One of these problem comes from recursion. The other comes from <CODE>loadLibrary</CODE>.</P>
<P>When you have a shared library for native methods, how many instances of that library do you need?</P>
<H4>Recursion</H4>
<P>To get right to the point, let's suppose I have created three classes, <CODE>First</CODE>, <CODE>Second</CODE>, and <CODE>Third</CODE>.</P>
<OL>
<LI><CODE>First</CODE>
<P>The <CODE>First</CODE> class is loaded without a class loader object. It is loaded with the <a href="/view.php?topic=PrimordialClassLoader&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">PrimordialClassLoader</a><wikitopic PrimordialClassLoader /wikitopic>. It is a <EM>system class</EM>, a class where <CODE>getClassLoader() == null</CODE>.</P>
<P>This class can create <CODE>LoaderForSecond</CODE>, a class loader for the next class. When <CODE>First</CODE> creates <CODE>LoaderForSecond</CODE>, it must use the primordial class loader. It is the only class loader so far.</P>
<LI><CODE>Second</CODE>
<P>The <CODE>Second</CODE> class is loaded by a real class loader object. It is loaded with <CODE>LoaderForSecond</CODE>. It is a non-system class and its <CODE>getClassLoader()</CODE> returns an instance of <CODE>LoaderForSecond</CODE>.</P>
<P>This class can create <CODE>LoaderForThird</CODE>, a class loader for the next class. When <CODE>Second</CODE> creates <CODE>LoaderForThird</CODE>, which class loader does it use? It must use <CODE>LoaderForSecond</CODE>. It is the class loader closely associated with <CODE>Second</CODE>.</P>
<LI><CODE>Third</CODE>
<P>Here's where it gets interesting. The <CODE>Third</CODE> class is loaded by <CODE>LoaderForThird</CODE>. When <CODE>LoaderForThird</CODE> uses <CODE>findSystemClass()</CODE>, it ignores its own class loader and goes directly to the primordial class loader.</P>
<P>This is a problem. This is a big problem. When <CODE>LoaderForThird</CODE> is searching for existing classes both the primordial class loader and <CODE>LoaderForSecond</CODE> are available. Since <CODE>LoaderForThird</CODE> was created by <CODE>LoaderForSecond</CODE>, its <CODE>getClassLoader()</CODE> method returns <CODE>LoaderForSecond</CODE>.</P>
<P>When a class loader is written properly, it uses its own class loader to attempt to load a class, <EM>and only then</EM> it attempts to load a class from its own bytecode cache.</P>
</UL>
<H4>Real world example</H4>
<P>When you write an <a href="/view.php?topic=HTTP&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">HTTP</a> <wikitopic HTTP /wikitopic>service using the Java programming language, issues surrounding the class loader become big issues. Your <nolink>HTTP service should provide a servlet environment, just like other <nolink>HTTP services. You should be better off writing your <nolink>HTTP service in Java. You should be able to distribute configuration servlets in the same .jar file with your <nolink>HTTP service, right?</P>
<P>The <CODE>URLClassLoader</CODE> for JDKs 1.0 and 1.1 is defective. It does not use its own class loader to find classes. Instead it goes directly after the primordial class loader.</P>
<H4>Loading libraries</H4>
<P>There is a big difference between loading libraries in <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JDK</a> <wikitopic JDK /wikitopic>1.1 and <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JDK</a> <wikitopic JDK /wikitopic>1.2. While <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JDK</a> <wikitopic JDK /wikitopic>1.1 associates a shared library with a JVM, <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JDK</a> <wikitopic JDK /wikitopic>1.2 associates a shared library with a class loader. Each class loader must load its own instance of a shared library.</P>
<P>On the one hand, the <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JDK</a> <wikitopic JDK /wikitopic>1.2 model provides a way for shared libraries to be unloaded, without unloading the JVM. When a shared library is loaded, it becomes the responsibility of a class loader. When a class loader is finalized (after all its classes), the shared library is no longer usable and can be unloaded too.</P>
<P>On the other hand, the <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JDK</a> <wikitopic JDK /wikitopic>1.1 and 1.2 models are very different. Shared libraries from 1.1 are unaware of this change in the architecture. Your code may inadvertently create many instances of the same shared library.</P>
<H4>Java 0 Platform</H4>
<P>The <CODE>java.lang.ClassLoader</CODE> on the Java 0 Platform defined the </CODE>loadClass()</CODE> method with, as we know now, the wrong access. It should have been public, not protected.</P>
<P>So a class loader compiled for Java 0 might be compiled with a protected access for <CODE>loadClass()</CODE>. Running such a class loader will throw an <CODE>IllegalAccessException</CODE> in Java 1 and 2 Platforms.</P>
<H4>Incompatible</H4>
<P>There are a few new methods for the old <CODE>ClassLoader</CODE> class. It is much easier to load a class that cannot be loaded by parent class loaders. A class loader using Java 2 methods won't run on Java 0 and 1 Platforms. It didn't have to be this way.</P>
<P>Sun Microsystems could have created a new class. They could have created a new package. They could have made Java 2 completely backward compatible with Java 0 and 1.</P>
<P>We are building an operating system where these issues are front and center. <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JOS</a> <wikitopic JOS /wikitopic>cannot afford to be obsolete in six months after we spend three years getting it finished.</P>
<H4>Hybrid system</H4>
<P>I am experimenting with <A HREF="http://www.realignsoft.com/library/b/randos/randosintro.html">R&amp;D OS(tm)</A>. It is a Windows-specfic release of José 1d. Why am I creating a Windows-specific release? Because Microsoft Windows is still the most hostile Java sub-platform.</P>
<P>The <CODE>randos.exe</CODE> program is a native Win32 program. It is compiled with Borland C++ 5.01, with Java Add-On. It loads the <CODE>javai.dll</CODE> shared library from <a href="/view.php?topic=JRE&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JRE</a> <wikitopic JRE /wikitopic>1.1 or <a href="/view.php?topic=JRE&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JRE</a> <wikitopic JRE /wikitopic>1.2. It automatically sets the class path, so you don't have to. It automatically launches your browser/desktop/shell, so you don't have to. It automatically creates a primordial class loader, so you can restart your application without returning to Windows.</P>
<P>It uses native Windows processes for each Java process. The <CODE>System.exit()</CODE> method works without modification. It can run any Windows program. It uses the standard <CODE>Runtime.exec()</CODE> method to create each new process. It does not require a special JVM. It uses the <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JVM</a> <wikitopic JVM /wikitopic>from Sun Microsystems. When a new Java process it needed, <CODE>randos.exe</CODE> runs another copy of itself. It is like <CODE>fork()</CODE> in UNIX(tm) and Linux(R).</P>
<P>I am frequently required to run Java programs from CD. One of the things I like about this, the <CODE>randos.exe</CODE> program can be completely self-contained on a CD. The entire hybrid program can be written on CD and run on any machine, completely without installation.</P>
<P>At this time, <CODE>randos.exe</CODE> uses Package Manager - Release 1e. Custom Java bytecode is stored in package files. The classes.zip and jsdk.jar are the only bytecode archives.</P>
<H4>Sub-platform</H4>
<P>With the release of Java 2 Platform, all other platforms have become sub-platforms for Java. Your favorite operating system has become a sub-operating system (SOS). That puts Microsoft Windows in its place, as a sub-platform for Java. It also puts UNIX(tm) and Linux(R) and OS/2(tm) and OS/400(tm) in their place as a sub-platform. Java, the platform, isn't far from Java, the operating system.</P>
<H4>JavaOS</H4>
<P>There is no compelling reason for people to trade in their US$500 personal computer for a US$400 network computer. People don't want a new operating system for some other machine. They want a new operating system for the machine they already have.</P>
<P>JOS is an operating system for the personal computer, not network computer. <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JOS</a> <wikitopic JOS /wikitopic>has a bright future. It doesn't have to go the way of the <a href="/view.php?topic=JavaOS&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">JavaOS</a><wikitopic JavaOS /wikitopic>. If Sun couldn't get <nolink>JavaOS to work on a PC, what made them think they could make it work on an NC? The PC is much easier to work with because it has a sub-operating system.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FJNIAndClassLoader&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FJNIAndClassLoader&PHPSESSID=f0d9e6ca176cdbedbf6cb989a028aee5">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>DecodingEmbeddedURI.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="002b7f25eb9043f3e98a319b535a5c6e" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//DecodingEmbeddedURI?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">DecodingEmbeddedURI</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/DecodingEmbeddedURI?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">info</a> on or <a href="/edit/Imported/DecodingEmbeddedURI?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FDecodingEmbeddedURI&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FDecodingEmbeddedURI&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=EmbeddedURIs&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">EmbeddedURIs</a><wikitopic EmbeddedURIs /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (23 February 2000).</EM></P>
<H4>Introduction</H4>
<P>With an embedded URI, a requestor can pass one <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>as a parameter to another. With the <a href="/view.php?topic=ERICProject&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">ERICProject</a><wikitopic ERICProject /wikitopic>, a location is passed to a <CODE>Shell</CODE> as a parameter. The location is a URI.</P>
<H4>Example</H4>
<P>The following <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>runs a demo program. It can be typed directly into the location field of <a href="/view.php?topic=UniversalBrowser&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">UniversalBrowser</a><wikitopic UniversalBrowser /wikitopic> shell.</P>
<PRE>
run:program:FindProgram?path=C:&amp;extension=.html&amp;show=all
</PRE>
<P>The "find" program is a mythical program that searches a path for all files with a given extension. When the <CODE>show=all</CODE> option is used, the search is repeated for subdirectories. (I'd like to have such a program.)</P>
<P>Technically, this is a malformed URI. The colon (:) and backslash () characters in <CODE>C:</CODE> are supposed to be encoded, using <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>encoding. This kind of encoding uses a percent sign and two-digit hexidecimal value.</P>
<H4>Special characters</H4>
<P>The following table contains special characters and their <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>encoding:</P>
<TABLE BORDER="1">
<TR>
<TD>
<FONT FACE="Arial">Plain Text</FONT>
</TD>
<TD>
<FONT FACE="Arial">URI Encoding</FONT>
</TD>
</TR>
<TR>
<TD>
<CODE>%</CODE>
</TD>
<TD>
<CODE>%nn</CODE>
</TD>
</TR>
<TR>
<TD>
<CODE>=</CODE>
</TD>
<TD>
<CODE>%nn</CODE>
</TD>
</TR>
<TR>
<TD>
<CODE>:</CODE>
</TD>
<TD>
<CODE>%nn</CODE>
</TD>
</TR>
<TR>
<TD>
<CODE>?</CODE>
</TD>
<TD>
<CODE>%nn</CODE>
</TD>
</TR>
<TR>
<TD>
<CODE>&amp;</CODE>
</TD>
<TD>
<CODE>%nn</CODE>
</TD>
</TR>
<TR>
<TD>
<CODE></CODE>
</TD>
<TD>
<CODE>%nn</CODE>
</TD>
</TR></TABLE>
<H4>How a program invokes another</H4>
<P>This is how one program invokes another. An entire <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>is passed to the <CODE>exec()</CODE> method as a parameter.</P>
<PRE>
  public void example() {
	 String location =
"run:program:FindProgram?path=C:&amp;extension=.html&amp;show=all";
	 exec( location );
  }
</PRE>
<H4>How a shell script invokes a program</H4>
<P>This is how a shell script invokes a program. The entire <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>is passed to a shell as a parameter.</P>
<PRE>
  public void example() {
	 String location =
"run:program:FindProgram?path=C:&amp;extension=.html&amp;show=all";
	 Shell s = new BasicShell();
	 s.onLocationSelection( location );
  }
</PRE>
<H4>Embedded URI</H4>
<P><CODE>MainShell</CODE> is a program that expects a parameter called <CODE>location</CODE>. The following <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>illustrates a <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>with an embeded URI. The embedded <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>is passed as a parameter:</P>
<PRE>
  public void example() {
	 String location = "run:program:DemoProgram";
	 String s = URITool.getTool().encode( location );
	 URI uri = new URI( "run:program:MainShell?location=" + s );
	 Program p = (Program) uri.getObject();
	 :
  }
</PRE>
<P>The colon (:), question mark (?), amperstand (&amp;amp) and equal sign (=) are encoded with <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>encoding. That's what the <CODE>encode()</CODE> method is for. It converts location from
<PRE>
run:program:DemoProgram
</PRE>
to
<PRE>
run%nnprogram%nnDemoProgram
</PRE>
<P>Here is an example using the find program.</P>
<PRE>
  public void example() {
	 String location =
"run:program:FindProgram?path=C:&amp;extension=.html&amp;show=all";
	 String s = URITool.getTool().encode( location );
	 URI uri = new URI( "run:program:MainShell?location=" + s );
	 Program p = (Program) uri.getObject();
	 :
  }
</PRE>
<P>The <CODE>encode()</CODE> method converts location from
<PRE>
run:program:FindProgram?path=C:&amp;extension=.html&amp;show=all
</PRE>
to
<PRE>
run%nnprogram%nnFindProgram
%nnpath%nnC%nn%nn%nnextension%nn%nnhtml%nnshow%nnall
</PRE>
<H4>Decoding</H4>
<P>At some point an embedded <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>must be decoded. A program expects a value to be passed as plain text. It does not expect a value in its encoded form.</P>
<P>The embedded <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>must be decoded when a program asks for a value by name. A program context automatically decodes a value. It passes each value through the <CODE>URITool.decode()</CODE> method. This <CODE>decode()</CODE> method searches for the percent character (%) and replaces it with a single decoded character.</P>
<PRE>
  public String decode( String v ) {
	 int pos = v.indexOf( "%" );
	 if ( pos &lt; 0 ) {
		return v;
	 }

	 String ch = hex2char( v.substring( pos + 1, pos + 2 ) );
	 String restOfLine = decode( v.substring( pos + 3 ) );
	 return v.substring( 0, pos ) + ch + restOfLine;
  }
  protected String hex2char( String v ) {
	 String s = cache.get( v );
	 if ( s == null ) {
		return " ";
	 }
	 return s;
  }
</PRE>
<P>Assuming there are few encoded characters, this method performs well enough. It might be worth the effort to optimize this method using <CODE>java.lang.StringBuffer</CODE> if every character were encoded.</P>
<P>The greatest optimization comes from storing all 256 characters and their encoded form in a hash table. The hash table is created once (when the class is initialized) and used frequently to exchange a two-character encoded form to a single character string.</P>
<H4>Value</H4>
<P>When a parameter is passed to a program, it is passed through the mechanism of a program context. All programs must be able to deal with embedded URIs consistently, so program context decodes the value of each parameter.</P>
<H4>Recursive</H4>
<P>The mechanism is recursive. Even the percent character can be encoded.</P>
<H4>When to encode</H4>
<P>Values must be encoded when the <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>is put together. If arbitrary values are passed to your program, you must encode each value before adding it to a URI.</P>
<PRE>
  public void example( String v1, String v2, String v3 ) {
	 StringBuffer buffer = new StringBuffer();
	 buffer.append( "run:program:DemoProgram?" );
	 buffer.append( "n1=" + URITool.getTool().encode( v1 ) );
	 buffer.append( "&amp;n2=" + URITool.getTool().encode( v2 ) );
	 buffer.append( "&amp;n3=" + URITool.getTool().encode( v3 ) );
	 URI uri = new URI( buffer.toString() );
	 Program p = (Program) uri.getObject();
	 :
  }
</PRE>
<H4>Non-example</H4>
<P>The following code will not work correctly:</P>
<PRE>
  public void example( String v1, String v2, String v3 ) {
	 String s =
		  "run:program:MainShell?" +
		  "n1=" + v1 +
		  "&amp;n2=" + v2 +
		  "&amp;n3=" + v3;
	 URI uri = new URI( URITool.getTool().encode( s ) );
	 Program p = (Program) uri.getObject();
	 :
  }
</PRE>
<H4>Multiple process</H4>
<P>The run: scheme will enable a program to run on another process. The <a href="/view.php?topic=SmartAPI&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">SmartAPI</a><wikitopic SmartAPI /wikitopic> returns an instance of <CODE>Program</CODE> even when a program is running in another process. The <CODE>exec()</CODE> method is the same; the <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>is different. To run a program in another process, use <CODE>localhost</CODE>.</P>
<PRE>
run:program://localhost/DemoProgram
or
run:program://localhost:&lt;EM&gt;port&lt;/EM&gt;/DemoProgram
</PRE>
<P>Note: The program service must be running on the local machine. The program service is implemented through programd, a program service daemon.</P>
<H4>Multiple machines</H4>
<P>The run: scheme will enable a program to run on another machine. The <a href="/view.php?topic=SmartAPI&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">SmartAPI</a><wikitopic SmartAPI /wikitopic> returns an instance of <CODE>Program</CODE> even when a program is running on another machine. The <CODE>exec()</CODE> method is the same; the <a href="/view.php?topic=URI&web=Imported&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">URI</a> <wikitopic URI /wikitopic>is different. To run a program on another machine, use its machine name.</P>
<PRE>
run:program://josdemo/DemoProgram
or
run:program://josdemo:&lt;EM&gt;port&lt;/EM&gt;/DemoProgram
</PRE>
<P>Note: The program service must be running on another machine. The program service is implemented through programd, a program service daemon.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FDecodingEmbeddedURI&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FDecodingEmbeddedURI&PHPSESSID=002b7f25eb9043f3e98a319b535a5c6e">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>DriverAndIPC.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="d599096fc308c1ef633958fcbc168320" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=d599096fc308c1ef633958fcbc168320">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=d599096fc308c1ef633958fcbc168320">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=d599096fc308c1ef633958fcbc168320">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=d599096fc308c1ef633958fcbc168320">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=d599096fc308c1ef633958fcbc168320">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//DriverAndIPC?PHPSESSID=d599096fc308c1ef633958fcbc168320">DriverAndIPC</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=d599096fc308c1ef633958fcbc168320">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=d599096fc308c1ef633958fcbc168320" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=d599096fc308c1ef633958fcbc168320"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/DriverAndIPC?PHPSESSID=d599096fc308c1ef633958fcbc168320">info</a> on or <a href="/edit/Imported/DriverAndIPC?PHPSESSID=d599096fc308c1ef633958fcbc168320">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FDriverAndIPC&PHPSESSID=d599096fc308c1ef633958fcbc168320">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FDriverAndIPC&PHPSESSID=d599096fc308c1ef633958fcbc168320">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=d599096fc308c1ef633958fcbc168320">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=d599096fc308c1ef633958fcbc168320">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=d599096fc308c1ef633958fcbc168320">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ArchitectureGroup&PHPSESSID=d599096fc308c1ef633958fcbc168320">ArchitectureGroup</a><wikitopic ArchitectureGroup /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=d599096fc308c1ef633958fcbc168320">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (25 April 2000).</EM></P>
<H4>Introduction</H4>
<P>A low-level device driver is usually part of the system process. An open-ended architecture provides room for countless driver initialization programs. Most driver initialization programs are not part of the core, but are loaded dynamically.</P>
<H4>Diagram</H4>
<P>The following diagram illustrates low-level drivers in a system process and a high-level driver in a user process.</P>
<TABLE BORDER="1" CELLPADDING="8" BGCOLOR="lightblue">
<TR>
<TD>
virtual machine
<UL>
<LI>IPC support
</UL>
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="khaki">
<TR>
<TD VALIGN="TOP">
<FONT SIZE="+1">System Process</FONT>
<UL>
<LI>driver manager
<LI>VGA driver
<LI>keyboard driver
<LI>comm port 0 driver
<LI>comm port 1 driver
<LI>parallel port 0 driver
<LI>mouse driver
<LI>IDE driver
<LI>SCSI driver
<LI>CD-ROM driver
<LI>modem 0 driver
</UL>
</TD>
<TD VALIGN="TOP">
<FONT SIZE="+1">User Process 1</FONT>
<UL>
<LI>modem 0 proxy
</UL>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<H4>Components</H4>
<P>Here are the hardware components of my <nolink>JOS machine.</P>
<UL>
<LI>VGA video board
<LI>serial port 0
<LI>serial port 1
<LI>parallel port 0
<LI>IDE controller
<LI>network interface card
</UL>
<P>A serial mouse is plugged into serial port 0. A modem is plugged into serial port 1. A printer is plugged into parallel port 0.</P>
<H4>Sequence</H4>
<P>The start-up script runs the following driver initialization programs. For more information, see also <a href="/view.php?topic=DriverInitProgram&PHPSESSID=d599096fc308c1ef633958fcbc168320">DriverInitProgram</a><wikitopic DriverInitProgram /wikitopic>.</P>
<OL>
<LI><CODE>VGADriverInit</CODE>
<P>This program detects <a href="/view.php?topic=VGA&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">VGA</a> <wikitopic VGA /wikitopic>video adapter hardware. If the hardware exists, a <a href="/view.php?topic=VGA&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">VGA</a> <wikitopic VGA /wikitopic>driver is plugged into the driver manager as a video driver. My machine has a <a href="/view.php?topic=VGA&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">VGA</a> <wikitopic VGA /wikitopic>video adapter, so the <CODE>VGADriverInit</CODE> program installs a <a href="/view.php?topic=VGA&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">VGA</a> <wikitopic VGA /wikitopic>driver.</P>
<LI><CODE>KeyboardInit</CODE>
<P>This program detects all keyboards. A new instance of a keyboard driver is plugged into the driver manager. My machine has a keyboard, so the <CODE>KeyboardInit</CODE> program installs a keyboard driver. The keyboard driver might reset the keyboard, program the keyboard and provide personal preferrences for special keys, such as <CODE>NumLock</CODE>, <CODE>CapsLock</CODE> and <CODE>ScrollLock</CODE>.</P>
<LI><CODE>SerialPortInit</CODE>
<P>This program detects all serial ports. A new instance of a serial port driver is plugged in for each serial port. My machine has serial port 0 and 1, so the <CODE>SerialPortInit</CODE> program installs two serial port drivers. When installed, each serial port is not in use.</P>
<LI><CODE>SerialMouseInit</CODE>
<P>This program detects a serial mouse. It opens serial port 0 (if possible) through a serial port driver. While open, a serial port driver is in use so that no other component can attach to it. My machine has a mouse attached to serial port 0, so the <CODE>SerialMouseInit</CODE> program installs one mouse driver. Since serial port 0 is in use by a mouse driver, no other component can open it.</P>
<LI><CODE>ModemInit</CODE>
<P>This program detects a modem. It opens serial port 1 (if possible) through a serial port driver. While open, a serial port driver is in use so that no other component can attach to it. My machine has a modem attached to serial port 0, so the <CODE>ModemInit</CODE> program installs one modem driver. Since serial port 1 is in use by a modem driver, no other component can open it.</P>
<LI><CODE>PrinterInit</CODE>
<P>This program detects a printer. It opens printer port 0 (if possible) through a parallel port driver. While open, a parallel port driver is in use so that no other component can attach to it. My machine has a printer attached to parallel port 0, to the <CODE>PrinterInit</CODE> program installs one printer driver. Since parallel port 0 is in use by a printer driver, no other component can open it.</P>
</UL>
<H4>Driver</H4>
<P>The critical property of a driver is its in-use property. Since there is no upper limit on how many drivers an operating system might have, the in-use property is part of each <CODE>Driver</CODE> (or <CODE>DriverHolder</CODE>).</P>
<PRE>
public interface Driver {
  public boolean isInUse();
  public void setInUse( boolean v );
}
</PRE>
<P>The driver manager sets the "in-use" property. This property is <CODE>true</CODE> when a driver is in use. Otherwise, it is <CODE>false</CODE>. This property is changed when a driver is opened or closed. It is set to <CODE>true</CODE> when a driver is opened, set to <CODE>false</CODE> when a driver is closed.</P>
<P>When implemented, both <CODE>isInUse()</CODE> and <CODE>setInUse()</CODE> should be <CODE>synchronized</CODE> so that they are thread safe.</P>
<P>A driver can be opened and closed.</P>
<PRE>
  public synchronized void open()
		throws InUseException {
	 if ( isInUse() ) {
		throw new InUseException();
	 }
	 setInUse( true );
  }
  public synchronized void close() {
	 if ( !isInUse() ) {
		throw new InUseException();
	 }
	 setInUse( false );
  }
</PRE>
<H4>System process</H4>
<P>A low-level driver runs inside a system process. The system process provides additional privileges for a driver not found in a user process.</P>
<P>In a system process, the actual driver may be returned by <a href="/view.php?topic=BytecodeNativeInterface&PHPSESSID=d599096fc308c1ef633958fcbc168320">BytecodeNativeInterface</a><wikitopic BytecodeNativeInterface /wikitopic>, or BCNI. No inter-process communication is required because all drivers run in the system process. No proxy is required because there is no inter-process communication.</P>
<H4>User process</H4>
<P>Any component in a user process can open a driver if it is not in-use. The actual driver cannot be returned by BCNI. Inter-process communication is required because a component is in a user process and a driver is in the system process. A proxy is required because there is inter-process communication.</P>
<P>The communication between a proxy and its driver is through the regular network protocol stack. Communication is pumped through the protocol stack in the same way as all other inter-process communication.</P>
<P>A driver and a proxy for a driver implement a common interface. The interface is requested through BCNI. Neither a driver nor a proxy for a driver is requested through BCNI. In the system process, <a href="/view.php?topic=BCNI&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">BCNI</a> <wikitopic BCNI /wikitopic>might return a driver or a proxy for a driver. In a user process, <a href="/view.php?topic=BCNI&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">BCNI</a> <wikitopic BCNI /wikitopic>always returns a proxy for a driver.</P>
<H4>Window manager</H4>
<P>If a window manager is started, it might open a mouse driver (if possible) and set itself up as a mouse listener. The mouse driver delegates all of its events to the window manager. While the mouse driver is open in the window manager, no other component can open the mouse driver.</P>
<P>In turn, a window manager dispatches incoming mouse events to the component that has "focus". A window manager might filter mouse events. For example, a series of mouse events may be reduced to a single double-click event.</P>
<H4>Modem application</H4>
<P>A modem application uses a modem driver. A modem driver may be able to dial a number and broadcast a connect event upon successful connection.</P>
<P>A modem application runs in a user process. Through BCNI, a modem application requests the modem interface. <a href="/view.php?topic=BCNI&web=Imported&PHPSESSID=d599096fc308c1ef633958fcbc168320">BCNI</a> <wikitopic BCNI /wikitopic>returns a proxy to a modem interface if a modem device is not in use. The modem application uses the modem proxy as if it were a modem device. Both a modem device and its proxy implement a common interface.</P>
<P>When a modem application closes a modem driver (or a modem proxy is finalized), a modem driver is no longer in use; it can be used by other components and other user processes.</P>
<H4>Summary</H4>
<P>A driver can run inside a system or user process. A driver can run on another machine.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FDriverAndIPC&PHPSESSID=d599096fc308c1ef633958fcbc168320">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FDriverAndIPC&PHPSESSID=d599096fc308c1ef633958fcbc168320">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>AboutJJOSVersion3a.Main @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="d6f72d438546532fa4395791a280de09" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=d6f72d438546532fa4395791a280de09">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=d6f72d438546532fa4395791a280de09">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=d6f72d438546532fa4395791a280de09">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=d6f72d438546532fa4395791a280de09">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=d6f72d438546532fa4395791a280de09">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//AboutJJOSVersion3a?PHPSESSID=d6f72d438546532fa4395791a280de09">AboutJJOSVersion3a</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Main/?PHPSESSID=d6f72d438546532fa4395791a280de09">Main</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=d6f72d438546532fa4395791a280de09" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=d6f72d438546532fa4395791a280de09"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Main/AboutJJOSVersion3a?PHPSESSID=d6f72d438546532fa4395791a280de09">info</a> on or <a href="/edit/Main/AboutJJOSVersion3a?PHPSESSID=d6f72d438546532fa4395791a280de09">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FAboutJJOSVersion3a&PHPSESSID=d6f72d438546532fa4395791a280de09">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FAboutJJOSVersion3a&PHPSESSID=d6f72d438546532fa4395791a280de09">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Main/?PHPSESSID=d6f72d438546532fa4395791a280de09">topics</a>, <a href="/hubsnodes/Main/?PHPSESSID=d6f72d438546532fa4395791a280de09">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Main/?PHPSESSID=d6f72d438546532fa4395791a280de09">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<a href="/view.php?topic=JJOSPages&PHPSESSID=d6f72d438546532fa4395791a280de09">JJOSPages</a><wikitopic JJOSPages /wikitopic>
<HR>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=d6f72d438546532fa4395791a280de09">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (10 March 2003).</EM>
<H4>Introduction</H4>
"decaf3a" is a new module in <nolink>JJOS <nolink>CVS on sourceforge.net. It contains Decaf 3a, an abstract virtual machine. The target platform is i386 (through Etherboot and GRUB), Linux and Microsoft Windows.
<H4>Tree</H4>
The following diagram illustrates the main directory tree.
<PRE>
decaf3a module in JJOS CVS on sourceforge.net
  -- bin
  -- cpp
  ---- build
  ------ etherboot
  ------ grub
  ------ linux
  ------ win32
  ---- src
  ------ decaf
  ------ i386
  ------ include
  ------ linux
  ------ jjos
  -------- gc
  -- java
  ---- build
  ------ i386
  ------ linux
  ---- src
  ------ common
  ------ i386
  ------ linux
  -- jjos1f
</PRE>
<H4>How we turned version 1f into version 3a</H4>
<OL> <LI> Check out version 1f from the jjos1f module to decaf3a/jjos1f.
<LI> <STRONG>Sanity check.</STRONG> Create class files from the Java source code. The Java source code will not compile cleanly as committed to the jjos1f module. The following classes are no longer required and licensed under the <nolink>GNU <nolink>GPL: <CODE>decaf.host.<nolink>HostFactory</CODE>, <CODE>decaf.i386.<nolink>i386Factory</CODE> and <CODE>org.jos.bcni1a.Factory</CODE>.
<LI> <STRONG>Sanity check.</STRONG> Create the i386 build and the Linux (host) build as is. The i386 build includes the Etherboot- and GRUB-compatible executable images.
</OL> For Java
<OL> <LI> Copy Java source code from jjos1f/common/bytecode to java/src/common.
<LI> Copy Java source code from jjos1f/arch/i386/bytecode to java/src/i386.
<LI> Copy Java source code from jjos1f/arch/host/bytecode to java/src/linux.
<LI> Add the decaf.build2a package (from jjos2a).
<LI> Add the decaf.host.driver2a package (from jjos2a).
<LI> Add the decaf.i386.driver2a package (from jjos2a).
<LI> Run the import.mc.txt script in the java/build/i386 directory; compile the Java source code; build the decaf-i386 archive without compression.
<LI> Run the import.mc.txt script in the java/build/linux directory; compile the Java source code; build the decaf-linux archive without compression.
<LI> Rename a class from jos.platform.keyboard to jos.platform.<nolink>StandardKeyboard. Rework the <nolink>StandardKeyboard source code to load the platform-specific jos.platform.driver.<nolink>CustomKeyboard class directly. Add the initWith() method.
<LI> Rename a class from jos.platform.init to jos.platform.<nolink>PlatformInit.
<LI> Rename a class from jos.platform.driver.keyboard to jos.platform.driver.CustomKeyboard in the java/src/linux directory.
<LI> Introduce the <nolink>LinuxInit, init and <nolink>TestSuite classes in the java/src/linux directory.
<LI> Rename a class from jos.platform.driver.keyboard to jos.platform.driver.CustomKeyboard in the java/src/i386 directory.
<LI> Introduce the <nolink>I386Init, init and <nolink>TestSuite classes in the java/src/i386 directory.
<LI> Introduce the <nolink>decaf.BcniInit, <nolink>decaf.BcniTestSuite, <nolink>decaf.DecafInit and <nolink>decaf.DecafTestSuite classes in the java/src/common directory.
<LI> Upgrade the decaf.build package from version 2a to 3a.
<LI> Upgrade the decaf.host.driver package from version 2a to 3a.
<LI> Upgrade the decaf.i386.driver package from version 2a to 3a.
</OL> For C++
<OL> <LI> Copy C++ source code from jjos1f/common/decaf to cpp/src/decaf.
<LI> Copy C++ source code from jjos1f/common/nativecode to cpp/src/jjos.
<LI> Copy C source code from jjos1f/common/nativecode/gc to cpp/src/jjos/gc.
<LI> Copy C++ source code from jjos1f/arch/i386/nativecode to cpp/src/i386.
<LI> Copy C++ source code from jjos1f/arch/host/nativecode to cpp/src/linux.
<LI> Rename all C++ source code files from *.cc to *.cpp.
<LI> Create a new Makefile in each of the cpp/build directories.
<LI> Create the <nolink>Makefile-rules script for common rules for compiling. This script contains the CF.. variables for setting your development options. To disable an option, turn it into a comment.
<LI> Create the <nolink>Makefile-host script for source code in the cpp/src/host directory.
<LI> Create the <nolink>Makefile-i386 script for source code in the cpp/src/i386 directory.
<LI> Create the <nolink>Makefile-decaf script for source code in the cpp/src/decaf directory.
<LI> Create the <nolink>Makefile-jjos script for source code in the cpp/src/jjos directory.
<LI> Create the <nolink>Makefile-jjos-gc script for source code in the cpp/src/jjos/gc directory.
<LI> Create the cpp/include/jjos/stdlib.h header file. Update the C++ source code from #include "stdlib.h" to #include &lt;jjos/stdlib.h&gt;.
<LI> Where C++ source code has included .cc files, switch to .cpp files.
</OL> <H4>Java build</H4>
Here are some facts about the Java source code.
<UL> <LI> The original source is found in the java/src directory. This is where you can edit the Java source code using your favorite text editor.
<LI> Source code is copied from java/src to java/build using the Package Copier program, part of the <nolink>CjOS Project.
<UL> <LI> For the i386 build, source code is copied from both java/src/common and java/src/i386. Code is compiled in the java/build/i386 directory. The target ZIP-compatible archive is decaf-i386.zip.
<LI> For the linux build, source code is copied from both java/src/common and java/src/linux. Code is compiled in the java/build/linux directory. The target archive is decaf-linux.zip.
</UL> <LI> The finished archives are copied to the bin directory.
</UL> <H4>C++ build</H4>
Here are some facts about the C++ source code.
<UL> <LI> The original C++ source code is found in the cpp/src directory. This is where you can edit the C++ source code using your favorite text editor.
<LI> Source code is compiled in a cpp/build directory.
<UL> <LI> For the Etherboot build, code is compiled in the cpp/build/etherboot directory. The target executable file is decaf3a-nbi.
<LI> For the <nolink>GRUB build, code is compiled in the cpp/build/grub directory. The target executable file is decaf3a-grub.
<LI> For the Linux build, code is compiled in the cpp/build/linux directory. The target executable file is decaf3a.
<LI> For the Microsoft Windows build, code is compiled in the cpp/build/win32 directory. The target executable file is decaf3a.exe, decaf3a.dll, etc.
</UL> <LI> The finished executable files are copied to the bin directory.
</UL> <H4>How to start decaf on the Linux platform</H4>
<OL> <LI> cd bin
<LI> ./decaf3a
</OL> or
<OL> <LI> cd bin
<LI> ./decaf3a init
</OL> or
<OL> <LI> cd bin
<LI> ./decaf3a <nolink>TestSuite
</OL> <H4>How to start decaf on the <nolink>GRUB platform</H4>
<OL> <LI> Boot with a <nolink>GRUB boot disk.
<LI> kernel is <CODE>decaf3a-grub init</CODE>
<LI> alternatively, kernel is <CODE>decaf3a-grub <nolink>TestSuite</CODE>
<LI> module is <CODE>decaf3a-i386.zip</CODE>
</OL> <H4>How to start decaf on the Microsoft Windows platform</H4>
<OL> <LI> click (or double-click) the decaf3a.exe program.
</OL> or
<OL> <LI> cd bin
<LI> decaf3a.exe <nolink>TestSuite
</OL> <H4>Building for Etherboot</H4>
The following commands are used to build for Etherboot:
<OL> <LI> cd cpp/build/etherboot
<LI> make
<LI> make install
</OL> <H4>Building for <nolink>GRUB</H4>
<OL> <LI> cd cpp/build/grub
<LI> make
<LI> make install
</OL> <H4>Building for Linux</H4>
<OL> <LI> cd cpp/build/linux
<LI> make
<LI> make install</OL> <BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FAboutJJOSVersion3a&PHPSESSID=d6f72d438546532fa4395791a280de09">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FAboutJJOSVersion3a&PHPSESSID=d6f72d438546532fa4395791a280de09">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>AltPackageAndKore.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="8bc82e739d6772641b87cc66624bf281" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//AltPackageAndKore?PHPSESSID=8bc82e739d6772641b87cc66624bf281">AltPackageAndKore</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=8bc82e739d6772641b87cc66624bf281" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=8bc82e739d6772641b87cc66624bf281"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/AltPackageAndKore?PHPSESSID=8bc82e739d6772641b87cc66624bf281">info</a> on or <a href="/edit/Imported/AltPackageAndKore?PHPSESSID=8bc82e739d6772641b87cc66624bf281">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FAltPackageAndKore&PHPSESSID=8bc82e739d6772641b87cc66624bf281">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FAltPackageAndKore&PHPSESSID=8bc82e739d6772641b87cc66624bf281">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=8bc82e739d6772641b87cc66624bf281">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=AltPackagePages&PHPSESSID=8bc82e739d6772641b87cc66624bf281">AltPackagePages</a><wikitopic AltPackagePages /wikitopic>; <a href="/view.php?topic=JVMPages&PHPSESSID=8bc82e739d6772641b87cc66624bf281">JVMPages</a><wikitopic JVMPages /wikitopic>; <a href="/view.php?topic=Kore&PHPSESSID=8bc82e739d6772641b87cc66624bf281">Kore</a><wikitopic Kore /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=8bc82e739d6772641b87cc66624bf281">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (7 February 2000); revised (13 March 2000).</EM></P>
<H4>Introduction</H4>
<P>I am taking the <CODE>alt.<STRONG></CODE> packages project in a new direction. It seems that my <CODE>alt.</STRONG></CODE> package design was inadequate for independent, parallel development of alternative standard class libraries. The <CODE>alt</CODE> package has been moved to <CODE>alt.bridge1a</CODE>. The <CODE>alt.test</CODE> package has been moved to <CODE>org.jos.gchii.test1a</CODE>. The <CODE>Native<EM>XXX</EM></CODE> classes have been renamed to <CODE><EM>XXX</EM>Bridge</CODE>.</P>
<H4>Example: Get a class name.</H4>
<P>For any given class c, the class name must be available at runtime. Where is the class name stored? Typically, it's a JVM-specific detail. Each virtual machine can store it differently.</P>
<P>The following two methods are identical in function. They return the name of a given class. The first example is more "object-oriented" than the second. The second example is more flexible when creating a standard class library for many implementations of a virtual machine.</P>
<UL>
<LI><P>Example 1</P>
<PRE>
public class Class {
  :
  public native String getName();
  :
}
</PRE>
<LI><P>Example 2</P>
<PRE>
public interface LangBridge {
  :
  public String ClassGetName( Class c );
  :
}
</PRE>
</UL>
<P>Since these are equivalent functions, the security aspects of a virtual machine should be identical for both.</P>
<H4>Switch</H4>
<P>In a traditional virtual machine, the <a href="/view.php?topic=BCNI&web=Imported&PHPSESSID=8bc82e739d6772641b87cc66624bf281">BCNI</a> <wikitopic BCNI /wikitopic>factory returns a class that implements <CODE>ClassGetName()</CODE> like this:</P>
<PRE>
class TraditionalLangBridge
	 implements LangBridge {
  :
  public String ClassGetName( Class c ) {
	 return c.getName();
  }
  :
}
</PRE>
<P>In an advanced virtual machine, like decaf, the <a href="/view.php?topic=BCNI&web=Imported&PHPSESSID=8bc82e739d6772641b87cc66624bf281">BCNI</a> <wikitopic BCNI /wikitopic>factory returns a class that implements <CODE>ClassGetName()</CODE> like this:</P>
<PRE>
class DecafLangBridge
	 implements LangBridge {
  :
  public native String ClassGetName( Class c );
  :
}
</PRE>
<P>In JNI, the C subroutine would be something like this:
<PRE>
jstring
Java_DecafLangBridge_ClassGetName( JEnv *, jclass t, jclass c );
</PRE>
<H4>About Kore</H4>
<P>I have switched to <a href="/view.php?topic=Kore&PHPSESSID=8bc82e739d6772641b87cc66624bf281">Kore</a><wikitopic Kore /wikitopic> 0.0.7. I decided to switch after failing to make any progress whatsoever with code from <a href="/view.php?topic=ClasspathProject&PHPSESSID=8bc82e739d6772641b87cc66624bf281">ClasspathProject</a><wikitopic ClasspathProject /wikitopic>.</P>
<P>With Kore, I have accomplished the following goals.</P>
<UL>
<LI><P>Compiling Kore successfully.</P>
<P>Using the bulkmake tool for the Java 0 Platform, I compiled all classes from Kore 0.0.7 on my computer. It was relatively easy. I configured bulkmake with <CODE>platform=java0</CODE> and pressed the Run button.</P>
<LI><P>Copying Kore to <CODE>alt.*</CODE></P>
<P>I copied Kore source code from <CODE>java.<STRONG></CODE> to <CODE>alt.</STRONG></CODE>, using the following package names.</P>
<PRE>
kore.alt1a.applet
kore.alt1a.awt
kore.alt1a.image
kore.alt1a.io
kore.alt1a.lang
kore.alt1a.net
kore.alt1a.peer
kore.alt1a.util
</PRE>
</UL>
I have started working in <CODE>kore.alt1a.lang</CODE> (previously <CODE>java.lang</CODE>). I am using a methodical approach, modifying one class at a time. I am focusing on one package at a time. As I add classes, I am refining the following interfaces:</P>
<PRE>
alt.bridge1a.AWTBridge
alt.bridge1a.LangBridge
alt.bridge1a.IOBridge
alt.bridge1a.NetBridge
alt.bridge1a.UtilBridge
</PRE>
<P>Like Kore, I am <EM>concentrating</EM> native methods together. Native methods are limited to a few JVM-specific objects, or bridges, rather than spread throughout the standard class library. For alternative standard library to work, native methods are prohibited from <CODE>java.*</CODE> packages. Unlike Kore, I am using pure interfaces with no native methods, rather than abstract classes with pre-defined native methods. These interfaces are compatible with <a href="/view.php?topic=BytecodeNativeInterface&PHPSESSID=8bc82e739d6772641b87cc66624bf281">BytecodeNativeInterface</a><wikitopic BytecodeNativeInterface /wikitopic>.</P>
<P>Rather than re-implement the standard class library, it is possible to build a virtual machine that maps from native methods in a standard class library to methods of a JVM-specific factory. When a native method is detected by a virtual machine, it must mangle that method's name into a call to its own JVM-specific bridge.</P>
<H4>Lessons learned</H4>
<P>After starting down the road to develop an alternative standard library, I am pleased with the results so far. It is only a matter of time to develop alternative packages.</P>
<UL>
<LI><P><STRONG>BytecodeNativeInterface looks promising.</STRONG></P>
<P>A virtual machine installs its own BCNI-compatible factory. An interface is well-defined between a virtual machine and standard class libraries.</P>
<LI><P><STRONG>Exceptions</STRONG></P>
<P>Standard exceptions do not have to tested like other classes. Pure reflection can be used to make sure a standard exception is defined in an implementation of the standard class libraries.</P>
<LI><P><STRONG>Errors</STRONG></P>
<P>Like exceptions, standard errors do not have to be tested and pure reflection is preferred.</P>
<A NAME="refined"></A>
<LI><P><STRONG>Package names must be refined (again).</STRONG>
<P>After working with Kore, a Kore-Alt prototype should have the following package names:</P>
<PRE>
kore.alt1a.applet
kore.alt1a.awt
kore.alt1a.image
kore.alt1a.io
kore.alt1a.lang
kore.alt1a.net
kore.alt1a.peer
kore.alt1a.util
</PRE>
</UL>
<H4><CODE>javac</CODE> tool</H4>
<P>From the work so far, I have learned a few things I had not known before about the <CODE>javac</CODE> tool and its assumptions about the kind of classes you're compiling.</P>
<UL>
<LI><P>A class called <CODE>Object</CODE></P>
<P>According to the Java Virtual Machine specification, I can create a new class called "Object" with the following condition: It must not be in the <CODE>java.*</CODE> packages.</P>
<P>Unfortunately, the <CODE>javac</CODE> tool balks when I try to compile <CODE>alt.lang.kore.Object</CODE>. As soon as it imports classes from <CODE>java.lang</CODE>, <CODE>Object</CODE> is <CODE>java.lang.Object</CODE> instead of <CODE>alt.lang.kore.Object</CODE>.</P>
<P>As a work-around, I have prefixed <CODE>alt<EM></CODE> to each class name in <CODE>alt.lang.kore</CODE> and only in <CODE>alt.lang.kore</CODE>. Instead of writing a class called <CODE>Object</CODE>, I wrote a class called <CODE>alt</EM>Object</CODE> so that it might compile with my defective <CODE>javac</CODE> tool.</P>
<P><EM>Future:</EM> Another work-around would be assembling classes in <CODE>alt.lang.kore</CODE> using the Jasmin assembler.</P>
<LI><P>Compiling <CODE>java.*</CODE> packages</P>
<P>There are many different implementations of the <CODE>javac</CODE> tool. I would like to use an implementation that does not confuse classes required to run the compiler and classes being compiled. My C/C++ compiler never gets its own standard library confused with the standard library its compiling. A <CODE>javac</CODE> tool must be more like my C/C++ compiler. It must have two separate paths. One path would be useful for running the compiler itself. Another path would be used to read all pre-compiled classes. Such a compiler would enable you to compile classes -- even those in <CODE>java.*</CODE> packages -- for a different platform.</P>
</UL>
<H4>Testing</H4>
<P>Part of the goal of the <CODE>alt.<STRONG></CODE> packages is side-by-side testing of two implementations of the same package. How is this possible? By implementing an original standard library in an alternative package, a program must be written to copy the original source code into the <CODE>java.</STRONG></CODE> namespace. The program <EM>fixes</EM> the source code as it copies. The copy is also compiled into a class file.</P>
<P>After the copy is created and compiled, a test can be written to compare the functionality of the copy with the original.</P>
<PRE>
  public void runTest()
		throws TestException {
	 String s1 = "Hello, World!";
	 alt_String s2 = new alt_String( s1 );

	 if ( !s2.equals( s1 ) ) {
		throw _TEX( "!s2.equals( s1 )" );
	 }

	 if ( s1.length() != s2.length() ) {
		throw _TEX( "s1.length() != s2.length()" );
	 }

	 int iMax = s1.length();
	 for ( int i = 0; i &lt; iMax; i++ ) {
		if ( s1.charAt( i ) != s2.charAt( i ) ) {
		  throw _TEX( 
				"s1.charAt( " + i + " ) != s2.charAt( " + i + " )" );
		}
	 }

	 try {
		s1.charAt( -1 );
		throw _TEX( "s1.charAt( -1 )" );
	 }
	 catch( StringIndexOutOfBoundsException e ) {
	 }

	 try {
		s2.charAt( -1 );
		throw _TEX( "s2.charAt( -1 )" );
	 }
	 catch( StringIndexOutOfBoundsException e ) {
	 }

	 String sub1 = s1.substring( 0, 5 );
	 String sub2 = s2.substring( 0, 5 );
	 if ( !sub1.equals( sub2 ) ) {
		throw _TEX( "!sub1.equals( sub2 )" );
	 }

	 try {
		s1.substring( -1, 0 );
		throw _TEX( "s1.substring( -1, 0 )" );
	 }
	 catch( StringIndexOutOfBoundsException e ) {
	 }

	 try {
		s2.substring( -1, 0 );
		throw _TEX( "s2.substring( -1, 0 )" );
	 }
	 catch( StringIndexOutOfBoundsException e ) {
	 }
	 :
  }
</PRE>
<HR>
<STRONG>Test configuration:</STRONG> You do not have to change virtual machines to test the implementation of Kore-Alt. Any class from the <CODE>kore.alt1a</CODE> packages uses the <a href="/view.php?topic=BCNI&web=Imported&PHPSESSID=8bc82e739d6772641b87cc66624bf281">BCNI</a> <wikitopic BCNI /wikitopic>factory. A test configuration is possible by plugging <CODE>TraditionalFactory</CODE> into the BCNI. The <CODE>TraditionalFactory</CODE> class is an extension of <CODE>org.jos.bcni1a.Factory</CODE> and returns the following classes:</P>
<UL>
<LI><CODE>TraditionalLangBridge</CODE>
<LI><CODE>TraditionalNetBridge</CODE>
<LI><CODE>TraditionalIOBridge</CODE>
<LI><CODE>TraditionalUtilBridge</CODE>
</UL>
I'm working on a batch translator that will copy Kore-Alt source code from <CODE>kore/alt1a/<STRONG>.java</CODE> to <CODE>java/</STRONG>.java</CODE>, changing package and class names as it goes. When completed, all modifications to Kore-Alt will be made in the <CODE>kore/alt1a/<STRONG></CODE> directory and automatically copied to <CODE>java/</STRONG></CODE>. -- <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=8bc82e739d6772641b87cc66624bf281">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (13 March 2000)<BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FAltPackageAndKore&PHPSESSID=8bc82e739d6772641b87cc66624bf281">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FAltPackageAndKore&PHPSESSID=8bc82e739d6772641b87cc66624bf281">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

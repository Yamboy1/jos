<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>AboutDecaf3b.Main @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="7637a155d7f9bae178e7bdf56f57d236" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//AboutDecaf3b?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">AboutDecaf3b</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Main/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">Main</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Main/AboutDecaf3b?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">info</a> on or <a href="/edit/Main/AboutDecaf3b?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FAboutDecaf3b&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FAboutDecaf3b&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Main/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">topics</a>, <a href="/hubsnodes/Main/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Main/?PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<a href="/view.php?topic=JJOSPages&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">JJOSPages</a><wikitopic JJOSPages /wikitopic>
<HR>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (19 April 2003).</EM>
<H4>Introduction</H4>
This version of decaf uses new C++ components from the <a href="/view.php?topic=VMKit&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">VMKit</a><wikitopic VMKit /wikitopic>.
<UL> <LI> The microcode table component, for example, provides detailed information about each opcode. Instructions are variable length. A virtual machine designer can depend on this component to discover the length of each instruction based on an opcode.
<LI> The vmkit/types.h header file provides typedef's for the jbyte, jchar, jshort, jint, jfloat and jdouble types. These are compatible with the Java Native Interface (JNI) typedef's.
</UL> <H4>Console program</H4>
In the Java programming language, we are working toward a console program interface. This interface would enable the init program to associate each virtual console with a custom console program. A console program listens for keystrokes and writes to a given virtual console.
</P><P>
With this interface in mind, it becomes possible to write a shell program. A shell program is a console program. It listens for keystrokes and manages the command line. The enter key might cause a shell program to process the command line, enabling you to invoke other custom programs using the same virtual console.
</P><P>
The init script itself should invoke other programs to install drivers and install console programs for each virtual console. It is not necessary for the init script itself to install drivers. It is also not necessary for drivers to be installed automatically the first time they are used.
</P><P>
<H4>decaf3b module</H4>
Version 3b is found in the decaf3b module. A new module enables us to move decaf forward without losing any of our precious code in the black hole of CVS.
<H4>Domains</H4>
The One True VM(tm) architecture is a possible architecture for a Java Virtual Machine. This architecture enables a virtual machine to manage separate domains. Each domain has a virtual console. Each has its own classpath. Each has its own primordial class loader.
</P><P>
The primary domain is the first domain created by the virtual machine. Most off-the-shelf virtual machines have only one domain, the primary domain. Only methods within the primary domain are able to directly access the hardware.
</P><P>
Secondary domains are created by the virtual machine. Each domain has its own classpath. Each domain has its own instance of java/lang/System. Each domain has its own instances of java/lang/Class. Each domain may or may not have its own heap.
</P><P>
We are going to start experimenting with domains in this version of decaf. We are going to add support for domains in functions and methods, although only one instance may be actually used.
<PRE>
  class domain {
  };
  class primarydomain : public domain {
  }
  class secondarydomain : public domain {
  }
  primarydomain * getprimarydomain();
  domain * getdomain( jint index );
</PRE>
For those familiar with the Java Native Interface (JNI), a domain is akin to an instance of a <nolink>JVM object. Within a domain, there are one or more threads. A thread is equivalent to an instance of a JEnv object. The JEnv can access the <nolink>JVM because every JEnv has exactly one <nolink>JVM.
</P><P>
An equivalent model of virtual machine, domains and threads should be developed in the Java programming language. Native methods to create a domain and access the methods of a domain should be made available.
<H4>Fields of a frame</H4>
The codeOffset, codeArgs and codeZero fields should be added to the frame class in C++. These fields can be evaluated globally by its runOpcode() method. These fields correspond to the operands found within the Code attribute of a method. When an instruction is fully decoded globally, most opcode methods no longer need direct access to the Code attribute.
<H4>Handling an exception</H4>
An exception is handled based on the original value of pc (or myPC). The value of pc must not change until after the opcode method has been invoked. In another version of decaf, <CODE>exception</CODE> and <CODE>previousPC</CODE> fields were added to the frame class to handle exceptions properly.
<H4>Fields of a thread</H4>
A thread <EM>belongs to</EM> a domain. Therefore, <CODE>domain</CODE> should be a field of a thread. The getDomain() method should return a pointer to the domain object.
</P><P>
For testing, a thread should be able to provide more information about its activity. It might, for example, have a <CODE>invokecount</CODE> field which tracks how many times an invoke.. opcode has been called. It might have a <CODE>opcodecount</CODE> field which tracks how many times the runOpcode() method has been called. This can provide additional statistics for each thread. And these fields should be available to your Java code through native methods of a decaf-thread class.
<H4>Caution</H4>
It is important to always have a running version of decaf. We are proceeding more cautiously on this project. It is important to keep <nolink>CVS clear of any release that does not compile and run. Good ideas are never lost. We have ideas (and some code) from other versions of decaf. We are integrating these ideas slowly into this version, making very sure that they improve the quality of the product.<BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FAboutDecaf3b&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FAboutDecaf3b&PHPSESSID=7637a155d7f9bae178e7bdf56f57d236">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>NativeInterface.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="cf872b3e3747839828e6909297a91260" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=cf872b3e3747839828e6909297a91260">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=cf872b3e3747839828e6909297a91260">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=cf872b3e3747839828e6909297a91260">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=cf872b3e3747839828e6909297a91260">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=cf872b3e3747839828e6909297a91260">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//NativeInterface?PHPSESSID=cf872b3e3747839828e6909297a91260">NativeInterface</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=cf872b3e3747839828e6909297a91260">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=cf872b3e3747839828e6909297a91260" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=cf872b3e3747839828e6909297a91260"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/NativeInterface?PHPSESSID=cf872b3e3747839828e6909297a91260">info</a> on or <a href="/edit/Imported/NativeInterface?PHPSESSID=cf872b3e3747839828e6909297a91260">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FNativeInterface&PHPSESSID=cf872b3e3747839828e6909297a91260">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FNativeInterface&PHPSESSID=cf872b3e3747839828e6909297a91260">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=cf872b3e3747839828e6909297a91260">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=cf872b3e3747839828e6909297a91260">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=cf872b3e3747839828e6909297a91260">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ArchitectureGroup&PHPSESSID=cf872b3e3747839828e6909297a91260">ArchitectureGroup</a><wikitopic ArchitectureGroup /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=cf872b3e3747839828e6909297a91260">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (6 April 2000).</EM></P>
<H4>Introduction</H4>
<P>Machine code and bytecode are two components of a solution. Machine code must work on behalf of bytecode; bytecode must work on behalf of machine code. Both must work together. The <EM>native interface</EM> is a mechanism that make this possible.</P>
<P>Bytecode can always invoke other bytecode methods. Machine code can always invoke other machine code methods. An interface is required to switch between the two.</P>
<P>The <nolink>AOT and <nolink>JIT translation of bytecode to machine code is beyond the scope of this article.</P>
<H4>Viewpoint</H4>
<P>Bytecode can invoke machine code methods. Most of the native interface is specified from this viewpoint. The classic design expects bytecode to use machine code because machine code is generally faster than bytecode.</P>
<P>Machine code can invoke bytecode methods, too. The <a href="/view.php?topic=JNI&web=Imported&PHPSESSID=cf872b3e3747839828e6909297a91260">JNI</a> <wikitopic JNI /wikitopic>design expands the classic design in this area.</P>
<H4>From bytecode</H4>
<P>When bytecode invokes a method, it does not know or need to know if the method is bytecode or machine code. On the implementation side, a programmer designs a "native" method in bytecode to call a machine code method. A <CODE>-jni</CODE> option of the <CODE>javah</CODE> tool provides support for <a href="/view.php?topic=JavaNativeInterface&PHPSESSID=cf872b3e3747839828e6909297a91260">JavaNativeInterface</a><wikitopic JavaNativeInterface /wikitopic>. The virtual machine translates parameters and return value from bytecode to machine code.</P>
<P>Once a native method is called, the viewpoint changes from bytecode back to machine code.</P>
<H4>From machine code</H4>
<P>Machine code runs inside and outside a virtual machine. Outside a virtual machine, machine code is the first kind of code that runs in a C/C++ program. Machine code can create a virtual machine and invoke a bytecode method.</P>
<P>Inside a virtual machine, bytecode calls a native method. The virtual machine translates parameters and return value from bytecode to machine code. The machine code can then invoke other machine code methods.</P>
<P>When a bytecode method is called, the viewpoint changes from machine code back to bytecode.</P>
<H4>Mix and match</H4>
<P>Machine code and bytecode can be mixed together. Machine code might be matched to low-level and optimum performance features. Bytecode might be matched to high-level and all other features. Like the translation between C- and Pascal-style of machine code, the native interface enables the translation between machine code and bytecode.</P>
<P>This gives the designer the flexibility to prototype almost everything in bytecode, getting quick results. A design can be fully tested before the first line of C/C++ is written. This is especially important when designing a class library in C++.</P>
<H4>About <nolink>JOS</H4>
<P>Bytecode can't do everything. That is the only reason a native interface is required. If opcodes were defined for low-level access to the hardware, bytecode could do everything.</P>
<P>In the operation of the virtual machine itself and a few places where machine code is absolutely required, a native interface is needed. Bytecode <EM>is</EM> native code in <a href="/view.php?topic=UltimateJOS&PHPSESSID=cf872b3e3747839828e6909297a91260">UltimateJOS</a><wikitopic UltimateJOS /wikitopic>. The <a href="/view.php?topic=BytecodeNativeInterface&PHPSESSID=cf872b3e3747839828e6909297a91260">BytecodeNativeInterface</a><wikitopic BytecodeNativeInterface /wikitopic> provides a mechanism for a virtual machine to operate without a foreign operating system.</P>
<H4>System clock in bytecode</H4>
<P>An application might need to get the current time. The <CODE>currentTimeMillis()</CODE> method of the <CODE>java.lang.System</CODE> class provides a way to get the current time (in milliseconds). A <nolink>JOS virtual machine does not require this method to be a native method. Instead, it is possible for the system time to be kept by a device driver written in bytecode.</P>
<P><EM>How does an application set the current time?</EM></P>
<P>The standard class library does not provide a corresponding mechanism to (a) set the system clock, (b) get the <a href="/view.php?topic=CMOS&web=Imported&PHPSESSID=cf872b3e3747839828e6909297a91260">CMOS</a> <wikitopic CMOS /wikitopic>clock, or (c) set the <a href="/view.php?topic=CMOS&web=Imported&PHPSESSID=cf872b3e3747839828e6909297a91260">CMOS</a> <wikitopic CMOS /wikitopic>clock. An alternative is required. The device: scheme, along with the bytecode native interface, provides a way to start the system clock driver and get/set the system clock.</P>
<P>Rather than use a native method to get the time, the <CODE>System.currentTimeMillis()</CODE> method is defined in bytecode, something like this:</P>
<PRE>
package java.lang;

import org.jos.bcni.Factory;

import org.jos.device.SystemClock;

public class System {
:
  public long currentTimeMillis() {
	 Factory f = Factory.getFactory();
	 String cn = "org.jos.device.SystemClock";
	 SystemClock clock = (SystemClock) f.getObject( cn );
	 if ( clock == null ) {
		return -1L;
	 }
	 return clock.getTime();
  }
:
}
</PRE><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FNativeInterface&PHPSESSID=cf872b3e3747839828e6909297a91260">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FNativeInterface&PHPSESSID=cf872b3e3747839828e6909297a91260">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>ProcessAndClassLoader.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="6d684d1ce49b1c5bf11e3325eefe376a" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//ProcessAndClassLoader?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">ProcessAndClassLoader</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/ProcessAndClassLoader?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">info</a> on or <a href="/edit/Imported/ProcessAndClassLoader?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FProcessAndClassLoader&PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FProcessAndClassLoader&PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ProcessPages&PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">ProcessPages</a><wikitopic ProcessPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (15 March 2000).</EM></P>
<H4>Introduction</H4>
<P>A process is a heavy-weight thread. It must be independent. It must be isolated. Otherwise, a process would be a thread.</P>
<P>A barrier between processes must exist. It must be strong. It must resist both accidents and tampering. When a process spins out of control, it must not bring down all of the other co-habitating processes that live on the same machine.</P>
<H4>Example of bad code</H4>
<P>Here is an example of a very bad process. It would spin out of control. It fills up the calling stack until there is no more stack space.</P>
<PRE>
  public void run() {
	 run();
  }
</PRE>
<P>This is an example of an endless <EM>recursion</EM>. A programmer might have meant to write this instead:</P>
<PRE>
  public void run() {
	 super.run();
  }
</PRE>
<H4>Class loader</H4>
<P>There are many different ways of creating an independent process. Let's consider one way. We'll starting with a custom class loader.</P>
<PRE>
public class CustomClassLoader
	 extends ClassLoader {
:
}
</PRE>
<P>A custom class loader extends <CODE>java.lang.ClassLoader</CODE>. The primary purpose of a class loader is loading classes. For the sake of discussion, those details won't be explained here. Basically, it returns an instance of <CODE>java.lang.Class</CODE> for any class that's referenced from that classloader forward.</P>
<P>A class loader also contributes to the <EM>data type</EM> for a class. When class <CODE>A</CODE> is loaded by <CODE>Loader1</CODE> and class <CODE>A</CODE> is loaded by <CODE>Loader2</CODE>, they are different as far as their data type. (The <CODE>instanceof</CODE> operator returns <CODE>false</CODE>.)</P>
<H4>Command line</H4>
<P>Our custom class loader needs to invoke an arbitrary program on the other side of the class loader. With a constructor, our custom class loader becomes:</P>
<PRE>
public class CustomClassLoader
	 extends ClassLoader {
  /**
	* Creates a class loader.
	* @param v a command line (or URI)
	*/
  public CustomClassLoader( String v ) {
	 commandLine = v;
  }
:
  private String commandLine;
}
</PRE>
<H4>Make it go</H4>
<P>What would happen if it were to implement the <CODE>Runnable</CODE> interface? We would have a custom class loader that's also runnable. Additional code to make an independent process would be self-contained, in a <CODE>run()</CODE> method.</P>
<PRE>
public class CustomClassLoader
	 extends ClassLoader {
  /**
	* Creates a class loader.
	* @param v a command line (or URI)
	*/
  public CustomClassLoader( String v ) {
	 commandLine = v;
  }

  /**
	* Runs a class loader().
	*/
  public void run() {
  :
  }
:
  private String commandLine;
}
</PRE>
<H4>Invoking it</H4>
<P>Here is an example of invoking a custom class loader that's runnable.</P>
<PRE>
  public void example() {
	 String cmd = "run:program:org.jos.demo.DemoProgram";
	 CustomClassLoader loader = new CustomClassLoader( cmd );
	 loader.run();
  }
</PRE>
<H4>Implementing <CODE>run()</CODE></H4>
<P>When invoked, what should it do? It should take the steps necessary to create a new process context that isolates a process from all others. The process context is a property of a custom class loader.</P>
<PRE>
public class CustomClassLoader
	 extends ClassLoader {
  /**
	* Creates a class loader.
	* @param v a command line (or URI)
	*/
  public CustomClassLoader( String v ) {
	 commandLine = v;
  }

  /**
	* Runs a class loader().
	*/
  public void run() {
	 Program p = getProgram( commandLine );
	 ThreadGroup g = new ThreadGroup();
	 Thread t = new Thread( g, p );
	 context = new BasicProcessContext( t, p, ...);
	 t.start();
  }

  /**
	* Gets ProcessContext property.
	*/
  public ProcessContext getProcessContext() {
	 return context;
  }

  private String commandLine;
  private ProcessContext context;
}
</PRE>
<P>When process information is part of a custom class loader, it is easy to access. For our purposes, every class has a class loader property (<CODE>getClassLoader()</CODE>). To find out if a certain class loader holds a process context, the <CODE>instanceof</CODE> keyword is useful:</P>
<PRE>
  public void example() {
	 Object o  = getClass().getClassLoader();
	 if ( o instanceof CustomClassLoader ) {
		CustomClassLoader loader = (CustomClassLoader) o;
		ProcessContext pc = loader.getProcessContext();
	 }
  }
</PRE>
<H4>Summary</H4>
<P>A custom class loader, implementing <CODE>java.lang.Runnable</CODE>, can invoke well-behaved <EM>services</EM> inside an unmodified virtual machine. Adding I/O streams for standard in, standard out and standard err, you almost have a process.</P>
<P>Without additional support, an unmodified virtual machine could not properly isolate multiple processes. When one process runs out of memory, they run out of memory. When one process runs out of stack space, they all run out of stack space.</P>
<P>A <nolink>JOS-compatible multiple-process virtual machine must isolate each process. When one process runs out of memory, it is shut down -- but others keep running. When one process runs out of stack space, it is shut down -- but others keep running.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FProcessAndClassLoader&PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FProcessAndClassLoader&PHPSESSID=6d684d1ce49b1c5bf11e3325eefe376a">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

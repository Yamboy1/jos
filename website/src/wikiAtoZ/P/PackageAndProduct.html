<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>PackageAndProduct.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="ceb0998fcf1541eb5704ef1c07c3ffe3" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//PackageAndProduct?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">PackageAndProduct</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/PackageAndProduct?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">info</a> on or <a href="/edit/Imported/PackageAndProduct?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FPackageAndProduct&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FPackageAndProduct&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=DistributionGroup&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">DistributionGroup</a><wikitopic DistributionGroup /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (6 April 2000).</EM></P>
<H4>Introduction</H4>
<P>And then, there are Java-based products. The interaction between Java-based products can be unexpected, sudden and unpredicable. A Java-based product depends on a virtual machine to find the right bytecode. Bytecode might be hard to find. A virtual machine must search for bytecode in class files, archives and package files. It must search both local and remote machines.</P>
<P>Interaction between Java-based products can be controlled by selecting the right <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>and virtual machine. The lib/ext directory is not as predictable as CLASSPATH. While a search of <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>can be predicted, a search of a lib/ext directory cannot.</P>
<P>Selection of virtual machine is not as predictable as I once thought. Recently, all my Java 1 Platform applications unexpectedly started running at half-speed. It happened suddenly. It took a while to figure out what when wrong. I traced it back to a commercial product. This product <EM>requires</EM> a Java 2 Virtual Machine. Installing the product also installs a virtual machine. A Java 2 Virtual Machine takes longer to load, longer to run.</P>
<P>My applications on my machine were build and tested on Java 0 and 1, not Java 2. But now, they are running on a Java 2 Virtual Machine. That's not what I expected. That's not what I want. The architect of this commercial product won't have it any other way.</P>
<H4>Example</H4>
<P>Sometimes a virtual machine will find the wrong class. What happens then? A Java-based product will misbehave. It won't fulfill its purpose. Rarely, it will crash.</P>
<P>Here is a scenario that happens frequently.</P>
<UL>
<LI><P>Programmers "A" and "B" are working independently.</P>
<LI><P>Programmer "A" designs a Product "X". It will be distributed in an archive called <CODE>X.jar</CODE>.</P>
<LI><P>Programmer "B" designs a Product "Y". It will be distributed in an archive called <CODE>Y.jar</CODE>.</P>
<LI><P>Product "X" is installed on Machine "Z". It is tested. It works.</P>
<LI><P>Product "Y" is also installed on Machine "Z". It is tested. It does not work at all. Programmer "B" looks bad. Product "Y" doesn't work the way Programmer "B" said it does.</P>
</UL>
<P>Let's look under the hood. Here is what may have happened.</P>
<P>Since Programmers "A" and "B" are working independently, they do not keep track of which package the other is using. Since both programmers are like minded and working on a similar product, both may have called a utility package by the same name. This is highly likely when both programmers download and install the same utility package off the Internet.</P>
<OL>
<LI><P>When Product "X" is installed, <CODE>X.jar</CODE> is added to the lib/ext directory of the virtual machine. Product "X" works perfectly at this point.</P>
<LI><P>When Product "Y" is installed, <CODE>Y.jar</CODE> is added to the lib/ext directory of the virtual machine. Product "Y" does not work at all.</P>
</UL>
<P>Both <CODE>X.jar</CODE> and <CODE>Y.jar</CODE> contain a utility package with the same name. A virtual machine might find the first copy of the utility package in <CODE>X.jar</CODE>, even when running an application out of <CODE>Y.jar</CODE>. The virtual machine searches for the first package, not the package within the closest proximity.</P>
<P>When Product "Y" is installed, it might work; Product "X" might stop working for no apparent reason. If Product "Y" had been installed first, Product "Y" might work and Product "X" might not.</P>
<P>When Product "X" <EM>requires</EM> Java 1 and Product "Y" <EM>requires</EM> Java 2, it becomes necessary to have both Java 1 and 2 at the same time. I have a short list of products that run on Java 0 but not 1 or 2. I have a short list that runs on Java 1, but not 2. I have a long list of products that run on Java 2, but not 0 or 1. When Java 1 is the only virtual machine available for a platform, running Java 2 is not an option.</P>
<H4>Product</H4>
<P>There is more to a Java-based product than bytecode. There is more than .class files, .jar files or .package files. We distribute products, not bytecode. An internal-use-only product is still a product. A free-license product is still a product. A commercial-license product is still a product.</P>
<P><EM>What is the relationship between a product and its packages?</EM></P>
<P>A product contains packages. A package can be distributed and re-distributed. A package can be distributed in one or more products.</P>
<P>A product is a marketing device. It closely associates a set of features with a product name. A product should be given a unique brand name.</P>
<P>A package is a technical device. It is a container for one or more classes. A package should be given a unique name within an instance of a package library. The actual package library is determined at runtime.</P>
<H4>Finding a product</H4>
<P>If you know the name of a Java package, you can look up the product on through a page of <A HREF="http://www.jos.org/redist/src/allpackages.html">all packages</A> .</P>
<H4>Product</H4>
<P>Here is a working definition of a product.</P>
<UL>
<LI><P>A Java-based product contains one or more Java packages.</P>
<LI><P>Ideally, a virtual machine is not distributed with each product.</P>
<LI><P>A package can be distributed in one or more Java-based products.</P>
</UL>
<H4>Stored in multiple archives</H4>
<P>A package can be stored in more than one archive. The behavior of a virtual machine when the same package is stored in multiple archives depends on the virtual machine.</P>
<P>Most of the time, abiguous packages on <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>is undesireable.</P>
<H4>Package</H4>
<P>A package is not a product. Even if a product contains only one package, the package is not a product. While a package is useful to a (virtual) machine, a product is useful to a person.</P>
<P>A package should be organized to maximize its reuse. Small packages are easier to reuse than large ones.</P>
<P>A product should be organized to maximize its reuse. Large products are easier to use than small ones.</P>
<P>If it is appropriate to solve a problem with a single class, a package can contain a single class.</P>
<P>Test classes should not be distributed as part of the runtime edition. The runtime edition is something that has already been tested by its author.</P>
<P>Test classes should be distributed as part of a technical edition. In order for other programmers to change the behavior of a product, they need to run the existing test programs.</P>
<H4>Re-distribution</H4>
<P>Parts of an original product may be distributed as part of another product. The original product can be re-distributed in whole or in part.</P>
<P>If a product only requires one or two packages from a 100 package product, only one or two packages should be redistributed.</P>
<P>When redistributed, the name of original 100 package archive must not be reused.</P>
<H4>About <nolink>JOS</H4>
<P>A Java-based operating system has additional challenges. It must resolve the ambiguity of a CLASSPATH.</P>
<P>In the classic design, a virtual machine is isolated inside its own native process. The <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>of a virtual machine does not affect the <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>of any other virtual machine. Any ambiguity in a package library is resolved by each invocation of an application. Each application is given a CLASSPATH. Sometimes a person must search for a <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>that works.</P>
<P>In the <a href="/view.php?topic=JNI&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">JNI</a> <wikitopic JNI /wikitopic>design, a virtual machine is isolated inside its own thread. The <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>of one virtual machine does not affect any other. Again, ambiguity in a package library is resolved by each invocation of an application.</P>
<P>In the <nolink>JOS design, <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>determines platform. All applications must use the platform-specific CLASSPATH. Another mechanism is required to give each application the opportunity to load its own classes. Each <EM>process</EM> must have its own custom class loader. The <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>property of <CODE>java.lang.System</CODE> should reflect the custom <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>of a <EM>process</EM>.</P>
<P>One virtual machine can support all three Java platforms. In the <nolink>JOS design, the java<EM>n</EM>.jar contains all of the classes required to support the Java <EM>n</EM> platform. When a virtual machine is created, its <a href="/view.php?topic=CLASSPATH&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">CLASSPATH</a> <wikitopic CLASSPATH /wikitopic>contains java0.jar, java1.jar or java2.jar. All platforms use a common <a href="/view.php?topic=BytecodeNativeInterface&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">BytecodeNativeInterface</a><wikitopic BytecodeNativeInterface /wikitopic>.</P>
<H4>Bootstrap</H4>
<P>The system process probably runs on a Java 0 Platform, with java0.jar on its CLASSPATH. When the system process creates additional (user) processes, they can start with java0.jar, java1.jar or java2.jar on their CLASSPATH.</P>
<P>If java2.jar is stored on a remote machine, a <a href="/view.php?topic=URL&web=Imported&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">URL</a> <wikitopic URL /wikitopic>class from the Java 0 Platform can download java2.jar and bind it to the new process.</P>
<P>Most likely, the package protocol is going to be implemented for the package-on-demand feature. The server provides one package at a time for a virtual machine on the client-side. A servlet can translate java0.jar, java1.jar and java2.jar into separate package files on-the-fly.</P>
<H4>Compiling a package</H4>
<P>Almost all components in a virtual machine can be written in the Java programming language. Translating a package into machine code is much easier at the package level. The whole package goes into a single shared library.</P>
<P>A package can be translated from bytecode to C/C++ source code. When the C/C++ source code is compiled, it can be distributed as a shared library. The name of a package-library is lib<EM>package-name</EM>.so (or <EM>package-name</EM>.dll).</P>
<UL>
<LI><CODE>java.lang</CODE> -> <CODE>libjava_lang.so</CODE>
<LI><CODE>java.net</CODE> -> <CODE>libjava_net.so</CODE>
<LI><CODE>java.util</CODE> -> <CODE>libjava_util.so</CODE>
</UL>
<P>To provide namespace, the package can be compiled to a single class in C++. Each package has one header file.</P>
<PRE>
// &lt;EM&gt;package-name&lt;/EM&gt;.h
class &lt;EM&gt;package-name&lt;/EM&gt; {
  class &lt;EM&gt;class-1&lt;/EM&gt; {
  :
  }
  class &lt;EM&gt;class-2&lt;/EM&gt; {
  :
  }
  class &lt;EM&gt;class-3&lt;/EM&gt; {
  :
  }
:
  class &lt;EM&gt;class-n&lt;/EM&gt; {
  :
  }
};
</PRE>
<P>The constants in a codepool are managed at a package level. All codepools are merged into a codepool for the package.</P>
<P>To use a class, the :: operator is used.</P>
<PRE>
  &lt;EM&gt;package-name&lt;/EM&gt;::&lt;EM&gt;class-name&lt;/EM&gt; v;
</PRE>
<P>Here is the out property of <CODE>java.lang.System</CODE>.</P>
<PRE>
void example() {
  java_lang::System.out.println( "Hello, World!" );
}
</PRE>
<P>Wherever the <CODE>java_lang::String</CODE> class might be useful, the <CODE>const char *</CODE> equivalent could be generated automatically.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FPackageAndProduct&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FPackageAndProduct&PHPSESSID=ceb0998fcf1541eb5704ef1c07c3ffe3">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>PureReflectionIII.Main @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="2d991c033f2e989eb1654f6378d9eb3f" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//PureReflectionIII?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">PureReflectionIII</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Main/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">Main</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Main/PureReflectionIII?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">info</a> on or <a href="/edit/Main/PureReflectionIII?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FPureReflectionIII&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FPureReflectionIII&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Main/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">topics</a>, <a href="/hubsnodes/Main/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Main/?PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<a href="/view.php?topic=BytecodePages&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">BytecodePages</a><wikitopic BytecodePages /wikitopic>; <a href="/view.php?topic=PureReflection&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">PureReflection</a><wikitopic PureReflection /wikitopic>; <a href="/view.php?topic=PureReflectionIIIOpcode&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">PureReflectionIIIOpcode</a><wikitopic PureReflectionIIIOpcode /wikitopic>
<HR>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (27 January 2000).</EM>
<H4>Introduction</H4>
I continue to enjoy the freedom of pure reflection. This freedom comes from being able to reflect classes for any platform using <a href="/view.php?topic=JDK&web=Main&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">JDK</a> <wikitopic JDK /wikitopic>1.0.2 and C/C++. I have the freedom to separate the signature of a class from its implementation. Since it provides a class signature that's machine readable, pure reflection has the potential to compare two implementations of a class library to see if their signatures are identical.
<H4>Next version</H4>
The next version of pure reflection should bring together the best of three packages:
<UL> <LI> <STRONG><CODE>java.lang.reflect</CODE></STRONG> This package was introduced with Java 1 Platform.
<LI> <STRONG><CODE>classfile</CODE></STRONG> This package is also known as <CODE>org.jos.classfile</CODE>.
<LI> <STRONG><CODE>jasmin</CODE></STRONG> This package was developed for <EM>Java Virtual Machine</EM> ( <a href="http://www.oreilly.com/catalog/javavm/">http://www.oreilly.com/catalog/javavm/</a> ) from O'Reilly ( <a href="http://www.oreilly.com/">http://www.oreilly.com/</a> ).
</UL> <H4>Name vs. specification</H4>
In all versions of Java, a class name uses the dot separator. Here is an example of three class names:
<PRE>
java.lang.Object
java.lang.Class
java.lang.String
</PRE>
In all versions of Java, a class specification uses the forward slash (/) separator. Here is an example of three class specifications:
<PRE>
java/lang/Object
java/lang/Class
java/lang/String
</PRE>
A class specification does not include built-in, or <EM>primative</EM>, types. The 'L' type specification expects a class specification and a semi-colon (;). Type specifications use the following letters:
</P><P>
<table border="2" cellspacing="2" cellpadding="2"><TR><TD> <STRONG>Type Specification</STRONG> </TD><TD> <STRONG>Java Language Keyword</STRONG> </TD></TR>
<TR><TD> B </TD><TD> <CODE>byte</CODE> </TD></TR>
<TR><TD> C </TD><TD> <CODE>char</CODE> </TD></TR>
<TR><TD> D </TD><TD> <CODE>double</CODE> </TD></TR>
<TR><TD> F </TD><TD> <CODE>float</CODE> </TD></TR>
<TR><TD> I </TD><TD> <CODE>int</CODE> </TD></TR>
<TR><TD> J </TD><TD> <CODE>long</CODE> </TD></TR>
<TR><TD> S </TD><TD> <CODE>short</CODE> </TD></TR>
<TR><TD> Z </TD><TD> <CODE>boolean</CODE> </TD></TR>
</TABLE>
Therefore, the <CODE>reflection.Bytecode</CODE> interface must implement the following methods:
<PRE>
public interface Bytecode {
  :
  public abstract String getThisClassSpec()
      throws MalformedBytecodeException;

  public abstract String getSuperClassSpec()
      throws MalformedBytecodeException;

  public abstract String getInterfaceSpec( int v )
      throws MalformedBytecodeException;
}
</PRE>
<H4>Convert spec to name</H4>
The <CODE>cs2cn</CODE> method should be written once inside the reflection package.
<PRE>
  /**
   * Converts from class spec (cs) to class name (cn).
   */
  public String cs2cn( String v ) {
    return v.replace( '/', '.' );
  }
</PRE>
<H4>Method specification</H4>
A method signature is stored in a class file using type specifications for parameter and return type. Here is an example of a method, called max, that accepts two <CODE>double</CODE>s and returns a <CODE>double</CODE>.
<PRE>
max(DD)D
</PRE>
When a class is a parameter or return value, the 'L' type specification is used. Here is an example of a method, called max, that accepts two <CODE>java.lang.String</CODE>s and returns a <CODE>java.lang.String</CODE>.
<PRE>
max(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
</PRE>
<H4>Convert method specification</H4>
There should be a method inside the reflection package that turns any method specification into something that reads like the Java programming language.
<PRE>
max(DD)D
</PRE>
becomes
<PRE>
double max( double, double )
</PRE>
<H4>Arrays</H4>
Within a type specification, the open bracket ([) is used for each dimension of an array. When an open bracket is a prefix to another type specification, a single instance becomes an array.
</P><P>
<table border="2" cellspacing="2" cellpadding="2"><TR><TD> <STRONG>Type Specification</STRONG> </TD><TD> <STRONG>Java Language Keyword</STRONG> </TD></TR>
<TR><TD> <CODE>B</CODE> </TD><TD> <CODE>byte</CODE> </TD></TR>
<TR><TD> <CODE>[B</CODE> </TD><TD> <CODE>byte[]</CODE> </TD></TR>
<TR><TD> <CODE>[[B</CODE> </TD><TD> <CODE>byte[][]</CODE> </TD></TR>
<TR><TD> <CODE>[[[B</CODE> </TD><TD> byte[][][]</CODE> </TD></TR>
<TR><TD> : </TD><TD> : </TD></TR>
<TR><TD> <CODE>Ljava/lang/String;</CODE> </TD><TD> <CODE>String</CODE> </TD></TR>
<TR><TD> <CODE>[Ljava/lang/String;</CODE> </TD><TD> <CODE>String[]</CODE> </TD></TR>
<TR><TD> <CODE>[[Ljava/lang/String;</CODE> </TD><TD> <CODE>String[][]</CODE> </TD></TR>
<TR><TD> <CODE>[[[Ljava/lang/String;</CODE> </TD><TD> <CODE>String[][][]</CODE> </TD></TR>
<TR><TD> : </TD><TD> : </TD></TR>
</TABLE><H4>C++</H4>
While the prototype is written in the Java programming language, pure reflection will be available in C++. Such a library will be able to extract information from class files for use in any C/C++ program. Pure reflection makes it easier to write an implementation of a virtual machine.
</P><P>
A verifier uses pure reflection. Pure reflection gets information out of a class file. A verifier makes certain information is complete, safe and consistent.
</P><P>
Pure reflection does not enable you to create class files. But pure reflection does help you write a compiler. The class files emitted from your compiler should be validated with pure reflection. A modern compiler verifies the methods and fields expected actually exist in other classes.
</P><P>
A compiler does not need to use the Java programming language. As Jasmin demonstrates, class files can be constructed from Java assembler and other programming languages. Java Server Pages (JSP) automatically compiles a .jsp page into a class file.
<H4>Access example</H4>
As an example, the access field is important to the reflection of a class file. The class itself, each field and each method <EM>has-an</EM> access property. Access is a bit-mapped field, with each bit used as a true or false flag. In pure reflection, the access field is reflected using the <CODE>reflection.Access</CODE> interface.
<PRE>
public interface Access {
  public abstract boolean isPublic();
  public abstract boolean isProtected();
  public abstract boolean isDefault();
  public abstract boolean isPrivate();
  :
  public abstract boolean isSynchronized();
  public abstract boolean isNative();
}
</PRE>
Each flag in access has a corresponding boolean property. The constants required by the bit-mapped field are appropriately hidden by an interface.
<H4>Opcode example</H4>
As an example, opcodes are important to the reflection of a class file. Each opcode <EM>has-a</EM> unique name and zero or more operands. A formalized OO design for an opcode would include an <CODE>Opcode</CODE> class ( <a href="/view.php?topic=PureReflectionIIIOpcode&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">PureReflectionIIIOpcode</a><wikitopic PureReflectionIIIOpcode /wikitopic> ), something like this:
<PRE>
public class Opcode {
  // static fields and methods
  public static final Opcode ILOAD = new Opcode( 21, "iload", 2 );
  public static final Opcode LLOAD = new Opcode( 22, "lload", 2 );
  public static final Opcode DLOAD = new Opcode( 24, "dload", 2 );
  public static final Opcode ALOAD = new Opcode( 25, "aload", 2 );
  :

  public static Opcode getOpcode( int v ) {
    return list[ v ];
  }

  public static Opcode getOpcode( String v ) {
    int iMax = list.length;
    for ( int i = 0; i &lt; iMax; i++ ) {
      if ( list[ i ].getName().equals( v ) ) {
        return list[ i ];
      }
    }
    return null;
  }

  private static Opcode[] list = createList();

  private static Opcode[] createList() {
    Opcode[] buf = new Opcode[ 265 ];
    buf[ ALOAD.getID() ] = ALOAD;
    buf[ DLOAD.getID() ] = DLOAD;
    buf[ ILOAD.getID() ] = ILOAD;
    buf[ LLOAD.getID() ] = LLOAD;
    :
    return buf;
  }

  private Opcode( int i, String n, int s ) {
    id = i;
    name = n;
    size = s;
  }

  public int getID() {
    return id;
  }

  public String getName() {
    return name;
  }

  public int getSize() {
    return size;
  }

  public String toString() {
    return getName() + "[" + getID() + "," + getSize() + "]";
  }

  private int id;
  private String name;
  private int size;
}
</PRE>
When the opcode table is filled out, this C-style enumeration becomes useful in a wide variety of different applications. A virtual machine can load the Opcode class for its codepool. Many interesting applications can use the Opcode class to study bytecodes in a class.<BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FPureReflectionIII&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FPureReflectionIII&PHPSESSID=2d991c033f2e989eb1654f6378d9eb3f">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

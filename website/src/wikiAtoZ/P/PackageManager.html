<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>PackageManager.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="02b8690a2a3772d45a4bbcb32908a26e" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//PackageManager?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">PackageManager</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/PackageManager?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">info</a> on or <a href="/edit/Imported/PackageManager?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FPackageManager&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FPackageManager&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic>.</EM>.
<TABLE WIDTH="100%">
<TR>
<TD>
<H4>Introduction</H4>
<P>At every point in the code, where once class depends on another, we have a new branch that needs to be tested. Which classes does it depend on? To review the needs of a package manager, it has the responsibility for <a href="/view.php?topic=Versioning&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">Versioning</a><wikitopic Versioning /wikitopic> and loading bytecode appropriate to a class.</P>
<P>The following chronology demonstrates the issue of versioning and how it is related to the package manager.</P>
<TABLE WIDTH="100%" BORDER="1" BGCOLOR="#FFFFCC">
<TR>
<TD ALIGN="CENTER" VALIGN="TOP" WIDTH="10%">
<STRONG>1</STRONG>
</TD>
<TD>
<P>The <nolink>JOS Organization releases <nolink>JOS 2.x.</P>
<UL>
<LI>Company A shows its leadership and builds a new application suite that depends on <nolink>JOS 2.x. They test it thoroughly and it works without as much as a single defect. They release it to thousands of customers.
<LI>Customer Z installs <nolink>JOS 2.x and product(s) from Company A.
</UL>
</TD>
</TR>
<TR>
<TD ALIGN="CENTER" VALIGN="TOP" WIDTH="10%">
<STRONG>2</STRONG>
</TD>
<TD>
<P>Meanwhile, work continues at the <nolink>JOS Organization...</P>
<UL>
<LI>Company B, a late entry in the <nolink>JOS market, builds a powerful new development toolkit that depends on <nolink>JOS 2.x. They test their toolkit thoroughly and it works perfectly. They release it to thousands of programmers. Company B has no choice. They can't develop their toolkit for <nolink>JOS 3.x because it hasn't been released yet.
</UL>
</TD>
</TR>
<TR>
<TD ALIGN="CENTER" VALIGN="TOP" WIDTH="10%">
<STRONG>3</STRONG>
</TD>
<TD>
<P>The <nolink>JOS Organization releases <nolink>JOS 3.x.</P>
<UL>
<LI>Company A releases an upgrade of their new suite that depends on <nolink>JOS 3.x. They test it thoroughly and it's perfect.
<LI>Customer Z wants the improved suite from Company A. But wait! It depends on <nolink>JOS 3.x. Customer Z has no choice. If they want to use the improved suite they must install the improved OS.
</UL>
</TD>
</TR>
<TR>
<TD ALIGN="CENTER" VALIGN="TOP" WIDTH="10%">
<STRONG>4</STRONG>
</TD>
<TD>
<P>Meanwhile, work continues at the <nolink>JOS Organization...</P>
<UL>
<LI>At last, Company C builds a powerful new application with the development kit from Company B. Company C has no choice. If they want to use the development kit they must also use <nolink>JOS 2.x. Their powerful new application depends on <nolink>JOS 2.x.
<LI>Customer Z wants to use the the powerful new application from Company C. But wait! It depends on <nolink>JOS 2.x. It has never been tested with <nolink>JOS 3.x. Do we know if it will work? <STRONG>If it has never been tested together, we don't know for sure.</STRONG>
<LI>Customer Z wants to use <nolink>JOS 2.x and 3.x <EM>at the same time</EM> on one computer. They want to use product(s) from Company A and C <EM>at the same time</EM> on one computer.
</UL>
</TD>
</TR>
</TABLE>
<P>For as long as <nolink>JOS 3.x is perfectly backward compatible with <nolink>JOS 2.x, products from Companies A and C <EM>should</EM> run perfectly on a single machine running <nolink>JOS 3.x.</P>
<P>We could say the same for the three versions of Java. The short history of Java is so convoluted with versions of Java that are almost compatible, but not quite.</P>
<P>Who is responsible for testing a old product in a new operating system? The <EM>customer</EM> is always responsible for testing software before using it to get their work done. Some customers, especially beginners, don't take responsibility for this.</P>
</TD>
</TR>
<TR>
<TD>
<H4>Package Manager</H4>
<P>Who are our customers? Who needs <nolink>JOS? Which applications are going to run on <nolink>JOS?
<UL>
<LI>all those customers running Java 1.0.2 applications
<LI>all those customers running Java 1.1.7 applications
<LI>all those customers running Java 2.0.x applications
</UL>
</P>
<P>Ignoring versioning for a moment, a package-at-a-time approach to class loading corresponds to the notion that the smallest unit of distribution is the package. A package manager maintains a unique set of packages.</P>
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public class PackageManager {
  public static PackageManager getManager() {
	 return manager;
  }

  private static PackageManager manager = new PackageManager();

  private PackageManager() {
  }

  public void reload() {
	 String[] list = /* cache keys to String[] */;
	 cache = new Hashtable();
	 int iMax = list.length;
	 for ( int i = 0; i &lt; iMax; i++ ) {
		findPackage( list[ i ] );
	 }
  }

  public PackageLoader findPackage( String n ) {
	 Object o = cache.get( n );
	 if ( o != null ) {
		if ( o instanceof PackageLoader ) {
		  return (Package) o;
		}
	 }

	 PackageLoader p;
	 try {
		p = new PackageLoader( n );
	 }
	 catch( PackageNotFoundException e ) {
		return null;
	 }
	 cache.put( n, p );
	 return p;
  }

  private Hashtable cache =
		new Hashtable();
}
</PRE>
</TD>
</TR>
</TABLE>
<P>A package loader is a class manager and uses a class loader. It maintains a unique set of classes.</P>
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public abstract class PackageLoader {
  public PackageLoader( String v )
		throws PackageNotFoundException {
	 packageName = v;
	 reload();
  }

  public String getPackageName() {
	 return packageName;
  }

  public abstract void reload()
		throws PackageNotFoundException;

  public Class findClass( String n )
	 throws ClassNotFoundException;

  private String packageName;
}
</PRE>
</TD>
</TR>
</TABLE>
<P>With versioning, a package manager could load a package for each version of Java. Imagine this:
<PRE>
/usr/local/jos/packages/Package-java.awt.10
/usr/local/jos/packages/Package-java.awt.11
/usr/local/jos/packages/Package-java.awt.20
</PRE>
<P>When a programmer writes the following code, which version of Java should be used? Should it be the version preferred by the requesting class? or the requested class?
<PRE>
Class c;
try {
  c = Class.forName( "custompackage.customclass" );
}
catch( ClassNotFoundException e ) {
}
</PRE>
<P>When the requested class was written and tested with Java 1.0.2, maybe it would run in Java 2.0 and maybe not. If Java 1.0.2 is simply not available, should the <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">JVM</a> <wikitopic JVM /wikitopic>attempt to run it in Java 2.0?</P>
</TD>
</TR>
</TABLE>
<HR>
<P>Package files for a specific Java platform might have the platform reflected in the file extension. Consider this:
<UL>
<LI>When a virtual machine is configured for perfect compatibility with the Java 0 Platform, it's package-oriented class loader searches for .jpk0 package files.
<PRE>
/usr/local/jos/jpkg/java.awt.jpk0
/usr/local/jos/jpkg/org.jos.smartapi2a.jpk0
</PRE>
<LI>A virtual machine configured for the Java 1 Platform searches for .jpk1 and then .jpk0 package files.
<PRE>
/usr/local/jos/jpkg/java.awt.jpk1
/usr/local/jos/jpkg/org.jos.gchii.connection1b.jpk1
</PRE>
<LI>A virtual machine configured for the Java 2 Platform searches for .jpk2 then .jpk1 then .jpk0 package files.
<PRE>
/usr/local/jos/jpkg/java.awt.jpk2
/usr/local/jos/jpkg/java.awt.swing.jpk2
</PRE>
<LI>A virtual machine configured for the Java 3 Platform searches for .jpk3 then .jpk2 then .jpk1 then .jpk0 package files.
<PRE>
/usr/local/jos/jpkg/java.awt.jpk3
/usr/local/jos/jpkg/java.awt.swing.jpk3
</PRE>
</UL>
<P>All these package files have the same format. A package file is a custom archive (not zip compatible, not compressed) that contains classes. A package file is organized like this:</P>
<PRE>
list {
  u1 magic_number[ 5 ] = 'lisT';
  u2 format_version = 5;
  u2 list_name_length;
  u2 item_count;
  u1 list_name[ list_name_length ];
  item itemList[ item_count ];
}

item {
  u1 magic_number[ 5 ] = 'iteM';
  u2 item_name_length;
  u2 item_data_length;
  u1 item_name[ item_name_length ];
  u1 item_data[ item_data_length ];
}
</PRE>
<P>When you install package files on an <a href="/view.php?topic=HTTP&web=Imported&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">HTTP</a> <wikitopic HTTP /wikitopic>service, you decide which Java plaforms you want to support. When you install package files on an application service, a request for a .jpk3 file will automatically search for .jpk3 then .jpk2 then .jpk1 then .jpk0 on the server side. As far as the virtual machine is concerned, every request for a .jpk3 file is fulfilled. There is no harm in copying most package files to a higher platform. You can always copy .jpk0 files to .jpk1, .jpk2 or .jpk3 during the <nolink>HTTP installation process.</P>
<P>I like this design for administrative reasons. It requires programmers to keep track of which platform was used to develop (and compile) the classes. And, customers (and system administrators) can see immediately which platform is the minimum requirement for each package. -- <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (10 December 1999).</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FPackageManager&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FPackageManager&PHPSESSID=02b8690a2a3772d45a4bbcb32908a26e">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>ParentProcess.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="172418c4ea6925e78d9d28677f1433e5" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//ParentProcess?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">ParentProcess</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=172418c4ea6925e78d9d28677f1433e5" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=172418c4ea6925e78d9d28677f1433e5"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/ParentProcess?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">info</a> on or <a href="/edit/Imported/ParentProcess?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FParentProcess&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FParentProcess&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=172418c4ea6925e78d9d28677f1433e5">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ProcessPages&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">ProcessPages</a><wikitopic ProcessPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (16 May 2000).</EM></P>
<H4>Introduction</H4>
<P>When we speak about processes, we speak of a <EM>calling</EM> and a <EM>called</EM> process. A calling process uses the <CODE>exec()</CODE> method of <CODE>java.lang.Runtime</CODE>. A called process is almost a new instance of a virtual machine, but not quite.</P>
<P>A called process can implement many different models. Models include agents, applets, applications, beans, components, programs and servlets. It is not limited to the weak Java application model. Any <a href="/view.php?topic=URL&web=Imported&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">URL</a> <wikitopic URL /wikitopic>can be used as the command line to start a process. Any Smart <nolink>API-compatible <a href="/view.php?topic=URI&web=Imported&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">URI</a> <wikitopic URI /wikitopic>can be used as the command line to start a process.</P>
<P>One process cannot be the parent of another. Saying so blurs the distinction between a process and its process descriptor. One process cannot own another. Each process is owned by a process manager. Each process descriptor is owned by a process.</P>
<H4>Diagram</H4>
<P>The following diagram illustrates a list of processes, as owned by a process manager.</P>
<TABLE BORDER="1" CELLPADDING="8" BGCOLOR="lightblue">
<TR>
<TD ALIGN="CENTER" VALIGN="TOP">
process manager
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="khaki">
<TR>
<TD>
process-1
</TD>
</TR>
<TR>
<TD>
process-2
</TD>
</TR>
<TR>
<TD>
process-3
</TD>
</TR>
<TR>
<TD>
:
</TD>
</TR>
<TR>
<TD>
process-<EM>n</EM>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<H4>Process manager</H4>
<P>In machine code, a process manager closely associates a process with a unique process ID, or pid. This could be as simple as a fixed array of processes, as illustrated by this C++ code:</P>
<PRE>
static const int SIZE = 100;
static mc_Process **processList;

void createProcessList() {
  processList = new mc_Process *[ SIZE ];
  if ( processList == NULL ) {
	 return;
  }

  for ( int i = 0; i &lt; SIZE; i++ ) {
	 processList[ i ] = NULL;
  }
}

int addProcess( const mc_Process *v ) {
  if ( processList == NULL ) {
	 createProcessList();
  }

  for ( int i = 0; i &lt; SIZE; i++ ) {
	 if ( processList[ i ] == NULL ) {
		processList[ i ] = v;
		return i;
	 }
  }

  return -1;
}

mc_Process *getProcess( int index ) {
  if ( index &lt; 0 ) {
	 return NULL;
  }

  if ( index &gt;= SIZE ) {
	 return NULL;
  }

  return processList[ index ];
}
</PRE>
<H4>Process descriptor</H4>
<P>To provide a formal type for a process descriptor in Java, it is convenient to wrap a process ID into a <CODE>ProcessDescriptor</CODE>. The following Java code illustrates the use of a <CODE>ProcessDescriptor</CODE>
<PRE>
  public void example() {
	 ProcessManager manager = ProcessManager.getManager();
	 ProcessDescriptor[] list = manager.getList();

	 ProcessDescriptor pcurr = manager.getCurrentProcess();

	 int iMax = list.length;
	 for ( int i = 0; i &lt; iMax; i++ ) {
		if ( pcurr.equals( list[ i ] ) ) {
		  continue;
		}

		manager.killProcess( list[ i ] );
	 }
  }
</PRE>
<P>A <CODE>ProcessDescriptor</CODE> is not an instance of <CODE>java.lang.Process</CODE> and cannot be. In a cluster arrangement, where many process managers are linked together across a network, the <CODE>getList()</CODE> method returns a list of processes on more that one machine. A direct reference to a process cannot be used. Only the <CODE>pid</CODE> field of a <CODE>ProcessDescriptor</CODE> should be passed from one machine to another. With load balancing, <CODE>Runtime.exec()</CODE> may create a real process on another machine. A network implementation of a process manager enables any process to kill any other process within the cluster.</P>
<PRE>
public class ProcessDescriptor {
  public ProcessDescriptor( int v ) {
	 pid = v;
  }
  public int getPID() {
	 return pid;
  }
  public boolean equals( Object v ) {
	 try {
		ProcessDescriptor other = (ProcessDescriptor) v;

		/* *L!
		if ( pid = v.getPID() ) {
		  return true;
		}
		else {
		  return false;
		}
		*/
		return pid == other.getPID();
	 }
	 catch( ClassCastException e ) {
		return false;
	 }
  }
  private int pid;
}
</PRE>
<H4>System process</H4>
<P>To attach to the system process, it may be possible to use a constant process ID of 0. But, it would be better to always get the system process descriptor from the process manager.</P>
<PRE>
  public void example() {
	 ProcessManager manager = ProcessManager.getManager();

	 ProcessDescriptor psystem = manager.getSystemProcess();
	 manager.killProcess( psystem );
  }
</PRE>
<H4>Proxy required</H4>
<P>When one process starts another, two process IDs are always involved. Each process has a unique ID. Each process can be killed independently. One process cannot own another. The process manager owns all processes.</P>
<P>In the following example, we have a process running with a process ID of 71. What happens when process 71 starts another process?</P>
<P>Process 71 invokes the <CODE>exec()</CODE> method of <CODE>java.lang.Runtime</CODE>. The entire environment for the new process is passed to the <CODE>exec()</CODE> method. By default, every system property is copied into a string array and passed as the <CODE>env</CODE> parameter to <CODE>exec()</CODE>. Since user information is already a system property, user information is not passed separately to a new process.</P>
<P>Like the <CODE>java</CODE> tool, a modified environment can be passed to a new process with command line parameters to a <CODE>java</CODE> program. Or, a custom string array can be passed as the <CODE>env</CODE> parameter directly to the <CODE>exec()</CODE> method.</P>
<P>The new process gets a process ID of 72. Each new process gets its own process ID. Automatically, process 72 gets the process ID of its calling process, process 71. Each process, except process 0, gets a calling process ID. A new process can find -- indirectly -- the process that created it. A new process does not get a direct object reference to its parent, but a <CODE>ProcessDescriptor</CODE>.</P>
<P>Returning to the calling process, this process has a process ID of 71. It calls the <CODE>exec()</CODE> method of <CODE>java.lang.Runtime</CODE>. The instance of <CODE>java.lang.Process</CODE> returned to process 71 contains a <CODE>ProcessDescriptor</CODE> of 72.</P>
<P>Process 72 has no special privileges to the objects owned by by process 71 just because process 71 created it. Each object process 72 wants to share must be obtained through an object sharing <nolink>API. Process 71 might grant access to each object it wants to share with process 72.</P>
<P>If a process wants to share an object with any process, it can. It grants access to any process that askes. The object sharing mechanism is separate from the process mechanism, <EM>and should be</EM>.</P>
<H4>Lifetime</H4>
<P>When one process creates another, it does not own it. Process 71 does not own process 72. Both processes 71 and 72 are owned by the process manager. The process manager provides a mechanism for processes to start and stop other processes.</P>
<P>Process 72 can outlive process 71. Process 72 does not die when process 71 dies. This is important for an operating system to disposed of a user process that installs device drivers and is no longer needed.</P>
<PRE>
	  public void example() {
		 String cmd = "java org.jos.demo.Demo";
[1]	 Runtime.getRuntime().exec( cmd );
[2]	 System.exit();
	  }
</PRE>
<P><EM>Line 1:</EM> When this line is invoked in process 71, it creates process 72. Process 72 starts running before the return from <CODE>exec()</CODE>. Process 71 is not required to use the instance of <CODE>java.lang.Process</CODE> returned from the <CODE>exec()</CODE> method. That instance can be immediately garbage collected. The instance of <CODE>java.lang.Process</CODE> is always a proxy for the real process because the real process is not dependent on the lifetime of the calling process.</P>
<P><EM>Line 2:</EM> When this method is invoked in process 71, it destroys process 71 and only process 71. It does not destroy process 72. Process 72 cannot be owned by process 71; otherwise, this line would accidentally destroy both processes.</P>
<H4>About <nolink>MPCL</H4>
<P> <a href="/view.php?topic=BytecodeResource&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">BytecodeResource</a><wikitopic BytecodeResource /wikitopic> fits into the MPCL-compatible design by reusing the raw bytecode for boot classes for each new bytecode process. <nolink>MPCL is a proposed extension of the <a href="/view.php?topic=JavaVirtualMachineSpecification&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">JavaVirtualMachineSpecification</a><wikitopic JavaVirtualMachineSpecification /wikitopic> to allow multiple primordial class loaders within a virtual machine.</P>
<H4>About shutdown</H4>
<P>Like the example above, the process manager must be able to shutdown all processes. The process manager must attempt to shutdown each process normally. It might invoke <CODE>shutdown()</CODE>, a well-known machine code method of <CODE>mc_Process</CODE>. This method shuts down a process by asking the bytecode to call <CODE>System.exit()</CODE>.</P>
<P>After that, the process manager must kill each process that remains. It might invoke <CODE>kill()</CODE>, a well-known machine code method of <CODE>mc_Process</CODE>. This method stops each thread, closing each file/socket, and garbage collects every object and class owned by a process.</P>
<P>Finally, the process manager shuts itself down. It might halt the processor. It might exit to a foreign operating system. Or rather, the process manager might display a dialog box, a log-in screen, offering to restart.</P>
<P>With a little work, a process manager might reuse an existing instance of <CODE>mc_Process</CODE>, skipping part of the load of the standard class libraries.</P>
<H4>List, not tree</H4>
<P>This is acknowledged for the first time in Java 1 Platform: class loaders can form a tree. A class loader can use it's parent to load classes, rather than depending on the primordial class loader.</P>
<P>A process manager maintains a list of processes, not a tree. The <CODE>ProcessDescriptor</CODE> holds an index into what might be a sparcely populated array. A process ID can be reused, although not immediately.</P>
<P>If a calling process outlives the called process, the <CODE>ProcessDescriptor</CODE> and its <CODE>pid</CODE> becomes invalid. The <CODE>ProcessDescriptor</CODE> owned by the calling process still exists after the called process has died. Passing an invalid <CODE>ProcessDescriptor</CODE> to the process manager will result in a runtime exception.</P>
<H4>Non-diagram</H4>
<P>The following diagram illustrates an incorrect and unworkable view of a bytecode process.</P>
<TABLE BORDER="1" CELLPADDING="8" BGCOLOR="lightblue">
<TR>
<TD ALIGN="CENTER" VALIGN="TOP">
process manager
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="khaki">
<TR>
<TD>
process-1
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="white">
<TR>
<TD>
process-1.1
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="white">
<TR>
<TD>
process-1.1.1
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="white">
<TR>
<TD>
process-1.1.1.1
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="white">
<TR>
<TD>
process-1.1.1.1.1
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="white">
<TR>
<TD>
process-1.1.1.1.1.1
</TD>
</TR>
<TR>
<TD>
process-1.1.1.1.1.2
</TD>
</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD>
process-1.1.1.1.2
</TD>
</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD>
process-1.1.1.2
</TD>
</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD>
process-1.1.2
</TD>
</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD>
process-1.3
</TD>
</TR>
</TABLE>
</TD>
</TR>
<TR>
<TD>
process-2
</TD>
</TR>
<TR>
<TD>
process-3
</TD>
</TR>
<TR>
<TD>
:
</TD>
</TR>
<TR>
<TD>
process-<EM>n</EM>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<H4>Summary</H4>
<P>When we speak of parent and child processes, we are blurring the distinction of a process and its process ID. Elsewhere, this distinction may be unnecessary. But in a discussion of multiple bytecode processes within a single virtual machine, it is critical. Only a process <nolink>API that separates a real process from its proxy can manage the lifetime of a process.</P>
<P>Process and process manager are not limited to a multiple user operating system. It serves the needs of both single-user and multi-user systems. A multi-user operating system might be overkill in many consumer devices and in a server farm.</P>
<P>The process and process manager do not depend on <CODE>java.lang.Process</CODE>. An instance of <CODE>java.lang.Process</CODE> is only required to make a process manager compatible with the Java standard class library. While compatibility with the Java standard class library is very desireable, it is not required.</P>
<P>The search for a genuine bytecode process continues...</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FParentProcess&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FParentProcess&PHPSESSID=172418c4ea6925e78d9d28677f1433e5">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>ProcessAndPCLHandle.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="3ac479537f9bb0f95d2d3a867305a7a3" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//ProcessAndPCLHandle?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">ProcessAndPCLHandle</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/ProcessAndPCLHandle?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">info</a> on or <a href="/edit/Imported/ProcessAndPCLHandle?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FProcessAndPCLHandle&PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FProcessAndPCLHandle&PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ProcessPages&PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">ProcessPages</a><wikitopic ProcessPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (30 May 2000).</EM></P>
<H4>Introduction</H4>
<P>Let's assume for a moment that each primordial class loader has a handle. Each handle is unique within a virtual machine. How does bytecode obtain a handle to a new primordial class loader? How is a handle used?</P>
<P>An MPCL-compatible virtual machine has more than one primordial class loader. The real list of primordial class loaders is found in machine code. A handle is an index into the real list.</P>
<P>When primordial class loaders are stored in a linked list, a unique handle and primordial class loader is stored in each node. A linked list might be appropriate because a primordial class loader can be destroyed. It should be a long time before its handle is used again.</P>
<H4>Handles</H4>
<P>A handle might be 32 or 64 bits. The range of a 32-bit handle should be large enough to uniquely identify all concurrent primordial class loaders. Handles are assigned in sequence. If the first handle is zero (0), the next handles might be 1, 2, 3 and so on.</P>
<P>The handle is an index into a sparcely populated list. A primordial class loader is returned when given a valid handle. An invalid handle returns <CODE>NULL</CODE>. In the C programming language, finding a primordial class loader looks something like this:</P>
<PRE>
  PrimordialClassLoader *getPCL( PCL_HANDLE index );
</PRE>
<H4>Native methods</H4>
<P>Handles are only valid for existing primordial class loaders. A primordial class loader is created and then added to a list. After it is added to a list, it has a unique handle.</P>
<P>In the Java programming language, a native method can create a new primordial class loader, something like this:</P>
<PRE>
  public native int createPCL();
</PRE>
<P>In the C programming language, an implementation of this native method might look something like this:</P>
<PRE>
jint createPCL() {
  mc_PrimordialClassLoader *pcl = new mc_PrimordialClassLoader();
  PCL_HANDLE handle = pcl_list.add( pcl );
  return (jint) handle;
}
</PRE>
<P>A native method creates a primordial class loader, adds it to a list and returns its handle as a Java <CODE>int</CODE>.</P>
<H4>Proxy class</H4>
<P>A handle can be encapsulated by a proxy for each primordial class loader. A <CODE>PrimordialClassLoader</CODE> class can define a native method to create a primordial class loader. When a new instance of the bytecode class is created, a corresponding primordial class loader is created.</P>
<PRE>
public class PrimordialClassLoader
	 extends ClassLoader {
  public PrimordialClassLoader() {
	 handle = createPCL();
  }
  :
  private int handle;
}
</PRE>
<H4>Using a handle</H4>
<P>Like the <CODE>java</CODE> tool, a primordial class loader can launch a Java application. All classes and objects loaded by the primordial class loader belong to it. With its handle, a bytecode object can get/set additional properties of a primordial class loader.</P>
<UL>
<LI><STRONG><CODE>CLASSPATH</CODE> property</STRONG></P>
<P>A bytecode method might get/set a primordial class loader's <CODE>CLASSPATH</CODE> property. Probably, <CODE>CLASSPATH</CODE> can be set once.</P>
<LI><P><STRONG>Environment property</STRONG></P>
<P>A primordial class loader has an environment property. This is like an instance of <CODE>java.util.Properties</CODE>. Later, this property is used to initialize the <CODE>java.lang.System</CODE> class.</P>
<LI><P><STRONG>Standard I/O stream property</STRONG></P>
<P>A primordial class loader has a standard I/O stream property. This is like the in, out and err properties of <CODE>java.lang.System</CODE>. Later, this property is used to initialize the <CODE>java.lang.System</CODE> class.</P>
<LI><P><STRONG>Command property</STRONG></P>
<P>A bytecode method can get/set a primordial class loader's <CODE>Command</CODE> property. This is a string, like a command line in a shell or a location field in a browser.</P>
<LI><P><STRONG>Active property</STRONG></P>
<P>The active property is always false when a primordial class loader is created. Changing it to true creates a main thread, user interface thread and finalizer thread. Changing it to false (again), kills all threads and garbage collect all objects created by the primordial class loader. <CODE>setActive( false )</CODE> is a blocking call and does not return until there are no more objects owned by a primordial class loader.</P>
</UL>
<H4>Searching</H4>
<P>When given a handle, a <CODE>getPCL()</CODE> searches for the corresponding primordial class loader. When implemented as a linked list, the given handle is an exact match for the handle stored in a node.</P>
<PRE>
mc_PrimordialClassLoader *getPCL( PCL_HANDLE v ) {
  PCLNode pcurr = pcl_list::top;

  for (;;) {
	 if ( pcurr == NULL ) {
		return NULL;
	 }

	 if ( v == pcurr-&gt;handle ) {
		return pcurr-&gt;pcl;
	 }

	 pcurr = pcurr-&gt;next;
  }
}
</PRE>
<H4>Refinement</H4>
<P>In bytecode, the <CODE>PrimordialClassLoader</CODE> class would never use the <CODE>findSystemClass()</CODE> method. Instead, it uses a similar method for its corresponding primordial class loader.</P>
<PRE>
  public Class loadClass( String cn, boolean resolve )
		throws ClassNotFoundException {
	 Class c = cache.get( cn );
	 if ( c == null ) {
		byte[] bc = findSystemBytecode( handle, cn );
		if ( bc == null ) {
		  throw new ClassNotFoundException( cn );
		}
		c = defineClass( bc );
	 }
	 if ( resolve ) {
		resolveClass( c );
	 }
	 return c;
  }
  public native byte[] findSystemBytecode( int h, String cn );
</PRE>
<H4>Package name</H4>
<P>If you would like to contribute an experimental version of <nolink>MPCL-compatible classes to the <nolink>JOS Project, use the following pattern for your package names:</P>
<BLOCKQUOTE>
<CODE>org.jos. <EM>yourname</EM> .mpcl <EM>version</EM></CODE>
</BLOCKQUOTE>
<H4>Summary</H4>
<P>A primordial class loader seems to be the cornerstone of a bytecode process. A process <nolink>API seems to be more of a primordial class loader <nolink>API. With the introduction of a unique handle for each primordial class loader, it seems feasible to encapsulate the behavior of a bytecode process in a <CODE>PrimordialClassLoader</CODE> class.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FProcessAndPCLHandle&PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FProcessAndPCLHandle&PHPSESSID=3ac479537f9bb0f95d2d3a867305a7a3">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>VersionlessVirtualMachine.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="e223c612b13393a975fc0864d302537d" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=e223c612b13393a975fc0864d302537d">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=e223c612b13393a975fc0864d302537d">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=e223c612b13393a975fc0864d302537d">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=e223c612b13393a975fc0864d302537d">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=e223c612b13393a975fc0864d302537d">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//VersionlessVirtualMachine?PHPSESSID=e223c612b13393a975fc0864d302537d">VersionlessVirtualMachine</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=e223c612b13393a975fc0864d302537d">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=e223c612b13393a975fc0864d302537d" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=e223c612b13393a975fc0864d302537d"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/VersionlessVirtualMachine?PHPSESSID=e223c612b13393a975fc0864d302537d">info</a> on or <a href="/edit/Imported/VersionlessVirtualMachine?PHPSESSID=e223c612b13393a975fc0864d302537d">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FVersionlessVirtualMachine&PHPSESSID=e223c612b13393a975fc0864d302537d">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FVersionlessVirtualMachine&PHPSESSID=e223c612b13393a975fc0864d302537d">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=e223c612b13393a975fc0864d302537d">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=e223c612b13393a975fc0864d302537d">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=e223c612b13393a975fc0864d302537d">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=PlatformAPIPages&PHPSESSID=e223c612b13393a975fc0864d302537d">PlatformAPIPages</a><wikitopic PlatformAPIPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=e223c612b13393a975fc0864d302537d">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (20 December 1999), as inspired by a message from <a href="/view.php?topic=DigiGod&PHPSESSID=e223c612b13393a975fc0864d302537d">DigiGod</a><wikitopic DigiGod /wikitopic>.</EM></P>
<H4>Introduction</H4>
<P>An opcode interpreter must be able to interpret opcodes. All Java-compatible opcode interpreters must be able to interpret Java opcodes. Java technologies has been the fact that Java opcodes have remained the same for all "platforms". The machine code differences between Java 0, 1 and 2 "platforms" are insignificant. Consider the bytecode interpreter, the bytecode interpreter and nothing but the bytecode interpreter. There are only minor differences between a bytecode interpreter for Java 0, 1 and 2. There are only minor differences anticipated for a bytecode interpreter for the next "platform".</P>
<H4>Version-less virtual machine</H4>
<P>The difference between "platforms" has been the Java class libraries, not the bytecode interpreter. This is equivalent to the difference between a long line of Motorola 68000 microprocessors. Each processor is able to interpret the opcodes of the previous generation. There are only minor differences between chips. It is the machine code software that runs on a microprocessor that makes a significant difference.</P>
<P>As a <EM>virtual</EM> machine, a bytecode interpreter is identical in function to a microprocessor. A microprocessor is a finite-state machine, interpreting one opcode at a time. So is a bytecode interpreter.</P>
<H4>Separation of language</H4>
<P>A Java virtual machine is not tied to the Java programming language. Just as a microprocessor can interpret opcodes from many different source-level languages, a virtual machine is a bytecode interpreter only. It cannot distinguish between bytecodes emitted from a Java compiler or a Jasmin assembler.</P>
<H4>Platform potential</H4>
<P>In order for the Java technologies to reach their full potential, the bytecode interpreter must be isolated from runtime libraries and source-level languages, in the tradition of a Motorola 68000 or Intel 80386. The bytecode interpreter must be developed independently of the Java class libraries. All Java class libraries should be version-less, written in such a way they are reliably interpreted by all bytecode interpreters.</P>
<P>The Java language is only one of many languages that can create bytecode. Different languages should be able to provide their own runtime libraries. The opcodes and bytecode storage format is independent of any so-called "platform".</P>
<BLOCKQUOTE><STRONG>It is neither necessary nor desireable to reuse namespace.</STRONG></BLOCKQUOTE>
<P>A version-less virtual machine would be able to run all kinds of source-level languages, including those compiled by different flavors of javac from <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.0.2, <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.1.7 and <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.2.2.</P>
<P>A version-less virtual machine might deliver on a "run anywhere" promise made -- and then broken -- by Sun Microsystems. Consumers want the software industry to distribute bytecode and only bytecode. They do not want to upgrade their virtual machine just to accommodate a new bytecode library. When a virtual machine has been implemented on a foreign operating system, there is no need to implement it again and again. The bytecode is the only thing that improves significantly; the bytecode interpreter does not.</P>
<P>When the bytecode interpreter is separate from the Java class libraries, there are many benefits and a few new challenges. The benefits include a community's ability to run all the same bytecode at the same time. Class libraries can be downloaded across the network and interpreted on a version-less virtual machine.</P>
<H4>Proof</H4>
<P>Applet technology was a proof-of-concept. It is possible to deliver bytecode just in time to run on a client-side machine. Also, applet technology proved that changing class libraries after they have been distributed is fatal to future development.</P>
<H4>Bytecode native interface</H4>
<P>With a fully <nolink>BCNI-compliant implementation of the <CODE>java.*</CODE> packages, the differences between "platforms" becomes trivial.</P>
<H4>Compiling <nolink>classpath</H4>
<P>In the recompiling of source-level code from the <a href="/view.php?topic=ClasspathProject&PHPSESSID=e223c612b13393a975fc0864d302537d">ClasspathProject</a><wikitopic ClasspathProject /wikitopic>, it is necessary to use a pre-processor. A pre-processor has always been the technique of choice for delivering platform-specific class libraries.</P>
<P>Let's consider the classic dilemma of a core class called <CODE>ClassLoader</CODE>. Inside <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.0.2, the <CODE>loadClass()</CODE> method was declared protected, not public. In <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.1.7 and <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.2.2, a method with exactly the same name and signature was declared public. This presents a problem for anyone who has extended the <CODE>ClassLoader</CODE> class.</P>
<BLOCKQUOTE><EM>How can we maintain one copy of the source code -- and maintain perfect compatibility?</EM></BLOCKQUOTE>
<P>A pre-processor for the Java programming language makes this trivial. JAVA0 is defined for <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.0.x and higher. (Yes, it is possible for JAVA0 to be undefined in an experimental compiler.) JAVA1 is defined for <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.1.x and higher. JAVA2 is defined for <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.2.x and higher.</P>
<P>When we implement the source code for the <CODE>ClassLoader</CODE> class, we can use pre-processor commands, like this:</P>
<PRE>
// java/lang/ClassLoader.java
:
#ifdef JAVA1
  public Class loadClass( String name, boolean resolve ) {
#else
  protected Class loadClass( String name, boolean resolve ) {
#endif
:
</PRE>
<P>For a class that must be compiled with <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.1.x and higher, you can force <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=e223c612b13393a975fc0864d302537d">JDK</a> <wikitopic JDK /wikitopic>1.0.x to produce a compiler error:
<PRE>
#ifndef JAVA1
#error This implementation requires JDK 1.1.x (or higher)
#endif
</PRE>
<P>With a single copy of source-level code, you can create perfectly compatible classes with different package names:</P>
<PRE>
#ifdef BUILD_EXPERIMENTAL
package org.jos.experimental.somepackage;
#else
package org.jos.somepackage;
#endif
</PRE>
<P>With single copy of source-level code, you can alter import statements, too.</P>
<PRE>
#ifdef USES_EXPERIMENTAL
import org.jos.experimental.somepackage;
#else
import org.jos.somepackage;
#endif
</PRE>
<P>You can maintain single-source versions of <nolink>JOS and non-<nolink>JOS applications:</P>
<PRE>
#ifdef USES_JOS
import org.jos.java0.io.InputStream;
#else
import java.io.InputStream;
#endif
</PRE>
<P>You can maintain single-source versions of <nolink>AWT and <nolink>Swing components:</P>
<PRE>
#ifdef JAVA2
  import java.awt.swing.Button;
#else
  #ifdef JAVA1
	 import javax.swing.Button;
  #else
	 import java.awt.Button;
  #endif
#endif
</PRE>
<H4>Summary</H4>
<P>A version-less virtual machine, together with single-source and pre-processor, enables us to deliver on a promise of write-once and run-anywhere. When you write with a pre-processor, you can write one implementation of source code that compiles on more than one Java "platform". With a version-less virtual machine, you can run more than one "platform" on a single implementation of a bytecode interpreter.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FVersionlessVirtualMachine&PHPSESSID=e223c612b13393a975fc0864d302537d">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FVersionlessVirtualMachine&PHPSESSID=e223c612b13393a975fc0864d302537d">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

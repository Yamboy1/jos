<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>BytecodeFactory.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="8811c0b625aa382cee4e70368fb6447c" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//BytecodeFactory?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">BytecodeFactory</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=8811c0b625aa382cee4e70368fb6447c" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=8811c0b625aa382cee4e70368fb6447c"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/BytecodeFactory?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">info</a> on or <a href="/edit/Imported/BytecodeFactory?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FBytecodeFactory&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FBytecodeFactory&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=8811c0b625aa382cee4e70368fb6447c">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=BytecodePages&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">BytecodePages</a><wikitopic BytecodePages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic>.</EM>
<H4>Introduction</H4>
<P>Classes are created from bytecode. Bytecode has to be stored somewhere. We can create custom bytecode factories that retrieve bytecode stored in lots of different containers. We can build one class loader that uses a bytecode factory to create classes.</P>
<P>The power of the bytecode factory mechanism is best illustrated by the <a href="/view.php?topic=BytecodeCache&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">BytecodeCache</a><wikitopic BytecodeCache /wikitopic>.</P>
<P>After working through the precedent set by the Java <nolink>API, it becomes clear that a <a href="/view.php?topic=ClassFactory&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">ClassFactory</a><wikitopic ClassFactory /wikitopic> isn't exactly what we're after. That is why <CODE>java.lang.ClassLoader</CODE> is an obtuse solution for loading bytecode from different containers.</P>
<H4>Interface</H4>
<P>The bytecode factory reads bytecode for Java classes. The bytecode factory is an interface, like this:
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>public interface BytecodeFactory {
  public boolean acceptsURL( String url );
  public byte[] getBytecode( String url );
}</PRE>
</TD>
</TR>
</TABLE>
<H4>Example 1</H4>
<P>The following example demonstrates how the bytecode factory is used. The bytecode factory should be used by <a href="/view.php?topic=THE&web=Imported&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">THE</a> <wikitopic THE /wikitopic>class loader, because only one class loader is needed.
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public void example() {
  String cn = "org.jos.editor.PlainTextEditor";
  String prefix;
  Class c;

  MasterBytecodeFactory factory =
		new MasterBytecodeFactory();
  factory.addFactory( new SystemBytecodeFactory() );
  factory.addFactory( new HTTPBytecodeFactory() );
  factory.addFactory( new ApplicationServiceBytecodeFactory() );

  [1]
  prefix = "x-bytecode:system:";
  c = factory.getBytecode( prefix + cn );

  [2]
  prefix = "x-bytecode:http://host.domain.com/";
  c = factory.getBytecode( prefix + cn );

  [2]
  prefix = "x-bytecode:app://host.domain.com/";
  c = factory.getBytecode( prefix + cn );
}</PRE>
</TD>
</TR>
<TR>
<TD>
<OL>
<LI>The <EM>system</EM> subprotocol would use a system bytecode factory to load bytecode from a local drive.
<LI>The <EM>http</EM> subprotocol would use a (mythical) <nolink>HTTP bytecode factory to download bytecode from an <a href="/view.php?topic=HTTP&web=Imported&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">HTTP</a> <wikitopic HTTP /wikitopic>service. Applications benefit from bytecode stored on an <nolink>HTTP service.
<LI>The <EM>app</EM> subprotocol would use a (mythical) class factory that downloads bytecode from an application service. Applications and applets benefit from application services, which cache the most recent releases of your favorite applications.
</OL>
</TD>
</TR>
</TABLE>
<P>A system class factory implements the <CODE>BytecodeFactory</CODE> interface and finds bytecode on a local drive, like this:
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>public interface SystemBytecodeFactory
	 extends BytecodeFactory {
  public static String protocolPrefix = "x-bytecode:system:";
  public SystemBytecodeFactory() {
  }
  public boolean acceptsURL( String url ) {
	 if ( url == null ) {
		return false; 
	 }
	 if ( !url.startsWith( protocolPrefix ) ) {
		return false;
	 }
	 int pos url.indexOf( "//" );
	 if ( pos &gt;= 0 ) {
		return false;
	 }
	 return true;
  }
  public byte[] getBytecode( String url ) {
	 if ( !acceptsURL( url ) ) {
		return null;
	 }
	 String cn = 
		  url.substring( protocolPrefix.length();
	 // load bytecode from disk
	 return loader.findBytecode( cn );
  }
  private BytecodeLoader loader =
		new BytecodeLoader();
}</PRE>
</TD>
</TR>
</TABLE>
<P>A master bytecode factory implements the <CODE>BytecodeFactory</CODE> interface and dispatches requests for bytecode to any registered bytecode factory. Programmers extend this design with custom bytecode factories.
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>public interface MasterBytecodeFactory
	 implements BytecodeFactory {
  public MasterBytecodeFactory() {
  }
  public boolean acceptsURL( String url ) {
	 int iMax = manager.getCount();
	 for ( int i = 0; i &lt; iMax; i++ ) {
		BytecodeFactory item = manager.getItem( i );
		if ( item.acceptsURL( url ) ) {
		  return true;
		}
	 }
	 return false;
  }
  public byte[] getBytecode( String url ) {
	 int iMax = manager.getCount();
	 for ( int i = 0; i &lt; iMax; i++ ) {
		BytecodeFactory item = manager.getItem( i );
		byte[] buf = item.getBytecode( url );
		if ( buf != null ) {
		  return buf;
		}
	 }
	 return null;
  }
  public void addFactoryByName( String v ) {
	 Class c = Class.forName( v );
	 if ( c == null ) {
		return;
	 }
	 Object o = c.newInstance();
	 if ( !( o instanceof BytecodeFactory ) ) {
		return;
	 }
	 addFactory( (BytecodeFactory) o );
  }
  public void addFactory( BytecodeFactory v ) {
	 removeFactory( v );
	 int index = manager.getCount();
	 manager.setItem( index, v );
  }
  public void removeFactory( BytecodeFactory v ) {
	 int iMax = manager.getCount();
	 for ( int i = 0; i &lt; iMax; i++ ) {
		BytecodeFactory item = manager.getItem( i );
		if ( item == v ) {
		  manager.setItem( i, null );
		}
	 }
  }
  private BytecodeFactoryManager manager =
		new BytecodeFactoryManager();
}</PRE>
</TD>
</TR>
</TABLE>
<H4>No problems</H4>
<P>Unlike the problems with <CODE>java.lang.ClassLoader</CODE> and <nolink>ClassFactory, the bytecode factory is able to use a single class loader and many custom bytecode factories. There is no problem when classes from one source are mixed with classes from another--they all come from the same source.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FBytecodeFactory&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FBytecodeFactory&PHPSESSID=8811c0b625aa382cee4e70368fb6447c">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

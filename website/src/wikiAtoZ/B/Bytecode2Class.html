<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>Bytecode2Class.Main @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="fcc13476335b0fe5ae94eca5250ae683" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//Bytecode2Class?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">Bytecode2Class</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Main/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">Main</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Main/Bytecode2Class?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">info</a> on or <a href="/edit/Main/Bytecode2Class?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FBytecode2Class&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FBytecode2Class&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Main/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">topics</a>, <a href="/hubsnodes/Main/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Main/?PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<a href="/view.php?topic=BytecodePages&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">BytecodePages</a><wikitopic BytecodePages /wikitopic>
<HR>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (revised 1 September 2000).</EM>
<H4>Introduction</H4>
Something must happen to turn bytecode into an unresolved <CODE>java.lang.Class</CODE>. What is it? This article provides a useful definition of bytecode, an internal class object, and how they are closely related.
<H4>About bytecode</H4>
Bytecode is raw. It is in the form of bytes in a byte array (<CODE>byte[]</CODE>). It is typically the content of a .class file, such as produced by the <CODE>javac</CODE> tool.
<H4>From bytecode to class</H4>
The bytecode interpreter can't use bytecode directly as a byte array, can it? Individual bytes must be turned into <CODE>char</CODE>s and <CODE>String</CODE>s and such. Additional lists must be maintained for constants, fields, methods, attributes and such.
</P><P>
Somewhere, the bytecode must be broken down into methods and fields, so that the bytecode interpreter can execute a method by name.
<H4>Not practical reflection</H4>
Practical reflection is not useful here. Quite the opposite, practical reflection assumes you must start with a <CODE>Class</CODE> and find methods and fields. Practical reflection is found in the <CODE>java.lang</CODE> and <CODE>java.lang.reflect</CODE> packages. There is no provision from going the other way, from methods and fields to a class.
<H4>About class objects</H4>
Inside the standard Java class library, there is a <CODE>Class</CODE> class. Technically, this "class" is actually an interface to native methods inside a virtual machine. The implementation of these methods are very specific to a virtual machine. Each virtual machine designer has the freedom to implement this class differently, enabling the widest range of specialized virtual machines.
</P><P>
What is behind a <CODE>java.lang.Class</CODE> object?
</P><P>
The real class object is embedded within a virtual machine. An internal class object must have its own internal fields. It must know, for example, if it has already been resolved. No class should be resolved twice. It should resolve itself if it has not already been resolved.
</P><P>
When a multiple-process virtual machine resolves a system class, it shouldn't resolve a class that has already been resolved, either. When many different processes ask for a class to be resolved all at the same time, how is that handled? The class itself has a monitor. The thread that's resolving a class should obtain its monitor. When multiple threads attempt to resolve a class, all but one are blocked.
<H4>Black box</H4>
The power of object-oriented technology is that we don't have to know what's behind the <CODE>Class</CODE> object most of the time. Like a black box, details of a <CODE>Class</CODE> object are appropriately hidden. It is only when we are attempting to create a new implementation of an object that we need to know. An object hides its implementation from other objects at runtime. It is almost as if each object is working in its own independent address space. This isn't real. It is usually provided at compile-time by the semantics of the language. Java provides this independence at both compile-time and runtime.
<H4>Source</H4>
Where does the bytecode come from? All within Java, it is possible to compile source code at runtime, turn it into a byte array, turn a byte array into a class, and run the code in the class. While the process is officially split between <CODE>javac</CODE> to create the bytecode and <CODE>java</CODE> to run the bytecode, <CODE>javac</CODE> is just another Java application.
<H4>About bytecode process</H4>
Sharing the bytecode among many independent processes does not necessarily include sharing the stack or static variables.
<UL> <LI> There may be a one-time-only initialization of TCP/IP for <CODE>java.net.InetAddress</CODE>. Should this code be initialized once when <nolink>JOS boots or once per process? TCP/IP addresses and machine names can change over the lifetime of a <nolink>JOS-compatible virtual machine, but cannot change over the lifetime of a virtual machine that depends on a foreign operating system.
<LI> <nolink>System.in, <nolink>System.out and <nolink>System.err are good examples of static variables that should be initialized once per process. It goes toward the idea that the System object should not have been static after all.
</UL> The relationship between System to <a href="/view.php?topic=Process&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">Process</a><wikitopic Process /wikitopic> is similar to the relationship between <nolink>AppletContext to Applet. A process should be given a System object by the virtual machine. I believe a Process must exist before a <nolink>ProcessContext or <a href="/view.php?topic=ProcessEnvironment&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">ProcessEnvironment</a><wikitopic ProcessEnvironment /wikitopic> object.
</P><P>
This is getting too confusing. A <STRONG>real</STRONG> singleton must be initialized once when <nolink>JOS boots. Other singletons are not really singletons. They are initialized once per application instance.
<H4>New JVM</H4>
Compare this to what actually happens when you start the same application in a new Java Virtual Machine (JVM). The new <nolink>JVM is a brand new world. It has its own stack. It has its own variables. The data address space of a new <nolink>JVM is completely independent of all other JVMs.
</P><P>
The code address space of a <nolink>JVM has already been optimized with shared objects (or dynamic link libraries). A static variable inside a shared object, even when using JNI, is one per real machine.
</P><P>
So, the <nolink>ProcessEnvironment should have its own stack and object heap. It follows that it needs its own garbage collector and finalizer threads.
</P><P>
Shared objects cannot be passed between processes, <EM>and shouldn't be</EM>. Even inside <nolink>JOS, standard inter-process communication should be required to pass data back and forth between independent processes. Although it is tempting, a shared object heap would not provide an independent process.
</P><P>
Since a <nolink>ProcessEnvironment has its own object heap, shutting down a process or killing a process is easy. All of the objects belong to the process environment are garbage-collected. Maybe they're finalized.
</P><P>
I understand we want one class to handle the complicated function of allocating objects on the heap. When this class has been written, it will be easy to make an instance of this class for each process environment.
<HR>
Bytecode must be converted into a class. The <a href="/view.php?topic=JavaVirtualMachineSpecification&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">JavaVirtualMachineSpecification</a><wikitopic JavaVirtualMachineSpecification /wikitopic> breaks down the process into four phases:
<UL> <LI> loading,
<LI> verifying,
<LI> linking, and
<LI> resolving.
</UL> This implies four kinds of objects are found inside the virtual machine.
<UL> <LI> A <CODE>Loader</CODE> object does the loading;
<LI> a <CODE>Verifier</CODE> object does the verifying;
<LI> a <CODE>Linker</CODE> object does the linking; and
<LI> a <CODE>Revolver</CODE> object does the resolving.
</UL> -- <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (1 September 2000)<BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FBytecode2Class&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FBytecode2Class&PHPSESSID=fcc13476335b0fe5ae94eca5250ae683">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

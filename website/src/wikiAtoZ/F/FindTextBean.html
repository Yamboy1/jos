<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>FindTextBean.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="a0657630bae647c22a235442b95c59ad" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=a0657630bae647c22a235442b95c59ad">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=a0657630bae647c22a235442b95c59ad">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=a0657630bae647c22a235442b95c59ad">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=a0657630bae647c22a235442b95c59ad">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=a0657630bae647c22a235442b95c59ad">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//FindTextBean?PHPSESSID=a0657630bae647c22a235442b95c59ad">FindTextBean</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=a0657630bae647c22a235442b95c59ad">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=a0657630bae647c22a235442b95c59ad" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=a0657630bae647c22a235442b95c59ad"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/FindTextBean?PHPSESSID=a0657630bae647c22a235442b95c59ad">info</a> on or <a href="/edit/Imported/FindTextBean?PHPSESSID=a0657630bae647c22a235442b95c59ad">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FFindTextBean&PHPSESSID=a0657630bae647c22a235442b95c59ad">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FFindTextBean&PHPSESSID=a0657630bae647c22a235442b95c59ad">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=a0657630bae647c22a235442b95c59ad">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=a0657630bae647c22a235442b95c59ad">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=a0657630bae647c22a235442b95c59ad">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
__Objective:__
to produce a searching text engine in the form of a <a href="/view.php?topic=JavaBean&PHPSESSID=a0657630bae647c22a235442b95c59ad">JavaBean</a><wikitopic JavaBean /wikitopic>. Will be pluggable with multiple GUIs and TUIs. 
</P><P>
This bean should contain the following features:
</P><P>
<EM>Inputs:</EM>
<UL> <LI>  the user will set the text to be searched (java.awt.datatransfer.Transferable or java.io.Reader)
<LI>  the text string being searched for (java.lang.String)
<LI> Use of wildcards (?,*, !, etc) in search text
<LI> Available options:
<UL> <LI> a boolean whether to ignore case
<LI> a boolean for whole words only
<LI> Optional search up, down or all from offset
<LI> optional int indexed offset
</UL> </UL> <EM>Outputs:</EM>
<UL> <LI> a (long) indexed postition of sub-string
<LI> Implementation of Enumeration or Iterator interfaces
</UL> 
Keep in mind - Maximum Code Reusability
<HR>
Started: <a href="/view.php?topic=StefanBorg&PHPSESSID=a0657630bae647c22a235442b95c59ad">StefanBorg</a><wikitopic StefanBorg /wikitopic>, 6 Nov 1997
Edited: <a href="/view.php?topic=StefanBorg&PHPSESSID=a0657630bae647c22a235442b95c59ad">StefanBorg</a><wikitopic StefanBorg /wikitopic>, 13 Nov 1997
</P><P>
Return to <a href="/view.php?topic=ApplicationsGroup&PHPSESSID=a0657630bae647c22a235442b95c59ad">ApplicationsGroup</a><wikitopic ApplicationsGroup /wikitopic>
<HR>
Code:
<PRE>
package jos.utils.find;
/** FindTextBean
 * This is the 'underlying architecture' or 'workhorse'.
 * Please refer to JOS Collaborative Effort for more info.
 * 
 * Author:	Stefan Borg
 * Started Date:	6 Nov 1997
 * Edited Date:	11 Nov 1997
 * Revise:	0.12
 */

import java.beans.Beans;
import java.io.*;

public class FindTextBean implements Serializable {

/** Instance variables.
 */
	private boolean debug = false;
	private Reader reader = null;
	private char[] searchBuffer = null;
	private long offset = 0;
	private boolean ignoreCase = false;
	private boolean wholeWords = false;

/** Internal variables.
 */
	private char[] buffer = null;
	private int searchLength = 0;
	private int bufferOffset = 0;

/** Enables/disables system console messages for debuggin purposes.
 */
	public void setDebug(boolean debug) { this.debug = debug; }
	public boolean getDebug() {	return debug;	}

/** Set/gets source text for searching through.
*/
	public void setReader(Reader reader) { this.reader = reader; }
	public Reader getReader() {	return reader;	}

/** Set/gets search text for searching for.
 */
	public void setSearchText(String searchText) { 
		searchBuffer = searchText.toCharArray();
		searchLength = searchBuffer.length;
	}
	public String getSearchText() {	return new String(searchBuffer);	}

/** Set/gets option for ignoring case.
 */
	public void setIgnoreCase(boolean ignoreCase) { this.ignoreCase = ignoreCase; }
	public boolean getIgnoreCase() {	return ignoreCase;	}

/** Set/gets option for whole words only.
 */
	public void setWholeWords(boolean wholeWords) { this.wholeWords = wholeWords; }
	public boolean getWholeWords() {	return wholeWords;	}

/** Set/gets offset value to begin searching from. Later to become a protected method.
 */
	public void setOffset(long offset) { this.offset = offset; }
	public long getOffset() {	return offset;	}

/** Returns index value of found text. Maybe later to become a protected method.
 * Queries:
 *	 should reading depend on Reader.ready()??
 */
	public long getIndex() throws InvalidSourceException {

// Checks all inputs are available
		check();

		long index = -1;
		Reader tempReader = reader;
		buffer = new char[searchLength];
		long currentIndex = offset;
		bufferOffset = 0;

	out:
		try {

// Skips offset value
			tempReader.skip(currentIndex);

			do {

// Reads stream into buffer
				if (tempReader.read(buffer, bufferOffset, 
						(searchLength - bufferOffset)) == -1)
					break out;

				currentIndex += searchLength - bufferOffset;

// Until buffer matches search text
			} while (!compareBuffer());

			index = currentIndex - searchLength;
		} catch (IOException io) {
			io.getLocalizedMessage();
			io.printStackTrace();
		}

		if (debug)
			System.err.println("getIndex = " + index);

		return index;
	}

/** Returns true if arrays are equal.
 */
	private boolean compareBuffer() {
		boolean result = true;

		try {
			for (int i = 0; i &lt; searchLength; i++)
				result = compareCharacter(buffer[i], i);
		} catch(NullPointerException npe) {
			result = false;
		}

// if unequal, check that start of search text is not in the buffer
		if (!result) {
			bufferOffset = checkBuffer();
		}

		return result;
	}

/** Returns index of first character equal to first
 * character of search text. Returns -1 if none found.
 */
	private int checkBuffer() {
		for (int i = 1; i &lt; searchLength; i++) {
			if (compareCharacter(buffer[i], 0)) {
				if (debug)
					System.err.println("found @:"+i);
				return shiftBuffer(i);
			}
		}
		return 0;
	}

/** Shifts array into new position. Returns last index.
 */
	private int shiftBuffer(int first) {
		char[] tmpBuffer = buffer;
		int i = 0;
		for (; i &lt; (searchLength - first); i++) {
			buffer[i] = tmpBuffer[first + i];
		}

		if (debug)
			System.err.println("shifted:"+buffer);

		return i;
	}

/** Returns true if comparison of characters at a position in the
 * search text are equal.
 */
	private boolean compareCharacter(char bufferChar, int pos) {
		boolean result = true;
		char searchChar = searchBuffer[pos];

		if (ignoreCase) {
			bufferChar = Character.toLowerCase(bufferChar);
			searchChar = Character.toLowerCase(searchChar);
		}

		if (bufferChar != searchChar) {
			result = false;
		}
		return result;
	}

/** Returns true if Reader stream and search text are valid.
 */
	private void check() throws InvalidSourceException {
		if (reader == null) {
			throw new InvalidSourceException();
		}
	}

/** InvalidSourceException class.
 */
	class InvalidSourceException extends Exception {
		InvalidSourceException() {
			super("Reader source does not exist.");
		}
	};

/** For testing.
 */
	public static void main(String args[]) {
		try {
			FindTextBean ftb = (FindTextBean)Beans.instantiate(null, "jos.utils.find.FindTextBean");
			ftb.setDebug(true);
			ftb.setReader(new FileReader("META-INF/MANIFEST.MF"));
			ftb.setSearchText("bean");
			ftb.setOffset(21);
			ftb.setIgnoreCase(true);

			System.out.println(ftb.getIndex());
		} catch (Exception e) {
			e.getLocalizedMessage();
			e.printStackTrace();
		}
	}
}
</pre><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FFindTextBean&PHPSESSID=a0657630bae647c22a235442b95c59ad">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FFindTextBean&PHPSESSID=a0657630bae647c22a235442b95c59ad">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

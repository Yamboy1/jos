<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>FieldOptimization.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="c9e25c4a661e5a66fef642c57d302d93" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//FieldOptimization?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">FieldOptimization</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/FieldOptimization?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">info</a> on or <a href="/edit/Imported/FieldOptimization?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FFieldOptimization&PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FFieldOptimization&PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=BytecodePages&PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">BytecodePages</a><wikitopic BytecodePages /wikitopic></FONT>
<HR SIZE="1" NOSHADE>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (13 January 2001).</EM></P>
<H4>Introduction</H4>
<P>It might be possible to optimize access and modification of fields. This kind of optimization can be performed by an optimized interpreter.</P>
<H4>Un-optimized</H4>
<P>Field access and modification should be understood in its un-optimized form. Both access and modification require a mandatory conversion from field name to field number. Fields are always stored as a 32-bit integer array within a standard heap. Values within this array are accessed and modified by field number.</P>
<P>A class always determines the name of a field. Thus, the class is significant when converting from field name to field number.</P>
<P>Each field has a unique field number. While a class can define a field with the same name as a field in its superclass, the fields have different field numbers.</P>
<PRE>
long getFieldNumber( const ClassClass *c, const char *n );
</PRE>
<P>No matter how many times this function is called with the same class and field name, it must return the same field number.</P>
<H4>Premise</H4>
<P>The memory layout of an object is vm-specific. And yet, given any class, the memory layout of an instance must be identical for every instance within a specific virtual machine. This memory layout accounts for a class and all of its superclasses.</P>
<P>Every instance of a class must be layed out the same way. When laying out an instance of a class, a layout template can be stored with the class. The instance size, or the number of 32-bit values in each instance on the heap, is always the same. During this layout, field names are bound to field numbers and cannot change for the lifetime of the class.</P>
<H4>Fields</H4>
<P>Layout information can be closely associated with a class and used by the <CODE>new</CODE> opcode when creating a new object. The arrangement of fields on the heap will typically look like this:</P>
<TABLE BORDER="1" CELLSPACING="0">
<TR>
<TD>field-1</TD>
<TD>field-2</TD>
<TD>field-3</TD>
<TD>...</TD>
<TD>field-<EM>n</EM></TD>
</TR>
</TABLE>
<P>And yet, access and modification of a field must be performed by class, like this:</P>
<TABLE BORDER="1" CELLSPACING="0">
<TR>
<TD>class-1</TD>
<TD>field-1</TD>
<TD>field-2</TD>
<TD>field-3</TD>
<TD>...</TD>
<TD>field-<EM>n</EM></TD>
</TR>
<TR>
<TD>class-2</TD>
<TD>field-1</TD>
<TD>field-2</TD>
<TD>field-3</TD>
<TD>...</TD>
<TD>field-<EM>n</EM></TD>
</TR>
<TR>
<TD>class-3</TD>
<TD>field-1</TD>
<TD>field-2</TD>
<TD>field-3</TD>
<TD>...</TD>
<TD>field-<EM>n</EM></TD>
</TR>
</TABLE>
<P>The <CODE>size</CODE> of a class includes the <CODE>size</CODE> of its superclass. A field index is a field number plus the <CODE>size</CODE> of a superclass. This dependency means a superclass must be layed out before a class. Since the size of a class never changes, it can be stored with each class.</P>
<PRE>
field-index = superclass-size + field-number
</PRE>
<H4>Optimized for size</H4>
<P>When optimizing for size, the layout of a class can be cached. Using a most-recently-used approach, it can be discarded and later re-calculated. The layout of an instance can be determined with each access and modification of a field and when creating a new instance.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FFieldOptimization&PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FFieldOptimization&PHPSESSID=c9e25c4a661e5a66fef642c57d302d93">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

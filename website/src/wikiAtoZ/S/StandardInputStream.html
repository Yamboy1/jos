<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>StandardInputStream.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="ac438c06907d0f071c9a7e9c1584cc4c" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//StandardInputStream?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">StandardInputStream</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/StandardInputStream?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">info</a> on or <a href="/edit/Imported/StandardInputStream?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FStandardInputStream&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FStandardInputStream&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<I>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic>.</I>
<TABLE WIDTH="100%">
<TR>
<TD VALIGN="TOP" WIDTH="20%">
<FONT FACE="Arial">Summary</FONT>
</TD>
<TD>
<P>To experiment with the virtual keyboard now,
<OL>
<LI><EM>Build your own <a href="/view.php?topic=CompatibleKeyboard&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">CompatibleKeyboard</a><wikitopic CompatibleKeyboard /wikitopic>, and</EM>
<LI><EM>Use it with any <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">JVM</a> <wikitopic JVM /wikitopic>to experiment with an event driven standard input stream.</EM>
</UL>
</P>
</TD>
</TR>
<TR>
<TD VALIGN="TOP" WIDTH="20%">
<FONT FACE="Arial">Introduction</FONT>
</TD>
<TD>
<P>It would be a disaster to dispatch every keystroke and mouse event to every process in a multiple process environment. In this environment, there are many processes running at the same time. It becomes necessary to virtualize the standard input stream for each process.</P>
<P>This is an important concept. It helps us understand how all of the real hardware devices are virtualized for each process.</P>
<P>Traditionally, processes are said to run either in the foreground or background. While a foreground process receives keystoke and mouse events; a background process does not.<P>
<P>A process can run in the background for a long time. If a program cannot continue without a keystroke, it must wait. If it cannot continue without a mouse event, it must wait. It might have to wait for a long time.</P>
<P>When working with multiple processes, you can switch from one process to another. Each operating system has a different way of process-switching. When choosing the new foreground process, the OS kernel must carefully switch from one process for another.</P>
<P>When working with multiple processes, you can launch a new process. Each operating system has a different way of launching a new process. The <nolink>API for a multiple process OS should provides a choice between launching a process in the foreground or background.</P>
<P>Some programs are designed to always run in the background. They have no need for the standard input stream. Some people call these daemons.
</TD>
</TR>
<TR>
<TD VALIGN="TOP" WIDTH="20%">
<FONT FACE="Arial">Kernel mechanism</FONT>
</TD>
<TD>
<P>An OS kernel needs to provide a mechanism to select one process as the current, or <EM>foreground</EM> process. The foreground process is usually given the highest priority. It is up to the kernel to provide the foreground process with extra <a href="/view.php?topic=CPU&web=Imported&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">CPU</a> <wikitopic CPU /wikitopic>cycles.</P>
<P>The <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">JOS</a> <wikitopic JOS /wikitopic>kernel needs to keep track of which process is the current process, too. The kernel has one real keyboard driver and one real mouse driver. All of the scancode and mouse events are delivered to the kernel. The kernel needs to dispatch these keystroke events to the <EM>current</EM> process. The kernel needs to generate JOS-compatible keystroke events.</P>
</TD>
</TR>
<TR>
<TD VALIGN="TOP" WIDTH="20%">
<FONT FACE="Arial">Experiment now</FONT>
</TD>
<TD>
<P>Sun's Java Virtual Machine (JVM) already has a standard input stream. It is called <CODE>System.in</CODE>. We can use it to experiment now with the virtual keyboard.</P>
<P>We need a class to
<UL>
<LI>read the standard input stream, and
<LI>generate keystroke/scancode events.
</UL>
<P>It must run in Sun's JVM, too.</P>
</TD>
</TR>
<TR>
<TD VALIGN="TOP" WIDTH="20%">
<FONT FACE="Arial">Design</FONT>
</TD>
<TD>
<P>The following design illustrates a %Dispatcher for standard input stream, using a keyboard hardware as an example.</P>
<P>The keyboard dispatcher must have a mechanism to keep track of the <EM>current</EM> program. This dispatcher must have only one current program at a time. The kernel might control the keyboard dispatcher so that it always has direct access to the <EM>foreground</EM> process.</P>
<TABLE WIDTH="100%" BORDER=1>
<TR>
<TD>
backward compatible keyboard extends keyboard interface to provide <CODE>System.in</CODE>
</TD>
</TR>
<TR>
<TD>
virtual keyboard interface (converts scan codes to VK_*, maybe)
</TD>
</TR>
<TR>
<TD>
scan code listener interface
</TD>
</TR>
<TR>
<TD BGCOLOR="#EFEFEF">
keyboard dispatcher keeps track of current listener, corresponding to the foreground process
</TD>
</TR>
<TR>
<TD>
real keyboard interrupts keyboard dispatcher
</TD>
</TR>
</TABLE>
</P><P>
<P>Below the line, the real keyboard sends real interrupts to the dispatcher. Crossing the line, the dispatcher decides which program is the current one and forward the scan codes to it. Above the line, a Keyboard implements the <nolink>ScanCodeListener interface. Each process has its own Keyboard object. A program (Process) uses its Keyboard object to read keystrokes.</P>
<P>Here is the <a href="/view.php?topic=ScanCodeListener&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">ScanCodeListener</a><wikitopic ScanCodeListener /wikitopic> interface:</P>
</P><P>
<TABLE WIDTH="100%">
<TR>
<TD BGCOLOR="#EFEFEF">
<PRE>
public interface ScanCodeListener {
  public void onScanCode( int v );
}
</PRE>
</TD>
</TR>
</TABLE>
</P><P>
<P>In keeping with the dispatcher model, the keystroke dispatcher must pass keyboard scan codes directly through to the current scan code listener. The dispatcher should not provide a scan code buffer. Since there could be a nasty scan code listener that takes a long time to return from onScanCode(), the next level up is the <a href="/view.php?topic=KeystrokeListener&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">KeystrokeListener</a><wikitopic KeystrokeListener /wikitopic>.</P>
<P>The virtual keyboard interface provides a scan code buffer.</P>
<TABLE WIDTH="100%">
<TR>
<TD BGCOLOR="#EFEFEF">
<PRE>
public class Keyboard
	 implements ScanCodeListener {
  public boolean isKeystroke() {
	 return queue.isEmpty();
  }

  public int getKeystroke() {
	 return queue.getNextItem()
  }

  // from ScanCodeListener
  public void onScanCode( int v ) {
	 if ( /* scan code is for multiple byte keystroke */ ) {
		queue.addItem( firstHalf( v ) );
		queue.addItem( secondHalf( v ) );
	 }
	 else {
		queue.addItem( v );
	 }
  }


  private KeystrokeQueue queue = new KeystrokeQueue();
}
</PRE>
</TD>
</TR>
</TABLE>
</P><P>
<P>About compatibility</P>
<P>With a good design, it should be possible to mix objects using the Keyboard and objects using <CODE>System.in</CODE>.</P>
<P>There is already a well-known name for a virtual keyboard provided for standard Java programs. It is <CODE>System.in</CODE>. Standard Java programs use stream-style input to get keystrokes from the keyboard.</P>
<P>In order to provide backward compatibility, it is necessary to create a <nolink>StandardInputStream. A standard input stream extends
<CODE>java.io.InputStream</CODE> and uses a virtual keyboard, like this:
</P><P>
<TABLE WIDTH="100%">
<TR>
<TD BGCOLOR="#EFEFEF">
<PRE>
public class StandardInputStream
	 extends InputStream {
  public StandardInputStream( Keyboard v ) {
	 keyboard = v;
  }

  // from InputStream, blocks until there's a keystroke
  public synchronized byte read() {
	 return keyboard.getKeystroke();
  }

  private Keyboard keyboard;
}
</PRE>
</TD>
</TR>
</TABLE>
</P><P>
<P>Since a shell is just another process, it might make sense to have the following methods as a part of a Process:
<PRE>
Keyboard getKeyboard();
Mouse getMouse();
</PRE>
<P>If a shell has multiple windows, it might make sense for it to subdivide keystrokes further, to deliver keystrokes to the current window of the current process.</P>
</TD>
</TR>
</TABLE><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FStandardInputStream&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FStandardInputStream&PHPSESSID=ac438c06907d0f071c9a7e9c1584cc4c">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

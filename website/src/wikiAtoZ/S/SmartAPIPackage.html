<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>SmartAPIPackage.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="9610d00fbd1d27f672140b803910f37a" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//SmartAPIPackage?PHPSESSID=9610d00fbd1d27f672140b803910f37a">SmartAPIPackage</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=9610d00fbd1d27f672140b803910f37a" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=9610d00fbd1d27f672140b803910f37a"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/SmartAPIPackage?PHPSESSID=9610d00fbd1d27f672140b803910f37a">info</a> on or <a href="/edit/Imported/SmartAPIPackage?PHPSESSID=9610d00fbd1d27f672140b803910f37a">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FSmartAPIPackage&PHPSESSID=9610d00fbd1d27f672140b803910f37a">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FSmartAPIPackage&PHPSESSID=9610d00fbd1d27f672140b803910f37a">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=9610d00fbd1d27f672140b803910f37a">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE=-1><a href="/view.php?topic=SmartAPIPages&PHPSESSID=9610d00fbd1d27f672140b803910f37a">SmartAPIPages</a><wikitopic SmartAPIPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=9610d00fbd1d27f672140b803910f37a">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (16 Jul 1999).</EM>
<H4>Introduction</H4>
<P>We can bring the smart <nolink>API to the next level. If we are going to build a collection, there must be things that all smart <nolink>APIs have in common. It makes sense to create a common package in Java to make it easier for <STRONG>other programmers</STRONG> to create a <a href="/view.php?topic=SmartAPI&PHPSESSID=9610d00fbd1d27f672140b803910f37a">SmartAPI</a><wikitopic SmartAPI /wikitopic>.</P>
<H4>Generic URL</H4>
<P>We should develop a generic <nolink>URL class. It might be easier to develop and use a JOS-specific <nolink>URL if we had a generic <nolink>URL class. The generic <nolink>URL class would not throw a malformed <a href="/view.php?topic=URL&web=Imported&PHPSESSID=9610d00fbd1d27f672140b803910f37a">URL</a> <wikitopic URL /wikitopic>exception for perfectly adequate <nolink>URLs.</P>
<P>It should be even more generic that <CODE>.java.net.URL</CODE>. <CODE>java.net.URL</CODE> is, unfortunately, a network-specific <nolink>URL class. It handles a few <nolink>URLs that were known at the time Sun Microsystems wrote the class. It does not handle all of the possible <nolink>URLs that may be developed in the future.</P>
<P><EM>Help wanted:</EM> I wanted to make a note that a generic <nolink>URL class is needed. I'm not even sure what it would look like.</P>
<H4>Controller interface</H4>
<P>All of the controllers could be type-safe...or implement the following controller interface:
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public interface Controller {
  public boolean acceptsURL( String url );
  public Object getResource( String url );
}
</PRE>
</TD>
</TR>
</TABLE>
<H4>Helpful?</H4>
<P>How is a controller interface helpful? It doesn't do anything by itself. It isn't even type-safe.</P>
<P>A well-known controller interface might be helpful as a tag. All of the controllers on a machine would implement the well-known controller interface. It becomes possible to search for all controllers. If the smart <nolink>API package maintains a list of all controllers, it would be easier to find a list of controllers compatible with a specific smart <nolink>API.</P>
<P>Without a smart <nolink>API package, each custom smart <nolink>API must search all classes to find compatible controllers. If controllers are consistently tagged with a well-known controller interface, most of the classes on a machine would be skipped, reducing the time it takes to search for a controller.</P>
<A NAME="search">
<H4>Search</H4>
<P>Part of the power of the smart <nolink>API is the power to search the classpath for all compatible controllers. None of the controllers must be known by a smart factory ahead of time. At runtime, a smart factory can search the classpath for compatible controllers.</P>
<P>It might be the responsibility of a smart factory configuration program to search the classpath for all compatible controllers. Of all the compatible controllers on a specific machine, an end-user should be able to
<UL>
<LI>add a controller by class name,
<LI>verify a controller (making sure a controller implements a compatible interface),
<LI>disable a controller (preventing a smart factory from using the controller at all), and
<LI>specify the order (precedence) in which controllers are used by the smart factory.
</UL>
<H4>Common configuration program</H4>
<P>Since all smart factories can be configured, it might be possible to build a (common) configuration program for them. If standard smart factories use the registry <nolink>API, this smart factory configuration program should put a smart factory-specific front end on the <a href="/view.php?topic=RegistryEditor&PHPSESSID=9610d00fbd1d27f672140b803910f37a">RegistryEditor</a><wikitopic RegistryEditor /wikitopic>.</P>
<P>What does it take to configure a smart factory? It is important to set the order that controllers are added to a factory. If there are two or more controllers capable of creating an object from a <nolink>URL, only one controller is used. The first matching controller gets to create the resource. Controllers are used in the order they are added to a factory.</P>
<P>The configuration for a smart factory is stored in a registry. The registry may be stored on a local file or a remote registry service. A standard smart <nolink>API would use the registry <nolink>API to get its configuration out of the system-wide registry. Or better, to get the <nolink>URL of the configuration out of the system-wide registry.</P>
<PRE>
  public void configure() {
	 Registry r = SystemRegistry.getRegistry();
	 String url = r.getString( "registry/factory/confURL" );
	 r = RegistryFactory.getFactory().getRegistry( url );
	 String[] list = r.getStringArray( "controllers" );
	 int iMax = list.length;
	 for ( int i = 0; i &lt; iMax; i++ ) {
		addControllerFor( list[ i ] );
	 }
  }
</PRE>
<H4>Factory interface and base factory</H4>
<P>Each of the smart factories have the following things in common.
<UL>
<LI>Implement the controller interface. A smart factory is a controller, too. It can be used directly by the smart <CODE>ObjectFactory</CODE> to create <EM>any</EM> digital resource.
<LI>Manage an indexed list of controllers. Every smart factory needs to implment the <CODE>addController()</CODE>, <CODE>addControllerFor()</CODE>, <CODE>removeController()</CODE>, and <CODE>removeControllerFor()</CODE> methods.
<LI>While every smart factory uses controllers, each should manage controllers with a different interface. The name of this controller interface might be passed to a base factory. By passing the name of a derived controller interface to a base factory, the base factory can perform type-checking on controllers during <CODE>addController()</CODE>. The base factory can search for all compatible controllers.
<LI>While every smart factory has a different configuration, each should manage its configuration through the registry <nolink>API. The name of the configuration, a key into the system registry, might be passed to a base factory. By passing this key to a base factory, the base factory can find the configuration for a custom smart factory.
</UL>
<H4>Package name</H4>
<P>When considering the impact of the smart <nolink>API on the <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=9610d00fbd1d27f672140b803910f37a">JOS</a> <wikitopic JOS /wikitopic>packages, I thought the smart <nolink>API package might be called <CODE><EM>something</EM>.factory</CODE>, rather than <CODE><EM>something</EM>.smartapi</CODE>.
<P ALIGN="CENTER"><CODE>org.jos.api.factory?</CODE></P>
</P>
<H4>Factory interface</H4>
<P>The factory interface would look something like this:
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public interface Factory 
	 extends Controller {
  public void addController( Controller v );
  public void addControllerFor( String v );
  public void removeController( Controller v );
  public void removeControllerFor( String v );
}
</PRE>
</TD>
</TR>
</TABLE>
<H4>ControllerManager class</H4>
<P>It takes a lot to manage a list of controllers. Controllers must be kept in a specific order, in order of precedence. And yet, when a controller is removed from the list, indexes are not exposed and not preserved.</P>
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public class ControllerManager {
  public ControllerManager() {
  }
  public Enumeration getControllers() {
  :
  }
  public void addController( Controller v ) {
  :
  }
  public void removeController( Controller v ) {
  :
  }
}
</PRE>
</TD>
</TR>
</TABLE>
<H4>Base factory</H4>
<P>A base factory would implement the factory interface.</P>
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public abstract class BaseFactory 
	 implements Factory {
  public BaseFactory() {
  }
  public BaseFactory( String key ) {
	 Registry r = SystemRegistry.getRegistry();
	 String url = r.getString( key );
	 configure( RegistryFactory.getFactory().getRegistry( url ) );
  }
  protected configure( Registry r ) {
	 controllerClassName = r.getString( "controllerClass" );
	 objectClassName = r.getString( "objectClass" );
	 String[] list = r.getStringArray( "controllers" );
	 int iMax = list.length;
	 for ( int i = 0; i &lt; iMax; i++ ) {
		addControllerFor( list[ i ] );
	 }
  }
  protected String getControllerClassName() {
	 return controllerClassName;
  }
  protected String getObjectClassName() {
	 return objectClassName;
  }
:
  public void addController( Controller v ) {
	 manager.addController( v );
  }
  public void removeController( Controller v ) {
	 manager.removeController( v );
  }
  public void addControllerFor( String v ) {
	 Class c = Class.forName( v );
	 Object o = c.newInstance();
	 if ( instanceOf( o, controllerClassName ) ) {
		addController( (Controller) v );
	 }
  }
  public void removeControllerFor( String v ) {
	 Enumeration list = manager.getControllers();
	 for (;;) {
		if ( !list.hasMoreElements() {
		  break;
		}

		Object o = list.nextElement();
		if ( instanceOf( o, v ) ) {
		  removeController( (Controller) o );
		}
	 }
  }
  protected boolean instanceOf( Object o, String v ) {
	 /* returns true if o is an instance of v */
  }
  private String controllerClassName = null;
  private String objectClassName = null;
  private ControllerManager manager =
		new ControllerManager();
}
</PRE>
</TD>
</TR>
</TABLE>
<H4>Object factory</H4>
<P>An object factory needs to be configured. It extends a base factory. Instead of an object factory using Controllers, it uses other factories.</P>
<H4>One package</H4>
<P>Maybe the smart <nolink>API package should include a well-known object factory. The object factory uses smart factories to load any digital resource. Since the object factory and the smart <nolink>API are so closely related, maybe they should occupy the same package in Java.</P>
<H4>Diagram</H4>
<P>The following diagram illustrates the runtime graph for a well-known object factory.</P>
<TABLE WIDTH="100%" BORDER="1" BGCOLOR="#EFEFEF">
<TR>
<TD ALIGN="CENTER" VALIGN="TOP">
<TABLE BORDER="1" BGCOLOR="#FFFFCC">
<TR>
<TD>
<STRONG>requestor</STRONG>
</TD>
</TR>
</TABLE>
</TD>
<TD ALIGN="CENTER" VALIGN="TOP">
==&gt;
</TD>
<TD ALIGN="CENTER" VALIGN="TOP" BGCOLOR="#FFFFCC">
<CODE><STRONG>ObjectFactory</STRONG></CODE>
<BR>
|<BR>
<TABLE BORDER="1" BGCOLOR="#FFCC00">
<TR>
<TD>
<CODE><STRONG><EM>CustomFactory</EM></STRONG></CODE>
</TD>
<TD>
==&gt;
</TD>
<TD>
<CODE><STRONG><EM>CustomController</EM></STRONG></CODE>
</TD>
</TR>
<TR>
<TD>
<CODE><STRONG><EM>CustomFactory</EM></STRONG></CODE>
</TD>
<TD>
==&gt;
</TD>
<TD>
<UL>
<LI><CODE><STRONG><EM>CustomController-1</EM></STRONG></CODE>
<LI><CODE><STRONG><EM>CustomController-2</EM></STRONG></CODE>
<LI>
<LI><CODE><STRONG><EM>CustomController-n</EM></STRONG></CODE>
</UL>
</TD>
</TR>
<TR>
<TD>:</TD>
<TD>:</TD>
<TD>:</TD>
</TR>
<TR>
<TD>
<CODE><STRONG><EM>CustomFactory</EM></STRONG></CODE>
</TD>
<TD>
==&gt;
</TD>
<TD>
<CODE><STRONG><EM>CustomController</EM></STRONG></CODE>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<P>The following is a step-by-step explanation of this diagram.</P>
<OL>
<LI>A <STRONG>requestor</STRONG> wants a digital resource. The requestor doesn't need to know the exact name of the resource, or if the resource is currently available.</P>
<LI>A requestor uses the well-known <CODE><STRONG>ObjectFactory</STRONG></CODE> to get an object, like this:
<PRE>
  public void example() {
	 String url = "x-editor:?type=text"
	 Object o = ObjectFactory.getFactory().getResource( url );
  }
</PRE>
<LI>The object factory is configured for any number of <STRONG>custom factories</STRONG>. All custom factories must implement the well-known <CODE>Factory</CODE> interface.</P>
<LI>The custom factory is configured for any number of <STRONG>custom controllers</STRONG>. All custom controllers should implement the well-known <CODE>Controller</CODE> interface.</P>
<LI>A custom controller creates a <STRONG>resource</STRONG>, configures it and returns it to the custom factory. The custom factory returns it to the object factory. The object factory returns it to the requestor. All resources must extends the well-known <CODE>Object</CODE> base class.</P>
</OL>
<P>This architecture enables a standard <CODE>ObjectFactory</CODE> to be expanded infinitely as more custom smart factories are developed and installed.</P>
<H4>Object controller</H4>
<P>The object factory also has its own object controller. The object controller can create <EM>any</EM> object, based on a class name. If you know the name of a class, you can create an object.</P>
<UL>
<LI>Default constructor - The first object controller should be able to create an object using Class.forName() and Object.newInstance(). This controller does not support additional parameters in its <nolink>URL.
<PRE>
&lt;URL:x-jos:object:class:java.awt.Button&gt;
</PRE>
<LI>Using reflection - The second object controller should be able to create an object using any contructor. The parameters to a contructor are passed as parameters in the object <nolink>URL.
<PRE>
&lt;URL:x-jos:object:class:java.lang.String?S1=hello&gt;
</PRE>
</UL><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FSmartAPIPackage&PHPSESSID=9610d00fbd1d27f672140b803910f37a">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FSmartAPIPackage&PHPSESSID=9610d00fbd1d27f672140b803910f37a">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

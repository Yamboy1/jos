<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>StandardCLibrary.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="7e4d3b506eb063bbfb67cb8370722ef7" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//StandardCLibrary?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">StandardCLibrary</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/StandardCLibrary?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">info</a> on or <a href="/edit/Imported/StandardCLibrary?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FStandardCLibrary&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FStandardCLibrary&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=BytecodePages&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">BytecodePages</a><wikitopic BytecodePages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (14 August 2000).</EM></P>
<H4>Introduction</H4>
<P>A standard C library is needed to write a <a href="/view.php?topic=VirtualMachine&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">VirtualMachine</a><wikitopic VirtualMachine /wikitopic> using the C programming language. A virtual machine for <a href="/view.php?topic=JOS&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">JOS</a> <wikitopic JOS /wikitopic>is no different. It needs a standard C library.</P>
<H4>Definition</H4>
<P>A standard C library should implement the functions and global variables defined in the <a href="/view.php?topic=ANSI&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">ANSI</a> <wikitopic ANSI /wikitopic>C and/or <a href="/view.php?topic=POSIX&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">POSIX</a> <wikitopic POSIX /wikitopic>specification. This library is available to any C program.</P>
<P>An implementation of a standard C library depends on its kernel. The code written to run on a <nolink>JOS kernel won't run on Linux(r) or Windows(tm). And, the reverse is true. The code written to run on the Linux(r) kernel won't run on a <nolink>JOS kernel.</P>
<H4>One function per module</H4>
<P>The standard C library was intentionally developed in such a way that each function appears in its own module. The smallest unit of link-able code is a module. Thus, the link editor would be able to replace individual functions of the standard C library with a custom module. If you want, yes, you can write your own version of any standard function.</P>
<H4>One function per file</H4>
<P>In order to put each function inside its own module, each function is written in a separate .c file. Have you ever wondered why C functions have short names? The <CODE>getcwd()</CODE> function in C might be named something like <CODE>getCurrentDirectory()</CODE> in Java. It was more a limitation of a filesystem than a C compiler. The filesystem used to develop the first standard C library supported file/directory names with only fourteen characters.</P>
<P>This is a good idea when writing a standard C library for <nolink>JOS. The source code is easier to maintain, compile and reuse.</P>
<PRE>
header  function		  file
------  --------		  --------
		  abort()			abort.c
		  kill()			 kill.c

		  atoi()			 atoi.c
		  itoa()			 itoa.c

mem.h
		  alloc()			alloc.c
		  free()			 free.c
		  memcpy()		  memcpy.c
		  memset()		  memset.c

io.h
		  close()			close.c
		  creat()			creat.c
		  open()			 open.c
		  read()			 read.c
		  write()			write.c

string.h
		  strcmp()		  strcmp.c
		  strcpy()		  strcpy.c
		  strlen()		  strlen.c

process.h
		  geteuid()		 geteuid.c
		  getgid()		  getgid.c
		  getpid()		  getpid.c
		  getuid()		  getuid.c
		  seteuid()		 seteuid.c
		  setuid()		  setuid.c
</PRE>
<H4>Library</H4>
<P>The standard C library has been distributed as a library. This is a good idea, too. This library can be statically linked to a virtual machine, such as decaf.</P>
<P>The standard C library should have an independent <CODE>make</CODE> process. It should be maintained (and compiled) separately from a kernel and virtual machine.</P>
<P>The include files must always match the library. The header files for the standard C library should not be stored with a kernel or virtual machine. Different implementations of the standard C library share the header files.</P>
<PRE>
include/mem.h
include/io.h
include/string.h
lib/libjosc.lib
</PRE>
<H4>Process</H4>
<P>Starting with the specification for <a href="/view.php?topic=ANSI&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">ANSI</a> <wikitopic ANSI /wikitopic>C or POSIX, header files can be created and maintained in a separate package. Anyone implementing the standard C library for <nolink>JOS should download and work with the standard header files.</P>
<P>Even when working on a foreign operating system, a virtual machine should be compiled with <nolink>JOS-specific header files. A virtual machine will compile when it only uses functions available in the standard C library for <nolink>JOS.</P>
<P>Individual contributors can have .c files in their own directory.</P>
<P>Take a hint from Linux(r). The kernel header files are shared, while the C source code is not.</P>
<H4>Going native</H4>
<P>Every method in the standard C library for <nolink>JOS should have a corresponding native method is a <a href="/view.php?topic=BytecodeNativeInterface&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">BytecodeNativeInterface</a><wikitopic BytecodeNativeInterface /wikitopic>-compatible interface.</P>
<P>The <CODE>getpid()</CODE> function returns the process ID of the current process. This method, for example, should have corresponding <CODE>getpid()</CODE> method in a process-related, BCNI-compatible interface.</P>
<TABLE WIDTH="100%" BORDER="1">
<TR>
<TD>
<PRE>
package org.jos.demo;

public interface Process {
  public abstract int getpid();
}
</PRE>
</TD>
</TR>
</TABLE>
<P>This method should have the same semantics on both transitional and ultimate <nolink>JOS. The following program determines the process ID of a virtual machine on a foreign operating system.</P>
<TABLE WIDTH="100%" BORDER="1">
<TR>
<TD>
<PRE>
  public void example() {
	 int pid = getCurrentProcessID();
	 System.out.println( "Process " + pid );
  }

  public int getCurrentProcessID() {
	 Factory f = Factory.getFactory();
	 Process p = (Process) f.getObject( "org.jos.demo.Process" );
	 if ( p == null ) {
		System.out.println( "Process device is not supported." );
	 }

	 return p.getpid();
  }
</PRE>
</TD>
</TR>
</TABLE>
<P>A BCNI-compatible factory returns an instance of <CODE>Process</CODE>, if possible. Otherwise, it returns <CODE>null</CODE>.</P>
<H4>Compatibility</H4>
<P>For the highest possible compatibility, the methods in an interface should have exactly the same name, parameters, return value as their <a href="/view.php?topic=ANSI&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">ANSI</a> <wikitopic ANSI /wikitopic>C or <a href="/view.php?topic=POSIX&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">POSIX</a> <wikitopic POSIX /wikitopic>equivalent. The parameters and return values should be passed straight through without modification, too.</P>
<P>A separate package might contain a Java-style <a href="/view.php?topic=API&web=Imported&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">API</a> <wikitopic API /wikitopic>for the interface.</P>
<TABLE WIDTH="100%" BORDER="1">
<TR>
<TD>
<PRE>
// SystemDescriptor.java
public class SystemDescriptor {
  public SystemDescriptor( int v ) {
	 id = v;
  }
  public int getID() {
	 return id;
  }
  private int id;
}
</PRE>
</TD>
</TR>
<TR>
<TD>
<PRE>
// ProcessDescriptor.java
public class ProcessDescriptor
	 extends SystemDescriptor {
  public ProcessDescriptor( int v ) {
	 super( v );
  }
}
</PRE>
</TD>
</TR>
<TR>
<TD>
<PRE>
// ProcessTool.java
public class ProcessTool {
  public static Process getCurrentProcess() {
	 int pid = getCurrentProcessID();
	 ProcessDescriptor pd = new ProcessDescriptor( pid );
	 return new Process( pd );
  }
  public static Process getParentProcess() {
	 int ppid = getParentProcessID();
	 ProcessDescriptor pd = new ProcessDescriptor( ppid );
	 return new Process( pd );
  }
  public static Process[] getChildProcess() {
	 int[] cpid = getChildProcessID();
	 int iMax = cpid.length;
	 Process[] list = new Process[ iMax ];
	 for ( int i = 0; i &lt; iMax; i++ ) {
		ProcessDescriptor pd = new ProcessDescriptor( cpid[ i ] );
		list[ i ] = new Process( pd );
	 }
	 return list;
  }
  private ProcessTool() {}
}
</PRE>
</TR>
<TR>
<TD>
<PRE>
// Process.java
public class Process {
  Process( ProcessDescriptor v ) {
	 pd = v;
  }
  public ProcessDescriptor getPD() {
	 return pd;
  }
  private ProcessDescriptor pd;
}
</PRE>
</TD>
</TR>
</TABLE>
<P>On Linux(r), the <CODE>getCurrentProcessID()</CODE> method returns the process that contains the virtual machine. It uses the <CODE>getpid()</CODE> function of the standard C library.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FStandardCLibrary&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FStandardCLibrary&PHPSESSID=7e4d3b506eb063bbfb67cb8370722ef7">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>CjOS.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="9c0731efc659a035b48436c0066e7a0d" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//CjOS?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">CjOS</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=9c0731efc659a035b48436c0066e7a0d" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=9c0731efc659a035b48436c0066e7a0d"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/CjOS?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">info</a> on or <a href="/edit/Imported/CjOS?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FCjOS&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FCjOS&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=9c0731efc659a035b48436c0066e7a0d">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=CjOSPages&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">CjOSPages</a><wikitopic CjOSPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (7 September 2000).</EM></P>
<H4>Introduction</H4>
<P>As always, I have started the construction of my operating system at the bottom. The bottom seems to be the best place to start when developing any complex system. Each component is analysed, designed, written and fully tested before moving on. What is at the bottom? I have gathered the following components:</P>
<UL>
<LI>Bytecode assember (Jasmin)
<LI> <a href="/view.php?topic=PureReflection&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">PureReflection</a><wikitopic PureReflection /wikitopic>
<LI>Bytecode as a resource
<LI> <a href="/view.php?topic=BytecodeNativeInterface&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">BytecodeNativeInterface</a><wikitopic BytecodeNativeInterface /wikitopic>
<LI> <a href="/view.php?topic=AltPackageProposal&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">AltPackageProposal</a><wikitopic AltPackageProposal /wikitopic>
</UL>
<P>And as you can see, I have a long way to go. Lately, I have been thinking of my virtual machine more as if it were a <a href="/view.php?topic=VMKit&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">VMKit</a><wikitopic VMKit /wikitopic>. The <a href="/view.php?topic=CalculatorOpcodes&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">CalculatorOpcodes</a><wikitopic CalculatorOpcodes /wikitopic> seem the easiest to implement as functions and then opcode methods.</P>
<H4>Interface 1: <nolink>CjOS to standard C library</H4>
<P>It seems to me that a Java method could allocate a byte array and pass it (or a copy) to the standard C library. The standard C library <EM>is</EM> the kernel interface for many other kernels. By putting the right bytes in the byte array, the standard C library can request any kernel service. This works well for context/task switching. This interface is relatively simple and flexible.</P>
<P>To request a service, a Java method invokes a native method of the standard Java class library. The standard Java class library formats a byte array with service number (buf[ 0 ]) and, if necessary, sub-service number (byte[ 1 ]) and even sub-sub-service number (byte[ 2 ]). It stuffs parameters to C functions into the byte array (or uses additional arrays). A "string" function, such as <CODE>strlen()</CODE>, <CODE>strcpy()</CODE> and <CODE>strcmp()</CODE>, treats a byte array as if it were a NUL-terminated, eight-bits-per-character string.</P>
<P>A Java method could collect data from the kernel by passing it a byte array large enough to hold the data.</P>
<H4>Interface 2: Bytecode-as-a-resource to <nolink>CjOS</H4>
<P>Since the rc_Bytecode class has already been defined and thoroughly tested, another interface is needed to customize it for <nolink>CjOS, <EM>pronounced see-jay oh-ess</EM>.</P>
<UL>
<LI><P><STRONG>C is for...C/C++</STRONG></P>
<P>C/C++ is the programming language of choice for writing the kernel, standard C library and virtual machine. It is also the language of choice for writing other dynamically loaded kernel modules.</P>
<LI><P><STRONG>j is for...Java bytecode, but not class files</STRONG></P>
<P>The first priority for this virtual machine is compliance with the first edition of the <a href="/view.php?topic=JavaVirtualMachineSpecification&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">JavaVirtualMachineSpecification</a><wikitopic JavaVirtualMachineSpecification /wikitopic>. This is almost fully implemented in Sun Microsystems' <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">JDK</a> <wikitopic JDK /wikitopic>1.02.</P>
<LI><P><STRONG>OS is for...Operating System</STRONG></P>
<P>Ultimately, this virtual machine will run without a foreign operating system (<a href="/view.php?topic=UltimateJOS&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">UltimateJOS</a><wikitopic UltimateJOS /wikitopic>). Meanwhile, it will be developed and tested using both Linux and Windows (<a href="/view.php?topic=TransitionalJOS&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">TransitionalJOS</a><wikitopic TransitionalJOS /wikitopic>).</P>
</UL>
<H4>Verifier</H4>
<P>A placeholder will be developed for the dynamic bytecode verifier. While using bytecode-as-a-resource, a dynamic bytecode verifier component is required. Bytecode is assumed to be trustworthy because it is statically linked to the virtual machine.</P>
<H4>Interface 2: standard C library to kernel</H4>
<P>The standard C library will be the interface to the kernel. It will provide machine code processes, machine code threads and lots of other features on behalf of a virtual machine. The virtual machine itself should be both JNI- and MPCL-compable.</P>
<H4><CODE>jint</CODE> array class</H4>
<P>The <CODE>jint</CODE> array is a recurring theme of a virtual machine. It is frequently reused. It is a favorite construct of different parts of a virtual machine. It is a fundamental class inside <CODE>CjOS</CODE>.</P>
<P>A <CODE>jint</CODE> array is an array of <CODE>jint</CODE>s, or signed 32-bit integer. Conceptually, it looks something like this:</P>
<TABLE BORDER="1">
<TR>
<TD>
a[ 0 ]
</TD>
</TR>
<TR>
<TD>
a[ 1 ]
</TD>
</TR>
<TR>
<TD>
a[ 2 ]
</TD>
</TR>
<TR>
<TD>
:
</TD>
</TR>
<TR>
<TD>
a[ size-1 ]
</TD>
</TR>
</TABLE>
<P>and has at least the following methods:</P>
<UL>
<LI><CODE>int getInt( jint index, jint &amp;v )</CODE>
<LI><CODE>int setInt( jint index, jint v )</CODE>
</UL>
<P>For a new <CODE>jint</CODE> array, size is passed to its constructor.</P>
<PRE>
  jint size = 340;
  IntArray *a = new IntArray( size );
</PRE>
<P>These methods return an error code and do not throw a C++ exception. Error code 0 exclusively is returned upon successful access/modification of an array.</P>
<PRE>
class IntArray {
  public:
	 IntArray( jint size );
	 IntArray( const IntArray &amp;other );
	 virtual ~IntArray();

	 short getInt( jint index, jint &amp;v ) const;
	 short setInt( jint index, jint v );
	 jint getSize() const;
	 &lt;FONT COLOR="#7F7F7F"&gt;// *Q! short setSize( jint size );&lt;/FONT&gt;
	 short getArray( jint pos1, jint pos2, IntArray &amp;other ) const;
	 short setArray( jint pos1, jint pos2, const IntArray &amp;other );
  private:
	 const IntArray &amp;operator=( const IntArray &amp;other );
	 jint size;
	 jint *payload;
};
</PRE>
<H4><CODE>jbyte</CODE> array</H4>
<P>The <CODE>jbyte</CODE> array is just like the <CODE>jint</CODE> array, except it holds <CODE>jbyte</CODE>s, or signed 8-bit integers.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FCjOS&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FCjOS&PHPSESSID=9c0731efc659a035b48436c0066e7a0d">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

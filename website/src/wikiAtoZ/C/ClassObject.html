<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>ClassObject.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="2a773b962b1c2ba15f5b2682b530b97c" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//ClassObject?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">ClassObject</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/ClassObject?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">info</a> on or <a href="/edit/Imported/ClassObject?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FClassObject&PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FClassObject&PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=BytecodePages&PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">BytecodePages</a><wikitopic BytecodePages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (3 May 2000).</EM></P>
<H4>Introduction</H4>
<P>Sometimes, it is most difficult to understand classes in terms of objects. The following article provides more information on this relationship and how it affects the construction of a virtual machine.</P>
<H4>Starting with an object</H4>
<P>In Java, an object is always an instance of <CODE>java.lang.Object</CODE>; but, an object itself cannot be instantiated.</P>
<PRE>
  public void nonExample() {
	 Object o = new Object(); // can't be done.
  }
</PRE>
<P>The implementation of a <CODE>new</CODE> operator is vm-specific. It is implemented as an opcode method. A method determines the size of an object and uses a kernel to allocate enough memory for it. A <CODE>new</CODE> operator must resolve references to a superclass. A superclass constributes to the size of an object. Resolving a superclass may invoke a class loader. A class loader may load additional classes.</P>
<P>Any object can be dynamically cast to an object reference.</P>
<PRE>
  public void example() {
	 String s = "Hello, World!";
	 Object o = (Object) s;
  }
</PRE>
<P>An object has-a class, too. The <CODE>java.lang.Object</CODE> class is special case.</P>
<UL>
<LI><P>An object has-a class.</P>
<LI><P>A class is-an kind of object.</P>
</UL>
<P>An object has at least the fields implemented in the class file called <CODE>java/lang/Object</CODE>. It has built-in fields, or hidden fields, that are specific to a virtual machine. Unlike any other object, the number of fields required by <CODE>java.lang.Object</CODE> are determined by the virtual machine <EM>and</EM> an implementation of <CODE>java.lang.Object</CODE>.</P>
<P>An object always has both data and code. An object's data might change from one instance to another. An object's code is its class. A class never changes. Code is shared by all instances of a class.</P>
<H4>Custom class</H4>
<P>A custom class extends the object class. A custom class might add fields to the base object. An object's data is always allocated once. It has one machine code pointer to the object's data. An object has enough room for all of its fields.</P>
<H4>A class object</H4>
<P>An instance of <CODE>java.lang.Class</CODE> is an object. It is a class. The size of a class is known in advance. The size of a class may be vm-specific, too. It has all the fields of an object and it has all of the fields of a class. Data for a class is allocated once. A class has enough room for all of its fields.</P>
<H4>Field size</H4>
<P>An object always has fields and methods associated with it. A class determines how many fields and of what type. Each field has a corresponding type. The size of each field is always known in advance.</P>
<TABLE BORDER="1" CELLPADDING="4" BGCOLOR="#FFFFCC">
<TR>
<TD>
<STRONG>Type</STRONG>
</TD>
<TD>
<STRONG>Size</STRONG>
</TD>
</TR>
<TR>
<TD>
B (byte)
</TD>
<TD>
32-bits (4 octets)
</TD>
</TR>
<TR>
<TD>
C (char)
</TD>
<TD>
32-bits (4 octets)
</TD>
</TR>
<TR>
<TD>
D (double)
</TD>
<TD>
64-bits (8 octets)
</TD>
</TR>
<TR>
<TD>
F (float)
</TD>
<TD>
32-bits (4 octets)
</TD>
</TR>
<TR>
<TD>
I (int)
</TD>
<TD>
32-bits (4 octets)
</TD>
</TR>
<TR>
<TD>
J (long)
</TD>
<TD>
64-bits (8 octets)
</TD>
</TR>
<TR>
<TD>
L (object reference)
</TD>
<TD>
32-bits (4 octets)
</TD>
</TR>
<TR>
<TD>
Z (boolean)
</TD>
<TD>
32-bits (4 octets)
</TD>
</TR>
</TABLE>
<P>When a virtual machine tries to determine how much space to allocate for a new object, it must add the space required by a class to the space required by its superclass. Once the size of an object is known, a single block of memory can be allocated.</P>
<PRE>
  int getObjectSize( const jclass *v ) {
	 int s = v-&gt;getInstanceSize();
	 for (;;) {
		v = v-&gt;getSuperClass();
		if ( v == NULL ) {
		  break;
		}
		s += v-&gt;getInstanceSize();
	 }
	 return s;
  }
</PRE>
<P>A class is an instance of <CODE>java.lang.Class</CODE>. <CODE>java.lang.Class</CODE> always extends <CODE>java.lang.Object</CODE>. Therefore, the minimum space required is vm-specific and always the minimum for every class. It must include enough space for the fields in <CODE>java.lang.Object</CODE> and the fields in <CODE>java.lang.Class</CODE>. It must also include enough space for static fields.</P>
<P>When a virtual machine needs a vm-specific field in each object, the <CODE>Object</CODE> class does not need to be recompiled. Private fields for the <CODE>Object</CODE> class can be added by a virtual machine when determining the size of an object. If a virtual machine needs an extra 2K of data for each object, it can add 2K to an object's size.</P>
<PRE>
  int getInstanceSize( const jclass *v ) {
	 int s = 0;

	 int iMax = v-&gt;getFieldCount();
	 for ( int i = 0; i &lt; iMax; i++ ) {
		Access a = v-&gt;getFieldAccess( i );
		if ( a.isStatic() ) {
		  continue;
		}
		switch( v-&gt;getFieldType( i ) ) {
		  case 'B' :
		  case 'C' :
		  case 'F' :
		  case 'I' :
		  case 'L' :
		  case 'Z' :
			 s += 4;
			 break;

		  case 'D' :
		  case 'J' :
			 s += 8;
			 break;

		  default :
			 return 0;

		}
	 }

	 int rc = strcmp( v-&gt;getThisClassSpec(), "java/lang/Object" );
	 if ( rc == 0 ) {
		return s + 2000;
	 }

	 return s;
  }
</PRE>
<H4>Static fields</H4>
<P>A class must be treated like an object. The following code is valid.</P>
<PRE>
  public void example() {
	 Class c = Class.forName( "java.lang.String" );
	 Object o = (Object) c;
  }
</PRE>
<P>Static fields to an object are instance fields to a class. Fields in a class object include the static fields of a class.</P>
<P>While a class has a number of fixed fields, like its <CODE>ClassLoader</CODE> property, it also has a number of dynamic fields depending on each class definition.</P>
<P>An interface can have static fields, too. Static fields to an interface are instance fields to a class.</P>
<H4>Summary</H4>
<P>An object and its class are separate. An object maintains the instance fields of an object. Many objects share a single class. One of the instance fields of an object is an object reference to its class.</P>
<P>The class object maintains the static fields of a class. Many classes share a single class loader. One of the instance fields of a class is an object reference to its class loader. The initial value of the <CODE>ClassLoader</CODE> property is <CODE>null</CODE>. Enough space for a class can be allocated before it is resolved. Otherwise, the relationship between an object and its class would be circular.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FClassObject&PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FClassObject&PHPSESSID=2a773b962b1c2ba15f5b2682b530b97c">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

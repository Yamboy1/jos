<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>OneProcessOneVM.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="9016694a609bb29c04f637868a32458b" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=9016694a609bb29c04f637868a32458b">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=9016694a609bb29c04f637868a32458b">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=9016694a609bb29c04f637868a32458b">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=9016694a609bb29c04f637868a32458b">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=9016694a609bb29c04f637868a32458b">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//OneProcessOneVM?PHPSESSID=9016694a609bb29c04f637868a32458b">OneProcessOneVM</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=9016694a609bb29c04f637868a32458b">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=9016694a609bb29c04f637868a32458b" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=9016694a609bb29c04f637868a32458b"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/OneProcessOneVM?PHPSESSID=9016694a609bb29c04f637868a32458b">info</a> on or <a href="/edit/Imported/OneProcessOneVM?PHPSESSID=9016694a609bb29c04f637868a32458b">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FOneProcessOneVM&PHPSESSID=9016694a609bb29c04f637868a32458b">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FOneProcessOneVM&PHPSESSID=9016694a609bb29c04f637868a32458b">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=9016694a609bb29c04f637868a32458b">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=9016694a609bb29c04f637868a32458b">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=9016694a609bb29c04f637868a32458b">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ProcessPages&PHPSESSID=9016694a609bb29c04f637868a32458b">ProcessPages</a><wikitopic ProcessPages /wikitopic></FONT>
<HR SIZE="1" NOSHADE>
<EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=9016694a609bb29c04f637868a32458b">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (revised 11 January 2001).</EM>
<H4>Introduction</H4>
<P>In order to understand the support of multiple processes, we must compare and contrast single-process and multi-process virtual machines. A single-process virtual machine is appropriate for a foreign operating system, which implements a process in machine code. A multi-process virtual machine may be appropriate for an operating system because an operating system is expected to run more than application at the same time. A process in machine code may not be an available option.</P>
<H4>New OS</H4>
<P>Yes, I want a new operating system. Yes, I want everything in my new operating system that can be written in Java to be written in Java.</P>
<P>I want as much Java in my operating system as I can get. Why? Because Java gives me the opportunity to build a masterpiece, an operating system better than any other operating system ever made.</P>
<H4>Foreign OS</H4>
<P>Having said that, I've got to admit that a new OS is not required to build a multi-process virtual machine. That's sad, but true.</P>
<P>It is a good idea to take advantage of all the operating systems we already have, especially during initial development. We must leverage cross-platform development to build a multi-process virtual machine for JOS. Early versions of our virtual machine must run on a foreign operating system.</P>
<P>Since we have other operating systems and other virtual machines available now, we must find a way to use them effectively. We must use <STRONG>evolution</STRONG>, not revolution, to reach for a completely new OS. We must migrate what we can to the new Java platform. We must think about what tools are available now. We must address first things first.</P>
<H4>As a service</H4>
<P>Picture an early version of a virtual machine. What does it look like? How can it be tested?</P>
<P>Then imagine the earliest version of a virtual machine as a service.
<OL>
<LI>Imagine <CODE>jvmd</CODE> program as a service, like httpd, instead of an application. You start this service at the command line with <CODE>jvmd&amp;</CODE>. Or better, you configure your operating system to automatically start this service at boot-time.
<LI>Imagine the <CODE>java</CODE> program is completely revised. It becomes a very small program that forwards all requests to this virtual machine service. In other words, it doesn't run Java programs at all, but forwards the command line to a service. The <CODE>java</CODE> program uses inter-process communication to launch an application and wait for its result code.
<LI>Imagine further, that we build different start-up scripts:
<UL>
<LI><CODE>java10</CODE> script asks this service to run a <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JDK</a> <wikitopic JDK /wikitopic>1.0.x-compatible application.
<LI><CODE>java11</CODE> script asks this service to run a <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JDK</a> <wikitopic JDK /wikitopic>1.1.x-compatible application.
<LI><CODE>java12</CODE> script asks this service to run a <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JDK</a> <wikitopic JDK /wikitopic>1.2.x-compatible application.
<LI><CODE>java13</CODE> script asks this service to run a <a href="/view.php?topic=JDK&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JDK</a> <wikitopic JDK /wikitopic>1.3.x-compatible application.
</UL>
<LI>Imagine this service can be shutdown and restarted on a foreign operating system. When running on a <nolink>JOS-specific kernel, shutting down this service shuts down the kernel. The machine has to be restarted to restart this service.
</OL>
<P>How would you build a virtual machine as a service? Think about it carefully. It puts a new perspective on an old problem.
<UL>
<LI>We need a place to start. A virtual machine service should be developed and tested using all cross-platform support. We could run compilers and off-the-shelf virtual machines on a foreign platform, along with this service. It should be run on a foreign operating system to simulate the <nolink>JOS environment. When a service is recompiled, you shut the old one down and restart the new one.
<LI>This service could interact with any off-the-shelf virtual machine through TCP/IP. An off-the-shelf virtual machine could run an entire suite of test applications within this service. From such a test suite, we would know which parts of the service could be trusted.
<LI>This service could recieve such requests from anywhere on the network. It would provide a foundation for distributed computing from day one. That would be a good assumption.
</UL>
<P>This service would be organized in such a way that each new request for a Java program would launch a new instance of a logically independent Java process.
<P>All three Java-compatible virtual machines were designed to run a single process. This is deeply embedded in the design of the Java Virtual Machine. The specification clearly shows that processes can't run independently inside current JVMs. They have specified that each <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JVM</a> <wikitopic JVM /wikitopic>runs as a single "process" with multiple "threads". While there is a <CODE>java.lang.Thread</CODE> class, there is no <CODE>java.lang.Process</CODE>.</P>
<P>They have specified that a foreign OS should load multiple concurrent JVMs for multiple concurrent Java applications or applets. They have specified that a <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JVM</a> <wikitopic JVM /wikitopic>has one security manager per JVM/process.</P>
<P>They started with the assumption that one process would run inside one virtual machine. Everything after that is based squarely on that assumption, <EM>and should be</EM>.</P>
<H4>Model</H4>
<P>Using the following model, expressed in Java, here is how a <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JVM</a> <wikitopic JVM /wikitopic>service would work:
</P><P>
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public abstract class JVMService {
  public JVMService( int port ) {
  }

  protected void accept() {
	 for (;;) {
		Socket s = listener.accept();
		JVM jvm = createJVM( s );
		jvm.start();
	 }
  }

  /**
	* For JOS, this method creates a org.jos.JVM.
	*/
  protected abstract JVM createJVM( Socket s );

  private ServerSocket listener;
}
</PRE>
</TD>
</TR>
</TABLE>
</P><P>
<P>Here's how the <a href="/view.php?topic=JVM&web=Imported&PHPSESSID=9016694a609bb29c04f637868a32458b">JVM</a> <wikitopic JVM /wikitopic>would work:
</P><P>
<TABLE WIDTH="100%" BGCOLOR="#EFEFEF">
<TR>
<TD>
<PRE>
public abstract class JVM extends Thread {
  public JVM( Socket s ) {
	 socket = s;
  }

  public run() {
	 writeResultCode( jvmExec( getCommandLine() ) );
	 socket.close();
  }

  protected String getCommandLine() {
	 DataInputStream in =
		  new DataInputStream( socket.getInputStream() );
	 return in.readLine();
  }

  protected void writeResultCode( int rc ) {
	 DataOutputStream out =
		  new DataOutputStream( socket.getOutputStream() );
	 out.writeInt( rc );
  }

  /**
	* This method starts an independent JVM as an independent
	* process.
	*/
  protected abstract int jvmExec( String cmd );

  private Socket socket;
}
</PRE>
</TD>
</TR>
</TABLE>
</P><P>
<P>For <nolink>JOS, the jvmExec() method runs <CODE>jvm</CODE> program in a separate kernel process.</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FOneProcessOneVM&PHPSESSID=9016694a609bb29c04f637868a32458b">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FOneProcessOneVM&PHPSESSID=9016694a609bb29c04f637868a32458b">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 FINAL//EN">
<HTML>
  <HEAD>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
    <TITLE>MainSubprogram.Imported @ jos.sf.net</TITLE>
  </HEAD>

<BODY BGCOLOR="#FFFFFF">

<!-- The FORM encloses the entire header, because it renders better that way. !-->
<FORM ACTION="/jump.php"><input type="hidden" name="PHPSESSID" value="c56e2f701693016e14072b920ded87ae" />

<!-- The JOS logo. !-->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR VALIGN="TOP" ALIGN="LEFT">
	<TD><A HREF="http://cjos.sourceforge.net/archive/"><IMG 
		VSPACE="0" HSPACE="0" ALIGN="MIDDLE" BORDER="0"
		SRC="http://cjos.sourceforge.net/archive/media/jos_logo_mini.gif"></A></TD>
	<!-- The tab table. !-->
	<TD WIDTH="100%" ALIGN="RIGHT" BGCOLOR="#FFFFFF" VALIGN="BOTTOM"> 
		<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%" ALIGN="RIGHT">
			<TR VALIGN="MIDDLE" ALIGN="LEFT">

<TD BGCOLOR="White" WIDTH="60%">&nbsp;</TD>
<TD BGCOLOR="#FFFFCC"><A HREF="http://cjos.sourceforge.net/archive/">Home</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/info/">Info</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFFFCC" ALIGN="CENTER"><A HREF="http://cjos.sourceforge.net/archive/dev/">DevZone</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
<TD WIDTH="10%" BGCOLOR="#FFCC66" ALIGN="CENTER"><A
HREF="http://jos.sourceforge.net/">Wiki</A></TD>
<TD BGCOLOR="White">&nbsp;</TD>
			</TR>
			<TR>
				<TD BGCOLOR="#FFCC66" ALIGN="RIGHT" COLSPAN="9">
					<A HREF="/view/Users/?PHPSESSID=c56e2f701693016e14072b920ded87ae">UsersWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Main/?PHPSESSID=c56e2f701693016e14072b920ded87ae">MainWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Info/?PHPSESSID=c56e2f701693016e14072b920ded87ae">InfoWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/DevZone/?PHPSESSID=c56e2f701693016e14072b920ded87ae">DevZoneWeb</A>
					&nbsp;|&nbsp;
					<A HREF="/view/Support/?PHPSESSID=c56e2f701693016e14072b920ded87ae">SupportWeb</A>
				</TD>
			</TR>
		</TABLE>
	</TD>		
</TR>
<!-- The WikiHeader. !-->
<TR><TD COLSPAN="2">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
<TR>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="CENTER">
		<B>[&nbsp;<a href="/info//MainSubprogram?PHPSESSID=c56e2f701693016e14072b920ded87ae">MainSubprogram</a>&nbsp;]</B>
	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="CENTER">
		<B>[ not logged in ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="CENTER">
		<B>[ Web: <a href="/view/Imported/?PHPSESSID=c56e2f701693016e14072b920ded87ae">Imported</a> ]</B>	</TD>
	<TD WIDTH="25%" ALIGN="CENTER" BGCOLOR="#FFCC66" VALIGN="CENTER">
		goto:&nbsp;<INPUT TYPE="TEXT" SIZE="10" NAME="topic"><!--<INPUT TYPE="IMAGE" SRC="/media/go.gif?PHPSESSID=c56e2f701693016e14072b920ded87ae" BORDER="0" VALUE="topic" ALT="goto">!-->&nbsp;<a href="/search.php?PHPSESSID=c56e2f701693016e14072b920ded87ae"><FONT SIZE="-1">options</FONT></a>
	</TD>
</TR>
</TABLE>

<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="3" WIDTH="100%">
	<TR>
	<TD ALIGN="CENTER" BGCOLOR="#FFFFCC" VALIGN="TOP">
		[&nbsp;get <a href="/info/Imported/MainSubprogram?PHPSESSID=c56e2f701693016e14072b920ded87ae">info</a> on or <a href="/edit/Imported/MainSubprogram?PHPSESSID=c56e2f701693016e14072b920ded87ae">edit</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFEE88" VALIGN="TOP">
		[&nbsp;<a href="/user.php?op=login&redirect=%2Fview%2F%2FMainSubprogram&PHPSESSID=c56e2f701693016e14072b920ded87ae">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FMainSubprogram&PHPSESSID=c56e2f701693016e14072b920ded87ae">new&nbsp;user</a>&nbsp;]	</TD>
	<TD ALIGN="CENTER" BGCOLOR="#FFDD77" VALIGN="TOP">
		[&nbsp;list of <a href="/topics/Imported/?PHPSESSID=c56e2f701693016e14072b920ded87ae">topics</a>, <a href="/hubsnodes/Imported/?PHPSESSID=c56e2f701693016e14072b920ded87ae">hubs&nbsp;&amp;&nbsp;nodes</a>, or <a href="/changes/Imported/?PHPSESSID=c56e2f701693016e14072b920ded87ae">recent&nbsp;changes</a>&nbsp;]	</TD>
	</TR>
</TABLE>

<!-- From CommonHeader !-->
</TR></TD>
</TABLE>
</FORM>

<!-- start BODY page !-->
<P>
<FONT SIZE="-1"><a href="/view.php?topic=ProcessPages&PHPSESSID=c56e2f701693016e14072b920ded87ae">ProcessPages</a><wikitopic ProcessPages /wikitopic></FONT>
<HR SIZE="1" NOSHADOW>
<P><EM>Article contributed by <a href="/view.php?topic=GilbertHerschberger&PHPSESSID=c56e2f701693016e14072b920ded87ae">GilbertHerschberger</a><wikitopic GilbertHerschberger /wikitopic> (12 May 2000).</EM></P>
<H4>Introduction</H4>
<P>There is a big difference between a process and a subprogram. So far, my research has been building from the bottom up, starting with subprograms and ultimately -- I hope -- ending with a genuine bytecode process.</P>
<P>A subprogram is not a process. While a subprogram has a parent, a process does not. A subprogram can share objects with its parent program. A subprogram can reuse most of the classes loaded by its parent program. Since a process has no parent, it cannot share objects or classes with its parent.</P>
<H4>Main subprogram</H4>
<P>Any object can invoke an arbitrary Java application as a subprogram. An object must invoke the static main() method of another class.</P>
<PRE>
  public void example() {
	 String cn = "org.jos.demo.Demo";
	 String[] args = {
		"Hello,",
		"World!"
		};

	 Class c;
	 try {
		c = Class.forName( "org.jos.demo.Demo" );
	 }
	 catch( ClassNotFoundException e ) {
		System.err.println( "Class Not Found: " + e.getMessage() );
		return;
	 }

	 Class[] signature = new Class[ 1 ];
	 signature[ 0 ] = args.getClass();
	 Method m;
	 try {
		m = c.getMethod( "main", signature );
	 }
	 catch( NoSuchMethodException e ) {
		System.out.println( "No Such Method: " + e.getMessage() );
		return;
	 }

	 Object[] params = new Object[ 1 ];
	 params[ 0 ] = args;
	 try {
		m.invoke( null, params );
	 }
	 catch( InvocationTargetException e ) {
		System.out.println( "Invocation Target: " + e.getMessage() );
		return;
	 }
	 catch( IllegalAccessException e ) {
		System.out.println( "Illegal Access: " + e.getMessage() );
		return;
	 }
	 catch( IllegalArgumentException e ) {
		System.out.println( "Illegal Argument: " + e.getMessage() );
		return;
	 }
  }
</PRE>
<P>In this example, a subprogram uses the same application context as the parent. Both share a class loader. Both have the same system properties. Both share standard in, out and error streams. Either the parent or child can call System.exit() and shut down the virtual machine. Classes loaded by a child program remain loaded until the end of a parent.</P>
<P>The child program is a subprogram, not a process.</P>
<H4>Main subprogram, with class loader</H4>
<P>Any object can create a custom class loader and use it to invoke an arbitrary Java application as a subprogram. A class loader enables all classes loaded by a child program to be garbage collected earlier, at the end of a child.</P>
<P>With more effort, a custom class loader can provide a new application context to a subprogram as demonstrated by <EM>Rheise.OS</EM> by <a href="/view.php?topic=RyanHeise&PHPSESSID=c56e2f701693016e14072b920ded87ae">RyanHeise</a><wikitopic RyanHeise /wikitopic>.</P>
<P>Again the child program is a subprogram, not a process.</P>
<H4>Java application</H4>
<P>The classic Java application has a weak model. It is the first thing a new Java programmer might use. It has many problems.</P>
<UL>
<LI><P><STRONG>Class-oriented, not object-oriented.</STRONG></P>
<P>It is unlike anything else in the Java standard class libraries. It is inconsistent with object-oriented theory, where everything's an object.</P>
<P>An application is defined as any <EM>class</EM> that implements a static main. It borrows heavily from C to help a new C programmer in their migration to Java. It makes little sense to a new Java programmer.</P>
<PRE>
public class Demo {
  public static void main( String[] args ) {
  :
  }
}
</PRE>
<P>From theory, an object-oriented programmer expects to create an new application with <CODE>new</CODE>. An application is an object and should be treated like one.</P>
<PRE>
  public void example() {
	 Application app = new &lt;EM&gt;Custom&lt;/EM&gt;Application();
	 app.run();
  }
</PRE>
<P>By extension, an object-oriented programmer expects to create a list of applications, like this:</P>
<PRE>
  public void example() {
	 int iMax = 3;
	 Application[] list = new Application[ iMax ];
	 for ( int i = 0; i &lt; iMax; i++ ) {
		list[ i ] = new CustomApplication();
		list[ i ].run();
	 }
  }
</PRE>
<LI><P><STRONG>Unfortunately, Java application context is very complex.</STRONG></P>
<P>The application context is implied, rather than explicit. An application is not created and passed to an application.</P>
<P>It is difficult to create a new context for more than one application within a virtual machine. It is embedded into static fields of the Java standard class libraries. Each application context requires the "reloading" of many classes.</P>
</UL>
<H4>Proxy required</H4>
<P>A process descriptor is always required to separate a process from the object that created it. A file descriptor is always required to separate a stream from the process that created the stream. When providing the standard in, out and error streams, both a process descriptor and file descriptor are required.</P>
<P>An bytecode process always has three file descriptors. These file descriptors must be mapped so that file 0 in one process is not equal to file 0 in another.</P>
<P>The following example demonstrates one way to create a process.</P>
<PRE>
  public void example() {
	 String cmd = "java org.jos.demo.Demo";
	 Process p = Runtime.getRuntime().exec( cmd );
  }
</PRE>
<P>A process starts running <EM>before</EM> the end of the <CODE>exec()</CODE> method.</P>
<P>An implementation of the <CODE>exec()</CODE> method must return an instance of <CODE>java.lang.Process</CODE> in the application context of the calling object. An implementation of <CODE>java.lang.Process</CODE> might look something like this:</P>
<PRE>
public class ProcessProxy
	 extends java.lang.Process {
  public ProcessProxy( int pid ) {
	 descriptor = new ProcessDescriptor( p );
  }
  :
  private ProcessDescriptor descriptor;
}
</PRE>
<P>When an object uses the <CODE>getInputStream()</CODE> method of <CODE>ProcessProxy</CODE>, a file descriptor is returned from the pipe that has already been created by the process object.</P>
<P>The real process object is a <CODE>ProcessDevice</CODE>. It is internal to a virtual machine and may be vm-specific. The real process object cannot be created directly by an object.</P>
<PRE>
  public void nonExample() {
	 Process p = new ProcessDevice(); // does not work!
  }
</PRE>
<P>A real process object does not have to extend <CODE>java.lang.Process</CODE>. In a sparsely populated process manager, a real process object might maintain its own process ID.</P>
<PRE>
  private static int lastProcessID = 0;

  ProcessDevice() {
	 processID = ++lastProcessID;
  }
  int getProcessID() {
	 return processID;
  }
  private int processID;
</PRE>
<P>A real process object might maintain its own file descriptors for standard in, out and error streams.</P>
<PRE>
  private FileDescriptor in;
  private FileDescriptor out;
  private FileDescriptor err;
</PRE>
<P>A file descriptor is required to read and write from another process. An object doesn't know the file descriptor of the new process. It is cannot be 0, 1 and 2 from the calling object's viewpoint because those descriptors are already used in its own application context. A file descriptor returned by a process manager represents one end of a pipe or stream.</P>
<H4>Process manager</H4>
<P>A process manager cannot be written in bytecode. A process manager must be written in machine code. And here's why.</P>
<P>A process must be independent of all other bytecode, including the owner of all processes, the virtual machine. If a process manager were written in bytecode, which process would it run in? A process manager cannot manage itself.</P>
<P>The process manager and primordial class loader are part of a virtual machine. The virtual machine owns all primordial class loaders and their corresponding threads.</P>
<P>A proxy for the process manager can be written by using native methods in bytecode. A proxy can provide the process ID of all current processes, something like this:</P>
<PRE>
  /**
	* Gets List property. Each process descriptor can be
	* passed to this process manager proxy to obtain more
	* information about a specific process.&lt;/P&gt;
	*/
  public ProcessDescriptor[] getList() {
	 int[] buf = getNativeList();
	 int iMax = buf.length;
	 ProcessDescriptor[] list = new ProcessDescriptor[ iMax ];
	 for ( int i = 0; i &lt; iMax; i++ ) {
		list[ i ] = new ProcessDescriptor( buf[ i ] );
	 }
	 return list;
  }
  private native int[] getNativeList();
</PRE>
<P>When a virtual machine returns an array of <CODE>int</CODE>s, the array must be owned by the calling process. When a process manager proxy returns an array of <CODE>ProcessDescriptor</CODE>s, the array and each <CODE>ProcessDescriptor</CODE> object must be owned by the calling process.</P>
<H4>Summary</H4>
<P>While invoking a Java application as a subprogram is a good thing, it does not go far enough. A process is more than just a subprogram. A process is more than just another class loader with a thread. A application must have a completely separate application context.</P>
<P>The search for a bytecode process continues...</P><BR><BR></P><!--

<TABLE width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="737b9c">
<TR><TD ALIGN="CENTER">
<a href="/user.php?op=login&redirect=%2Fview%2F%2FMainSubprogram&PHPSESSID=c56e2f701693016e14072b920ded87ae">login</a> or <a href="/user.php?op=newacct&redirect=%2Fview%2F%2FMainSubprogram&PHPSESSID=c56e2f701693016e14072b920ded87ae">new&nbsp;user</a><TR><TD>
</TABLE>

!-->
<!-- end BODY page !-->

<HR>

<DIV ALIGN="CENTER">
<TABLE BORDER="0" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR>
	<TD ALIGN="CENTER" COLSPAN="2">
		Content of these pages are owned and copyrighted by the poster.
	</TD>
</TR>
<TR>
	<TD ALIGN="RIGHT" WIDTH="50%">
		Hosted by:
	</TD>
	<TD ALIGN="LEFT">
		<A HREF="http://sourceforge.net/"><IMG 
			SRC="http://sourceforge.net/sflogo.php?group_id=2376&type=1"
			BORDER=0 HSPACE=0 VSPACE=0></A>
	</TD>
</TR>
</TABLE>
</DIV>
</BODY>
</HTML>

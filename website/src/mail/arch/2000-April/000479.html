<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JOS-Arch] rheise.os questions</TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:tmiller%40haverford.edu">
   <LINK REL="Previous"  HREF="000497.html">
   <LINK REL="Next" HREF="000487.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JOS-Arch] rheise.os questions</H1>
    <B>Todd L. Miller</B> 
    <A HREF="mailto:tmiller%40haverford.edu"
       TITLE="[JOS-Arch] rheise.os questions">tmiller@haverford.edu</A><BR>
    <I>Wed, 19 Apr 2000 03:33:32 -0400 (EDT)</I>
    <P><UL>
        <LI> Previous message: <A HREF="000497.html">[JOS-Arch] rheise.os questions</A></li>
        <LI> Next message: <A HREF="000487.html">[JOS-Arch] rheise.os questions</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#479">[ date ]</a>
              <a href="thread.html#479">[ thread ]</a>
              <a href="subject.html#479">[ subject ]</a>
              <a href="author.html#479">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>	[It's getting really late over here, so if this doesn't make any
sense, let me know and I'll give it another try...]

&gt;<i> I don't think so. Swing is an add-on for JDK 1.1, whereas it is a part
</I>&gt;<i> of JDK 1.2.
</I>
	Okay, makes sense.  I'll look into finding the right version of
swing, then.

&gt;<i> Correct. Sort of like the optional envp argument to exec() on UNIX.
</I>
	Ah, of course.

&gt;<i> No, that line is not necessary - it returns exactly the same instance in
</I>&gt;<i> this case. The line is present just for the sake of consistency - the
</I>&gt;<i> process manager is always obtained through the get() method before it is
</I>&gt;<i> used. I can remove it if you think it's misleading (or maybe I could
</I>&gt;<i> even put a comment in!!! :-)
</I>
	Just put in a comment -- something along the lines of &quot;I'm doing
this in case I ever do something terrible and strange to the get() method
in these classes that would cause it not to return the instance I just
generated.&quot;

&gt;<i> No, it's incomplete because we have not yet written our JOS version of
</I>&gt;<i> the System class. This native implementation of java.lang.System needs
</I>&gt;<i> to provide a way to be initialised and I cannot initialise the System
</I>&gt;<i> class in the new process unless I know how to initialise it. Since I
</I>&gt;<i> wrote the java.lang.System class for the host implementation, I know how
</I>&gt;<i> to initialise it.
</I>
	Actually, if the java.lang.System classes have separate statics,
you ought to be able to initialize them by calling setIn/Out/Err;
everything else ought to be taken care of by the (default) static
initializers.  (That is, ideally, we don't need to change classpath's (or
whoever's) System class at all, and the process support doesn't have to
touch System unless it wants to.)  We'll see how it goes.

&gt;<i> This is one of the things we need to do to hook up rheise.os to the JOS
</I>&gt;<i> kernel. We need to grab CLASSPATH and add all the support it needs to
</I>&gt;<i> work with JOS. Then we can modify NativeJavaProcess to make use of this
</I>&gt;<i> support.
</I>
	Most of the support, I believe, will be telling it not to call
library functions we don't provide in its native code. :)  (Seriously, if
you download the classpath distro, take a look at the vm/ subdirectory,
where they stick the VM-specific bits.  There isn't a whole lot in there, 
nicely enough.)

&gt;<i> Notice that if we do this, we are demonstrating the first use of
</I>&gt;<i> inter-process object sharing. The calling process needs a reference to
</I>&gt;<i> the process it is creating, and the program running in the new process
</I>&gt;<i> will need to be able to reference itself too.
</I>
	In general, we want the calling process to have a reference to the
spawned process, and spawned process obviously needs to reference itself.  
The question we must address is where the class definition of that
reference should reside.  Since this OO-IPC referencing will need
'illegal' casts, the obvious answer is that the JavaProcess class needs to
be shared between the primordial loaders of each process.  Every
JavaProcess has a private reference to its classloader, which could be
used on behalf of the calling process to set whatever statics need to be
set.  (e.g. SystemObjects.)

	Currently, the host code always sets a custom classloader because
that's the only way to generate (more-or-less) disjoint classloaders.  On
the native side, that is not the case -- an empty classloader can be
generated by the decaf code.  (In fact, at some point, must be.)  My
question, then, is -- does constructProcess() (I think!) ever /need/ to
set a classloader?  Since the native code must already generate an empty
primordial classloader for the new process, does the JOS code ever need to
worry about setting the classloader of the new process?  (That is,
JavaProcess's private ProcessClassLoader reference would be a reference to
a native PCL, generated by the native call to createProcess().  (And
possibly changed to a straight ClassLoader reference.))  A method in
JavaProcess could be used to set static variables or call static methods
on its classloader, i.e.:

myChild.setStaticField( &quot;myRandomStaticClass&quot;, &quot;myRandomStaticField&quot;,
	myRandomSharedObject );
Object args[1]; args[0] = myPipedInputStream;
myChild.staticFunction( &quot;java/lang/System&quot;, &quot;setIn&quot;, args );

	where the field values/function arguments are necessarily shared
objects.  (Would have to be to be useful anyway.)

	The idea of the above is that it ought to be possible to sidestep
about half of your question/concern.  (I think.  Maybe it won't work after
I finish sleeping:))

&gt;<i> Native wrappers are only needed for the host implementation. The native
</I>&gt;<i> implementation should allow native method invocations for any class
</I>&gt;<i> loaded by any ProcessClassLoader. But this is more a responsibility of
</I>&gt;<i> decaf than of rheise.os, so it's not really something rheise.os needs
</I>&gt;<i> support before it can be considered renameable to jos.*.
</I>
	Right.  I meant this question in the opposite order -- what does
decaf need to do before we can rename rheise.os, which entails getting the
nativ bit working correctly.  Something that decaf needs to do is handle
native calls correctly.

&gt;<i> Of course, the native implementation of rheise.os isn't complete, but
</I>&gt;<i> the structure is in place to support decaf/JJOS on one side, and the
</I>&gt;<i> Java layer on the other side. It's a matter of deciding whether or not
</I>&gt;<i> we want to use this as the structure to build around.
</I>
	It looks like it'll work, and if we blow it, we can always rewrite
it with the lessons learned.

&gt;<i> Likewise with decaf, which is like Jupiter to my Pluto :-)
</I>
	I believe we've found the codenames for our milestone releases. :)  
(Where the objective is to get down to the moderately-sized but extremely
hospitable 'Earth' release.)  And thanks for the compliment.

-_Quinn






</pre>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000497.html">[JOS-Arch] rheise.os questions</A></li>
	<LI> Next message: <A HREF="000487.html">[JOS-Arch] rheise.os questions</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#479">[ date ]</a>
              <a href="thread.html#479">[ thread ]</a>
              <a href="subject.html#479">[ subject ]</a>
              <a href="author.html#479">[ author ]</a>
         </LI>
       </UL>
</body></html>
